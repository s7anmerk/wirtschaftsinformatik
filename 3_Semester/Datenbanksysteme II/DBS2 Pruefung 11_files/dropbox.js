define("dropbox",["external/flash_detect","external/jquery_ui","external/keymaster","external/modernizr","external/plupload_dev","external/purify","external/react","external/react-dom","external/underscore","jquery","libs","modules/clean/account/email","modules/clean/account/email_verify_reasons","modules/clean/ajax","modules/clean/analytics","modules/clean/avatar/stacked_avatars","modules/clean/base64","modules/clean/browse/browse_drag_utils","modules/clean/browse_events","modules/clean/browse_interface","modules/clean/clipboard","modules/clean/contacts/cache_store","modules/clean/contacts/facebook_modal","modules/clean/contacts/facebook_oauth","modules/clean/contacts/list","modules/clean/contacts/types","modules/clean/css","modules/clean/datetime","modules/clean/dbmodal","modules/clean/dbmodal_loading","modules/clean/display_format","modules/clean/downloads","modules/clean/em_string","modules/clean/event_load","modules/clean/events/rollback","modules/clean/file_events","modules/clean/filepath","modules/clean/flux/dispatcher","modules/clean/form","modules/clean/frame_messenger","modules/clean/gandalf_util","modules/clean/groups/api","modules/clean/history","modules/clean/image_size","modules/clean/job_progress","modules/clean/legacy_pyxl_controllers/ajax_form","modules/clean/legacy_pyxl_controllers/bubble_picker","modules/clean/legacy_pyxl_controllers/role_picker","modules/clean/multiaccount_login","modules/clean/notserver","modules/clean/page_role_observer","modules/clean/pagination_manager","modules/clean/payments/cash","modules/clean/payments/dfb_util","modules/clean/photos/legacy_thumb_loader","modules/clean/previews/pdf_loader","modules/clean/previews/util","modules/clean/profile_services/profile_services_constants","modules/clean/profile_services/profile_services_link","modules/clean/react/browse/constants","modules/clean/react/file_viewer/controller","modules/clean/react/modal","modules/clean/react/previews/image_helpers","modules/clean/react/previews/preview_linkfile","modules/clean/search/search_helpers","modules/clean/search/search_type","modules/clean/sharing/api","modules/clean/sharing/api/client","modules/clean/sharing/constants","modules/clean/sharing/content_info","modules/clean/sharing/share_modal_util","modules/clean/sharing/shared_content_link_sync_modal","modules/clean/sharing/shared_content_link_sync_utils","modules/clean/sharing/ui_util","modules/clean/sprite","modules/clean/sso_login_checks","modules/clean/static_urls","modules/clean/teams/modals/suggest_team_invite_modal","modules/clean/teams/team_folder_modal","modules/clean/top_notif","modules/clean/uirequest","modules/clean/undo","modules/clean/viewer","modules/clean/web_timing_logger","modules/constants/debug","modules/constants/env","modules/constants/file_viewer","modules/constants/legacy","modules/constants/page_load","modules/constants/python","modules/constants/request","modules/constants/shared_link_folder","modules/constants/static","modules/constants/teams","modules/constants/viewer","modules/core/browser","modules/core/controller_helpers","modules/core/cookies","modules/core/dom","modules/core/exception","modules/core/html","modules/core/i18n","modules/core/notify","modules/core/uri","require"],function(e,t,n,i,r,o,s,a,l,_,u,c,d,h,m,p,f,v,g,w,b,y,k,x,E,C,D,T,S,A,R,N,I,O,L,M,U,j,F,q,P,B,Y,z,H,K,W,V,J,G,X,Z,Q,ee,te,ne,ie,re,oe,se,ae,le,_e,ue,ce,de,he,me,pe,fe,ve,ge,we,be,ye,ke,xe,Ee,Ce,De,Te,Se,Ae,Re,Ne,Ie,$e,Oe,Le,Me,Ue,je,Fe,qe,Pe,Be,Ye,ze,He,Ke,We,Ve,Je,Ge,Xe){var Ze,Qe={},et=c.EmailVerification,tt=y.DefaultContactsCacheStore,nt=y.LegacyContactsCacheStore,it=S.DBModal,rt=S.DBModalStack,ot=(S.DBUserModal,z.image_best_fit_size,H.Job),st=H.ModalProgress,at=V.RolePickerState,lt=(G.NotServer,G.NotClients,Q.CashUtil),_t=ee.DfBTransitionInfoFetcher,ut=oe.LinkedProfileServices,ct=oe.ProfileServicesLinkingHandler,dt=(se.FileTypes,se.SharedWithActionTypes,le.SimpleModal,ue.PreviewLinkfile,he.SharingApi,me.FolderShareApiClient,fe.ContentInfo,ve.showShareModal),ht=De.TopNotificationBar,assert=(Ke.SEVERITY,Ke.assert),raiseAndReport=Ke.raiseAndReport,reportException=Ke.reportException,mt=Ve.ungettext,pt=Ve._;Ve.N_,Ve.E_,Ve.render_sentences;INLINE_JS.$=$,INLINE_JS.$u=l,Function.prototype.defer=Function.prototype.defer.wrap(function(e){var t;return t=$A(arguments).slice(1),e.apply(this,t)}),String.prototype.evalScripts=String.prototype.evalScripts.wrap(function(e){var t,n,i;t=$A(arguments).slice(1);try{return e.apply(this,t)}catch(e){return n=e,assert(0,n.toString())}}),Ze={cache:{},set:function(e,t,n){var i;return i=Ze.cache[e],null==i&&(i=Ze.cache[e]={}),i.value=t,i.expires=n?(new Date).getTime()+n:0},get:function(e){var t;return t=Ze.cache[e],null==t||(new Date).getTime()>t.expires?(delete Ze.cache[e],!1):t.value}},Function.prototype.cached=function(e){var t,n;return monkey_check(),n=Math.random(),t=this,function(){var i;return i=Ze.get(n),i!==!1?i:(i=t(),Ze.set(n,i,e),i)}},Array.prototype.sort_by_key=function(e,t){var n;return null==t&&(t=!1),monkey_check(),n=t?-1:1,this.sort(function(t,i){return t=e(t),i=e(i),i>t?-1*n:t>i?1*n:0})},Array.prototype.contains=function(e){return monkey_check(),-1!==this.indexOf(e)},Array.prototype.remove=function(e,t){return monkey_check(),t=t||e+1,this.splice(e,t-e)},Array.prototype.removeItem=function(e){var t;return monkey_check(),t=this.indexOf(e),t>=0?this.remove(t):!1},Array.prototype.dict_by=function(e){var t,n,i,r,o;for(monkey_check(),o={},t=i=0,r=this.length;r>i;t=++i)n=this[t],o[this[t][e]]=this[t];return o},Array.prototype.unique=function(){var e,t,n,i,r;for(monkey_check(),e={},n=0,i=this.length;i>n;n++){if(t=this[n],"string"!=typeof t)return this;e[t]=0}r=[];for(t in e)r.push(t);return r},String.prototype.widthSplit=function(e){var t,n,i,r;for(null==e&&(e=15),monkey_check(),t=[],n=this,r=0,i=n.substring(r,r+e);""!==i;)t.push(i),r+=e,i=n.substring(r,r+e);return t},Object.extend(Effect.Transitions,{EaseIn:function(e){return Math.pow(e,2)},EaseOut:function(e){return Math.pow(e,.5)}}),function(e){var t,n;return n=function(e){var t,n,i,r,o,s,a,l,_;if(e)if(Object.isArray(e)){for(t=[],i=0,o=e.length;o>i;i++)n=e[i],t.push(We.escape(n).toHTML());e=new We(t.join(""))}else if(e.top||e.bottom||e.before||e.after)for(l=["top","bottom","before","after"],r=0,s=l.length;s>r;r++)a=l[r],_=e[a],_&&(e[a]=arguments.callee(_));else vt.isElm(e)||e.toElement||e.toHTML||(e=We.escape(e));return e},Element.addMethods({db_observe:function(e,t,n){return monkey_check(),e.observe(t,function(t){return n(t,e)})},smoothScrollIntoView:function(e,t){var n,i,r,o,s,a;return null==t&&(t={}),monkey_check(),n={duration:.3,offset:0,padding:0,transition:Effect.Transitions.EaseOut},t=Object.extend(n,t),r=e.viewportOffset(e),i=e.getDimensions(),a=document.viewport.getDimensions(),s=t.padding||0,r.top>s&&r.top+i.height<a.height-s?void 0:(o=r.top<s?-1*Math.floor(a.height/4):-1*Math.floor(3*a.height/4),t.offset=t.offset||o,new Effect.ScrollTo(e,t))},__sert:function(e,t){return Element.insert(e,n(t))},__date:function(e,t){return Element.update(e,n(t))},replace:t=function(t,i){return e(t,n(i))}})}(Element.replace),String.prototype.lpad=function(e,t){var n;for(null==t&&(t="0"),monkey_check(),n=this;n.length<e;)n=t+n;return n.toString()},String.prototype.reverse=function(){var e,t,n;return monkey_check(),n=this.split(""),t=n.reverse(),e=t.join("")},String.prototype.count=function(e){return monkey_check(),(this.length-this.gsub(e,"").length)/e.length},String.prototype.repeat=function(e){return monkey_check(),new Array(e+1).join(this)},String.prototype.title=function(){return monkey_check(),this.charAt(0).toUpperCase()+this.substr(1)},Ajax.DBRequest=Class.create(Ajax.Request,{initialize:function($super,e,t){var n,i,r,o,s,a,l,u,c,d,h,m,p,f,v;if(null==t&&(t={}),monkey_check(),this.orig_req={url:e,options:t},this.start_time=T.time(),t.method=t.method||"post",t.evalJS=!1,t.suppress_nonstandard_headers=!0,t.parameters=t.parameters||{},t.parameters.t=ze.read(Ue.JS_CSRF_COOKIE),t.parameters.is_xhr=!0,("post"===t.method.toLowerCase()||Ne.CPROFILE_ENABLED)&&(t.parameters.parent_request_id=Ue.REQUEST_ID),Ne.CPROFILE_ENABLED&&(t.parameters.cProfile=Ne.CPROFILE_PARAMETER),Le.PUBLIC_MODE_OVERRIDE&&(t.parameters.public_mode_override="1"),Le.COUNTRY_OVERRIDE&&(t.parameters.public_mode_override=Le.COUNTRY_OVERRIDE),Ajax.DBRequest.restrict&&(t.parameters.restrict=Ajax.DBRequest.restrict),i=t.cleanUp||function(){},this.subject_user=t.subject_user||t.job_user,t.job&&(this.job_id=vt.nonce(),t.parameters.job_id=this.job_id,Bn.watch(this,t.dont_hide_progress_on_complete)),t.no_watch||bt.watch(this,!!t.job),d=t.onFailure,h=t.onSuccess,c=t.onComplete,u=function(e){return function(n){var i,r;return t.parameters.xhr_retry||!t.allow_retries?!1:0===(i=n.status)||500===i||502===i||503===i?(e.orig_req.options.parameters.xhr_retry=!0,e.orig_req.options.onFailure=d,e.orig_req.options.onSuccess=h,r=new Ajax.DBRequest(e.orig_req.url,e.orig_req.options),!0):!1}}(this),t.onFailure=function(n){var r,o,s;if(!ot.handled(n.request.job_id)&&!u(n))return t.noAutonotify||(!Le.IS_PROD&&500===n.status&&n.getHeader("X-Debug-Url")?(e=n.getHeader("X-Debug-Url"),r=pt("There was a problem completing this request.")+(' <a href="'+e+'" target="_blank">View debug</a>'),Je.error(new We(r))):Je.error()),i(!1),d&&d(n),403===n.status&&(s=vt.session_storage_get("reload-timestamp"),(!s||T.time()-s>3e4)&&(vt.session_storage_set("reload-timestamp",T.time()),location.reload(!0))),assert(t.noAutonotify||403===(o=n.status)||404===o||502===o,"Ajax "+n.status+" on "+n.request.url)},t.onComplete=function(e){return function(e){return e.responseText.length&&c&&0!==e.responseText.indexOf("async_task_started:")?c(e):void 0}}(this),t.onSuccess=function(n){return function(r){var o,s,a,l,c,m,p,f,v,g,w,b,y,k,x,E,C;if(C=T.time()-r.request.start_time,!ot.handled(r.request.job_id)){if(r.responseText.length){if(0===r.responseText.indexOf("err:"))t.noAutonotify||(f=r.responseText.substr(4),t.html_in_error_msg&&(f=new We(f)),Je.error(f)),d&&d(r);else if(0===r.responseText.indexOf("async_task_started:")?(n.async_task_id=r.responseText.split(":")[1],Bn.watch(n)):h&&(0===r.responseText.indexOf("ok:")&&Je.success(r.responseText.substr(3)),h(r)),E=r.getHeader("X-Server-Response-Time")||"-1",t.log_timing&&Re.log_ajax_transition.defer(C,void 0,void 0,void 0,E,e=ft.absolutize(n.url)),s=_("#cprofile"),!t.no_watch&&s.length){if(y=Ue.REQUEST_ID+"-"+r.getHeader("X-Dropbox-Request-Id"),e=r.request.url.replace(/[^\/]*\/\/[^\/]+/,"").replace(/\?.*$/,""),g={request_id:y},b=r.request.url,-1!==b.indexOf(Ie.BLOCK_CLUSTER))g.block=1;else for(w=Ie.BATCH_THUMB_ENDPOINTS,m=0,p=w.length;p>m;m++)if(c=w[m],-1!==b.indexOf(c)){g.block=1;break}o=function(e,t,n,i){var r,o;return r=_(i?'<a target="_blank" />':"<a />"),o=r.attr("href",String(Ge({authority:Ie.WEBSERVER,path:t,query:n}))).text(e+" ")},v=[["svg","/profile/cprofile/svg",!0],["pstats","/profile/cprofile/pstats",!1],["callgrind","/profile/cprofile/callgrind",!1],["IO","/profile/ioprofile",!0],["DB","/profile/dbprofile",!0]],x=function(){var e,t,n;for(n=[],e=0,t=v.length;t>e;e++)a=v[e],n.push(o(a[0],a[1],g,a[2]));return n}(),k=_('<div class="ajax">').text("Ajax: "+e+" ("+E+"ms)").prepend(x),l=s.find(".ajax"),l.length>=10&&l.last().remove(),s.prepend(k)}}else if(!t.job){if(u(r))return;t.noAutonotify||r&&0===r.status||Je.error(),d&&d(r)}return i(!0)}}}(this),t.onException=function(t,n){var i;if(window.console)throw n;return i="Error with AJAX callback for: "+e+" :::: "+n.toString(),reportException({err:n})},t.job&&(e+=(-1===e.indexOf("?")?"?":"&")+"long_running=1"),t.subject_user&&!(null!=(p=t.parameters)?p[Pe.UID_PARAM_NAME]:void 0)&&(e=Ge.parse(e).updateQuery(Pe.UID_PARAM_NAME,t.subject_user).toString()),n=$H({url:e}),t.parameters){for(n.update(t.parameters),f=n.keys(),r=0,a=f.length;a>r;r++)for(s=f[r],v=["passwd","password","oauth","ccn","host_id"],o=0,l=v.length;l>o;o++)m=v[o],-1!==s.indexOf(m)&&n.unset(s);n.unset("t")}return t.onSuccess.__tb_ajax_info__=t.onFailure.__tb_ajax_info__=Object.toJSON(n),$super(e,t)}}),"undefined"!=typeof n&&null!==n&&Object.extend(n,{main_modifier:function(){return monkey_check(),vt.is_mac()?decodeURIComponent("%E2%8C%98"):"ctrl"}}),Object.extend(Prototype.BrowserFeatures,{DB_CORS:window.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}),INLINE_JS.$j=_;var ft,vt,gt;vt=INLINE_JS.Util=Qe.Util={scroll_to_thumb:function(e){var t,n,i,r;return n=e.cumulativeOffset().top,t=e.getHeight(),r=He.scroll_offsets().top,i=He.viewport_dimensions().height,r>n||n+t>r+i?He.scroll_to(0,n-i/2):void 0},decode_sort_key:function(e){var t,n,i,r;for(r=[],n=0,i=e.length;i>n;n++)t=e[n],"string"==typeof t?r.push(f.decode(t)):r.push(t);return r},sort_by_rank_or_key:function(e,t){return null!=e.sort_rank&&null!=t.sort_rank?e.sort_rank-t.sort_rank:(assert(null!=e.sort_key&&null!=t.sort_key,"expected sort keys on both elms"),this._sort_by_key(e,t))},sort_by_key:function(e,t){return this._sort_by_key(e,t)},_sort_by_key:function(e,t){var n,i,r,o,s;for(o=e.sort_key,s=t.sort_key,n=i=0,r=o.length;r>=0?r>i:i>r;n=r>=0?++i:--i){if(null==s[n])return 1;if(typeof o[n]!=typeof s[n])return"string"==typeof o[n]?1:-1;if(o[n]!==s[n])return o[n]>s[n]?1:-1}return s.length>o.length?-1:0},add_sort_arrow_mouseover:function(e,t,n,i){var r,o,s,a,l;for(a=$$(n),l=[],r=0,o=a.length;o>r;r++)s=a[r],l.push(function(n){var i;if(e!==n)return ye.src(n.down("img"),"web","downtick-spacer"),n.removeClassName("bolded");if(n.addClassName("bolded"),!n.hasClassName("noarrow"))return i=t?"arrow-up-gray":"arrow-down-gray",ye.src(n.down("img"),"web",i)}(s));return l},add_sort_arrow_mouseover_j:function(e,t,n,i){var r,o,s,a,l;for(a=_(n),l=[],r=0,o=a.length;o>r;r++)s=a[r],l.push(function(n){var i;if(e.attr("data-sort")!==_(n).attr("data-sort"))return ye.src(_(n).find("img")[0],"web","downtick-spacer"),_(n).removeClass("bolded");if(_(n).addClass("bolded"),!_(n).hasClass("noarrow"))return i=t?"arrow-up-gray":"arrow-down-gray",ye.src(_(n).find("img")[0],"web",i)}(s));return l},one_line_fit:function(e){var t,n;return t=$$(e),t.length<2?void 0:(n=function(e){return function(){var e,i,r,o,s,a,l,_,u;if(r=t[0],a=t[t.length-1],o=r.cumulativeOffset().top,l=a.cumulativeOffset().top,o!==l){if(e=parseInt(r.getStyle("font-size"),10),u=e-1,8>u)return;for(s=0,_=t.length;_>s;s++)i=t[s],i.style.fontSize=u+"px";return n()}}}(this))()},nice_list:function(e){var t,n,i,r,o;return e?1===e.length?e[0]:2===e.length?pt("%(x)s and %(y)s").format({x:e[0],y:e[1]}):(o=pt("%(x)s, %(y)s, and %(z)s").split(/%\(x\)s|%\(y\)s|%\(z\)s/),assert(4===o.length,"bad item list format %(x)s, %(y)s, and %(z)s"),n=o[0],i=o[1],r=o[2],t=o[3],[n,e.slice(0,-1).join(i),r,e[e.length-1],t].join("")):""},list_em_snippet:function(e,t){var n,i,r,o,s,a;for(o="",t-=new I("...").length,i=r=0,s=e.length;(s>=0?s>r:r>s)&&(a=e[i],0!==i&&(a=", "+a),n=new I(a).length,!(n>t));i=s>=0?++r:--r)t-=n,o+=a;return{str:o,snipped:e.length-i}},start_of_day:function(e){var t;return t=new Date,t.setTime(e.getTime()),t.setHours(0),t.setMinutes(0),t.setSeconds(0),t.setMilliseconds(0),t},to_iso8601_date:function(e,t,n){var i;return null==t&&(t=!1),null==n&&(n=!1),t?(i=e.getUTCFullYear().toString()+"-"+(e.getUTCMonth()+1).toString().lpad(2)+"-"+e.getUTCDate().toString().lpad(2),n&&(i+=" "+e.getUTCHours().toString().lpad(2)+":"+e.getUTCMinutes().toString().lpad(2)+":"+e.getUTCSeconds().toString().lpad(2))):(i=e.getFullYear().toString()+"-"+(e.getMonth()+1).toString().lpad(2)+"-"+e.getDate().toString().lpad(2),n&&(i+=" "+e.getHours().toString().lpad(2)+":"+e.getMinutes().toString().lpad(2)+":"+e.getSeconds().toString().lpad(2))),i},to_mysql_date:function(e,t,n){var i,r,o;return i=e.getFullYear().toString()+"-"+(e.getMonth()+1).toString().lpad(2)+"-"+e.getDate().toString().lpad(2),o=e.getHours().toString().lpad(2)+":"+e.getMinutes().toString().lpad(2)+":"+e.getSeconds().toString().lpad(2),r="."+e.getMilliseconds().toString().lpad(3),t?n?i+" "+o+r:i+" "+o:i},from_mysql_date:function(e){var t,n,i,r,o,s,a;return r=e.split(" "),t=r[0],s=r.length>1?r[1]:!1,n=t.split("-"),assert(3===n.length,"weird date format on "+this+", expected yyyy-mm-dd"),i=new Date(n[0],parseInt(n[1],10)-1,n[2]),s&&(a=s.split(":"),assert(3===a.length,"weird time format on "+this+", expected hh:mm:ss.ms"),i.setHours(a[0]),i.setMinutes(a[1]),o=a[2].split("."),i.setSeconds(o[0]),o.length>1&&i.setMilliseconds(o[1])),i},make_table:function(e,t){var n,i,r,o,s,a,l;r=new Element("table",t),o=new Element("tbody"),r.__sert(o);for(i in e)l=e[i],a=new Element("tr"),s=new Element("td").insert(i),n=new Element("td").insert(l),a.__sert(s),a.__sert(n),o.__sert(a);return r},validate_email:function(e){var t;return t=new RegExp("^['&A-Z0-9._%+-]+@[A-Z0-9-][A-Z0-9.-]*\\.[A-Z]{2,15}$","i"),t.test(e)},scrollTop:function(){return window.scrollY||document.documentElement.scrollTop||0},scrollLeft:function(){return window.scrollX||document.documentElement.scrollLeft||0},scried:{},scry:function(e){var t,n;return n=this.scried,t=n[e],t||(t=$(e),n[e]=t),t},urlquote:function(e){return e.split("/").map(encodeURIComponent).join("/")},ie8:Prototype.Browser.IE&&document.documentMode&&!0,ie:Prototype.Browser.IE,log:function(){var e,t;return Le.IS_PROD?void 0:Prototype.Browser.IE?null!=(e=$("ieconsole"))?e.innerHTML+=$A(arguments).join(" ")+"<br>":void 0:"undefined"!=typeof console&&null!==console&&null!=(t=console.log)?t.apply(console,$A(arguments)):void 0},childElement:function(e,t){var n;return n=this.childElementWithIndex(e,t),n[0]},childElementWithIndex:function(e,t){var n,i,r,o,s,a;for(n=0,a=e.childNodes,r=o=0,s=a.length;s>o;r=++o)if(i=a[r],1===i.nodeType&&n++===t)return[i,r];return[!1,!1]},disableSelection:function(e){return e.onselectstart=function(){return!1},e.unselectable="on",e.style.MozUserSelect="none",e.style.cursor="default"},enableSelection:function(e){return e.onselectstart=function(){return!0},e.unselectable="off",e.style.MozUserSelect="",e.style.cursor=""},disable_ie_image_dragging:function(){return Prototype.Browser.IE&&Prototype.Browser.IEV<9?document.ondragstart=function(){return!1}:void 0},bsearch:function(e,t,n,i){var r,o,s,a;for(n||(n=function(e,t){return e-t}),r=e.length,o=0;r>o;)if(s=Math.floor(r/2+o/2),a=n(e[s],t),a>0)r=s;else{if(!(0>a))return s;o=s+1}return i?o:-1},nonce:function(){var e,t,n;return e=new Date,n=e.getTime().toString(),t=Math.floor(1e6*Math.random()).toString().lpad(6),n+t},focus:function(e){if(e){e=$(e);try{return e.focus()}catch(e){}}},sumStyles:function(e,t){var n,i,r,o;if(i=0,e)for(r=0,o=t.length;o>r;r++)n=t[r],i+=parseInt(e.getStyle(n),10)||0;return i},smart_window_load:function(e){return"complete"===document.readyState?e.defer():Event.observe(window,"load",e)},isNumber:function(e){return!isNaN(Number(e,10))},shorten_url:function(e,t){return new Ajax.DBRequest("/shorten_url",{parameters:{url:e},onSuccess:function(e){return t(e.responseText)}})},falsy_to_empty:function(e){return e||""},preloaded_images:{},preload_image:function(e,t,n){var i;if(!this.preloaded_images[e])return i=new Image,null!=t&&Element.extend(i).observe("error",t),null!=n&&Element.extend(i).observe("load",n),i.src=e,this.preloaded_images[e]=i},get_preloaded_image:function(e){return this.preloaded_images[e]?this.preloaded_images[e].clone():new Element("img",{src:e})},clear_selected:function(){var e;if(window.getSelection){if(e=window.getSelection(),e.removeAllRanges)return e.removeAllRanges()}else if(document.selection)return document.selection.empty()},is_mac:function(){return-1!==navigator.appVersion.indexOf("Mac")},is_windows:function(){return-1!==navigator.appVersion.indexOf("Windows")},in_scrollbar:function(e){var t,n;return t=20,n=He.viewport_dimensions(),e>n.width-t},freshbutton_overlay:function(e,t){var n,i;return i=e instanceof jQuery&&e||_(e),n=t instanceof jQuery&&t||_(t),i.on("mouseover",function(e){return function(){return n.addClass("hovered")}}(this)),i.on("mouseout",function(e){return function(){return n.removeClass("hovered"),n.removeClass("pressed")}}(this)),i.on("mousedown",function(e){return function(){return n.removeClass("hovered"),n.addClass("pressed")}}(this)),i.on("mouseup",function(e){return function(){return n.removeClass("pressed")}}(this))},isElm:function(e){return"object"==typeof HTMLElement?e instanceof HTMLElement:e&&"object"==typeof e&&1===e.nodeType&&"string"==typeof e.nodeName},_track_twitter_chars_left:function(e,t){var n;return clearInterval(this.chars_left_interval),n=function(n){return function(){var n,i;return n=$("twitter-chars"),i=t-$F(e).trim().length,0>i?n.addClassName("too-long"):n.removeClassName("too-long"),n.__date(i)}}(this),this.chars_left_interval=setInterval(n,250)},session_storage_set:function(e,t){return window.sessionStorage&&window.JSON?window.sessionStorage.setItem(e,JSON.stringify(t)):void 0},session_storage_get:function(e){return window.sessionStorage&&window.JSON?JSON.parse(window.sessionStorage.getItem(e)):void 0},pdf_plugins:function(){var e,t,n;return n=/Chrome PDF|Adobe Reader|Adobe PDF|Acrobat/gi,e=function(){var e,i,r,o;for(r=window.navigator.plugins,o=[],e=0,i=r.length;i>e;e++)t=r[e],n.test(t.name)&&o.push(t);return o}()},get_window_location:function(){return window.location}},vt.scrollLeft=vt.scrollLeft.cached(50),vt.scrollTop=vt.scrollTop.cached(50),null==window.console&&(window.console={log:function(){},profile:function(){},profileEnd:function(){}}),document.observe("script:loaded",function(){var e,t,n,i,r;if(vt.ie8){for(i=$$("#page-header a, #page-footer a"),r=[],e=0,t=i.length;t>e;e++)n=i[e],"_blank"===n.target?r.push(n.target=""):r.push(void 0);return r}}),ft=Qe.URLUtil={absolutize:function(e){return e.startsWith("https://")||e.startsWith("http://")?e:"/"===e.charAt(0)?window.location.protocol+"//"+window.location.host+e:assert(0,"absolutize is confused by "+e)}},gt=Qe.Velocity={scroll_container:null,velocity:0,last_nonzero_velocity:0,old_y:0,max_delta_y:0,calculate_velocity:function(){return this.velocity=this.max_delta_y,0!==this.velocity&&(this.last_nonzero_velocity=this.velocity),this.max_delta_y=0},capture_new_y_pos:function(){var e,t;return null==this.old_y?void(this.old_y=null!=this.scroll_container?this.scroll_container.scrollTop:He.scroll_offsets().top):null==this.max_delta_y?void(this.max_delta_y=0):(t=null!=this.scroll_container?this.scroll_container.scrollTop:He.scroll_offsets().top,e=Math.abs(this.max_delta_y)<Math.abs(t-this.old_y),e?(this.max_delta_y=t-this.old_y,this.old_y=t):void 0)},start_capture:function(e){return this.scroll_container=e,this.velocity_calculator_interval=setInterval(this.calculate_velocity.bind(this,500)),null!=this.scroll_container?this.scroll_container.observe("scroll",this.capture_new_y_pos.bind(this)):Event.observe(window,"scroll",this.capture_new_y_pos.bind(this))},get:function(e){return null==e&&(e=!1),assert(null!=this.velocity_calculator_interval,"Haven't started capturing velocity"),e?this.last_nonzero_velocity:this.velocity}};var wt;wt=Qe.DomUtil={fromElm:function(e){return $(e).innerHTML},updateFromElm:function(e,t){return e=$(e),t=$(t),e.update(this.fromElm(t))},fillVal:function(e,t){var n,i,r,o,s,a;for(r=$$("."+t),s=[],n=0,i=r.length;i>n;n++)a=r[n],a=$(a),"INPUT"===a.tagName?(a.value=e,s.push(a.defaultValue=e)):(""!==a.innerHTML||"A"!==(o=a.tagName)&&"B"!==o&&"INPUT"!==o&&"I"!==o&&"LABEL"!==o&&"SELECT"!==o&&"SPAN"!==o&&"TEXTAREA"!==o||vt.log("Filling an empty value; this may look broken in IE7",a),s.push(a.innerHTML=e));return s}};var bt;bt=Qe.RequestWatcher={reqs:[],working_msg:pt("Still working...",{comment:"Comment about waiting for a process to complete"}),last_notification:null,TIMEOUT:10,watch:function(e,t){var n;return n=this.reqs,n.length||(this.int_id=setInterval(this.check_up.bind(this),500)),t&&(e.skip_message=!0),n.push([e,T.time()])},check_up:function(){return this.scan(!1)},remove:function(e){return this.scan(e)},scan:function(e){var t,n,i,r,o,s,a,l,_;for(r=T.time(),o=[],a=this.reqs,n=0,i=a.length;i>n;n++)s=a[n],l=s[0],_=s[1],t=r-_,4!==l.transport.readyState?(t>4e3&&!l.skip_message&&(l.skip_message=!0,Je.isShown()&&Je.current()===!Se.undo_notification&&(this.last_notification=Je.success(this.working_msg))),t>1e3*this.TIMEOUT&&l.job&&l.transport.abort(),l!==e?o.push([l,_]):l.transport.abort()):this.clearWorkingMessage();return this.reqs=o,o.length?void 0:clearInterval(this.int_id)},clearWorkingMessage:function(){return Je.isShown()&&Je.current()===this.last_notification?Je.clear():void 0}},_(function(){var e,t,n,i;n=Prototype.Browser,i=[];for(e in n)t=n[e],t===!0&&i.push(_(document.body).addClass(e.toLowerCase()));return i});var yt,kt,xt=[].slice;yt=Qe.HTML5_HISTORY=i.history,_(function(e){return function(){return Y.init()}}(this)),kt=Qe.HashRouter={watch_timer:null,callback_map:{},last_hash:"",last_prefix:"",_get_location:function(){return window.location.href},_set_location:function(e){return window.location.href=e},_replace_location:function(e){return window.location.replace(e)},init:function(){return this.watch_timer=setInterval(this.check_hash.bind(this),300)},watch:function(e,t){return this.callback_map[e]=t,this.watch_timer?void 0:this.init()},check_hash:function(){var e,t,n,i,r,o;if(i=this._get_location().split("#")[1],null!=i&&(i=i.replace(/%27/g,"'")),this.last_hash!==i){if(this.last_hash=i,this.last_prefix&&""===i)i=this.last_prefix+":";else if(!i)return;return o=i.split(":"),r=o.first(),this.last_prefix=r,n=this.callback_map[r],null!=n&&(t=function(){var t,n,i,r;for(i=o.slice(1),r=[],t=0,n=i.length;n>t;t++)e=i[t],r.push(decodeURIComponent(e));return r}(),n.apply(null,t)),$(document).fire("db:hash_change",{hash:i})}},_prepare_hash:function(e){var t,n;return n=$A(e).map(vt.falsy_to_empty),t=n.map(encodeURIComponent),t.join(":")},set_hash:function(){var e,t;return e=1<=arguments.length?xt.call(arguments,0):[],t=this._prepare_hash(e),this._set_hash(t)},replace_hash:function(){var e,t;return e=1<=arguments.length?xt.call(arguments,0):[],t=this._prepare_hash(e),this._set_hash(t,!0)},_set_hash:function(e,t){return""===e&&(e="/"),this.last_hash=e,t?this._replace_location("#"+e):this._set_location("#"+e)}};var Et;Et=Qe.SharingUtil=function(){function e(){}return e.success_string_for_recipients=function(e){var t;return t=1===e.length?-1===e[0].indexOf("@")?pt("Sent to %(recipient)s.",{comment:"Recipient is a user's name"}).format({recipient:e[0]}):pt("Sent to %(recipient)s.",{comment:"Recipient is an email address"}).format({recipient:e[0]}):2===e.length?-1===e[0].indexOf("@")?-1===e[1].indexOf("@")?pt("Sent to %(recipient_first)s and %(recipient_second)s.",{comment:"Recipients are users' names."}).format({recipient_first:e[0],recipient_second:e[1]}):pt("Sent to %(recipient_first)s and %(recipient_second)s.",{comment:"First recipient is a user's name, second is an email address"}).format({recipient_first:e[0],recipient_second:e[1]}):-1===e[1].indexOf("@")?pt("Sent to %(recipient_first)s and %(recipient_second)s.",{comment:"First recipient is an email address, second is a user's name"}).format({recipient_first:e[0],recipient_second:e[1]}):pt("Sent to %(recipient_first)s and %(recipient_second)s.",{comment:"Recipients are email addresses"}).format({recipient_first:e[0],recipient_second:e[1]}):-1===e[0].indexOf("@")?pt("Sent to %(recipient)s and %(num_others)s others.",{comment:"num_others is 2 or more"}).format({recipient:e[0],num_others:e.length-1}):pt("Sent to %(recipient)s and %(num_others)s others.",{comment:"num_others is 2 or more"}).format({recipient:e[0],num_others:e.length-1})},e.truncate_emails=function(e){var t;return e.length<=1500?e:(t=e.lastIndexOf(",",1500),-1===t?"":e.slice(0,t))},e}();var Ct;Autocompleter.Contacts=Class.create(Autocompleter.Base,{initialize:function(e,t,n,i){var r,o,s,a,l;return this.user=e,m.LegacySharingVortexLogger.log("initialize-autocompleter-contacts"),this.baseInitialize(t,n,i),this.options.array=!1,this.options.larray=!1,this.options.frequency=.1,this._num_contacts_shown=0,this._num_query_results=0,o=this.options.include_fb===!0,null==this.options.include_team&&(this.options.include_team=!0),l=this.options.include_team===!0,a=this.options.include_new_style_groups===!0,s=this.options.include_me===!0,this.profile_services=ut.get_linked_profile_services_for_user(this.user.id,this.update_import_contacts_link),this.link_handler=new ct,this._autocompleter_profile_services_item_tmpl=We.tmpl("autocompleter_item_tmpl"),this.listen(),this.possible_email_pattern=/[.@_-]/,r=function(e){return function(t){return t=e.options.include_from_linked_accounts&&e.options.viewer?t.includeForViewer(e.options.viewer):t.includeForUser(e.user.id),e.options.contact_filter?t=e.options.contact_filter(t):(o||(t=t.excludeFacebook()),a||(t=t.excludeNewStyleGroups()),l||(t=t.excludeTeamMembers()),s||(t=t.excludeMe())),e.setContacts(t)}}(this),function(){var e,t;return e=nt.getOrCreateForViewer(),e.load_contacts(t=!1,function(t){return r(t),e.register_for_updates("autocompleter_contacts",r)})}.defer(),this.options.onShow=function(e,t){return t.style.position&&"absolute"!==t.style.position||(t.style.position="absolute",He.clone_position(_(t),_(e),{setHeight:!1,setTop:!1,setLeft:!1})),_(t).fadeTo(150,1)}},link_callback:function(e){return ct.show_import_notifications(e)},getToken:function(){var e;return e=this.getTokenBounds(),this.element.value.substring(e[0],e[1])},listen:function(){var e;return this.install_profile_services_link_listener(),e=function(e){return function(t){return e.profile_services.has_connected_services()||_(e.element).val()?void 0:(e.activate(),setTimeout(function(){var t;return null!=(t=e.get_entry_container())?t.show():void 0},300),!0)}}(this),_(this.element).click(e)},install_profile_services_link_listener:function(){var e;return Event.stopObserving(this.element,"blur"),e=function(e){return function(t){var n;return _(t.target).closest("li").hasClass("profile-services-link-handler")?void 0:null!=(n=e.get_entry_container())?n.hide():void 0}}(this),_(this.element).closest(".db-modal-box").click(e),_(this.element).closest("#modal-box").click(e)},get_entry_container:function(){var e;return null!=(e=this.element.up(".tokenized_autocompleter_container"))?e.down(".autocomplete"):void 0},profile_services_show:function(){var e,t,n,i;return e=this.get_entry_container(),(null!=(t=e.firstChild)&&null!=(n=t.firstChild)?n.value:void 0)>0?this.old_display=e.style.display:(this.old_contents="<ul></ul>",this.old_display="none"),this.profile_services_render_buttons(),null!=(i=$("flash_copy_container"))&&i.hide(),this.element.focus()},profile_services_render_buttons:function(){var e;return e=this.get_profile_services_button_list(),this.hasFocus=!0,this.updateChoices("<ul>"+e.join("")+"</ul>")},get_profile_services_button_list:function(){var e,t,n,i,r,o;for(o=[],r=re.importable_contact_services(),t=0,n=r.length;n>t;t++)i=r[t],assert(this.profile_services.is_updated,"profile_services has not been updated"),e="",this.profile_services.service_is_connected(i)?e=pt("Connected"):this.profile_services.service_was_connected(i)&&(e=pt("Reconnect")),o.push(this._autocompleter_profile_services_item_tmpl({email_provider_num:i,email_provider_img:re.to_img(i)[0],email_provider_name:re.to_name(i),bottom_text:e}).toHTML());return o},update_import_contacts_link:function(e){return function(t){return e.profile_services=t,e.profile_services.has_unconnected_services(!0)?_(e.element).closest("form").find(".import-contacts-link").show():_(e.element).closest("form").find(".import-contacts-link").hide()}}(this),hide_containing_modal:function(){return this.$hidden_modals=_(".db-modal-wrapper:visible").first(),this.$hidden_modals.length?this.$hidden_modals.css("display","none"):(this.$hidden_modals=_("#modal:visible, #modal-overlay:visible"),this.$hidden_modals.hide())},show_containing_modal:function(){return this.$hidden_modals.show(),this.$hidden_modals=null},setContacts:function(e){return this.options.array=e.contacts,this.options.larray=e.lcontacts,this.active||this.getToken()?this.getUpdatedChoices():void 0},loadContacts:function(){
var e;return e=function(e){return function(t){var n,i,r,o;return n=e.options.include_fb===!0,null==e.options.include_team&&(e.options.include_team=!0),o=e.options.include_team===!0,r=e.options.include_new_style_groups===!0,i=e.options.include_me===!0,t=e.options.include_from_linked_accounts&&e.options.viewer?t.includeForViewer(e.options.viewer):t.includeForUser(e.user.id),e.options.contact_filter?t=e.options.contact_filter(t):(n||(t=t.excludeFacebook()),r||(t=t.excludeNewStyleGroups()),o||(t=t.excludeTeamMembers()),i||(t=t.excludeMe())),e.setContacts(t)}}(this),function(){var t,n;return t=tt.getOrCreateForViewer(),t.load_contacts(n=!1,function(n){return e(n),t.register_for_updates("autocompleter_contacts",e)})}.defer()},getUpdatedChoices:function(){return this.updateChoices(this.options.selector())},selectEntry:function(){var e,t,n;return t=this.getCurrentEntry(),e=this.options.array[t.value],e.type===C.FB||e.type===C.NEW_STYLE_GROUP?t.innerHTML=e.name:t.innerHTML=e.email,n=this.options.tokens.length>1?this.options.tokens[0]+" ":"",t.innerHTML+=n,this.active=!1,this.updateElement(t),_(this.element).trigger("db:autocompleted")}},Ct=function(e,t){var n;return n=_("<div>"),n.addClass(e),"string"==typeof t||t instanceof String?n.text(t):n.append(t),n},{getNumContactsShown:function(){return this._num_contacts_shown},getNumQueryResults:function(){return this._num_query_results},getContactInfoFromEmail:function(e){var t,n,i,r;for(r=this.options.array,n=0,i=r.length;i>n;n++)if(t=r[n],t.email===e)return{display_name:t.name,email:e,avatar_url:t.photo_url};return{display_name:"",email:e,avatar_url:null}},setOptions:function(e){var t;return null==e&&(e={}),t={choices:5,selector:function(e){return function(){var t,n,i,r,o,s,a,l,u,c,d,h,m,p,f,v,g,w,b,y,k,x,E,D,T,S,A,R,N,$,O,L,M,U,j,F,q,P,B,Y,z,H,K,W,V,J;for(z=[],d=e.getToken().toLowerCase(),x=e.options.array.length,o=e.options.array,$=e.options.larray,Y=[],-1===d.indexOf(" ")&&Y.push("\\s+"),-1===d.indexOf("+")&&Y.push("\\+"),-1===d.indexOf("@")&&Y.push("@"),-1===d.indexOf(".")&&Y.push("\\."),-1===d.indexOf("&lt;")&&Y.push("&lt;"),B=RegExp("("+Y.join("|")+")"),g=0;d.length>0&&x>g;){switch(r=o[g],N=$[g],h=-1,c=[],L=[],v="",r.name=r.name?I.em_snippet(r.name,22):"",r.email_snippet=r.email?I.em_snippet(r.email,22):"",r.type){case C.EMAIL:c.push(r.name,r.email_snippet),L.push(N.name,N.email),v="/static/images/icons/mail28-vflHfHPJ0.png";break;case C.FB:c.push(r.name),L.push(N.name),v="https://graph.facebook.com/"+N.fb_id+"/picture";break;case C.NEW_STYLE_GROUP:c.push(r.name,r.members),L.push(N.name,""),v="",null!=__CIRCULAR_DEPENDENCY__.GroupsListController&&(n=__CIRCULAR_DEPENDENCY__.GroupsListController.string_to_color(r.name),i=__CIRCULAR_DEPENDENCY__.GroupsListController.get_initials(r.name),m=_("<span class='group-icon'>").css("border-color",n).css("color",n).text(i));break;default:assert(!1,"should never get here due to type: "+(r.type+", "+r.name+", "+r.email+", "+r))}for(y=p=0,T=L.length;T>p;y=++p){for(O=L[y],j=Y.length?O.split(B):[O],a=0,b=0,S=j.length;S>b;b++)if(U=j[b]){if(0===U.indexOf(d)){h=a;break}a+=U.length}if(-1!==h){P=(d.length/U.length*9.4).toFixed(0),null!=r.sort_key&&(P+=r.sort_key),E=document.createTextNode(c[y].substr(0,h)),M=_("<strong>").text(c[y].substr(h,d.length)),K=document.createTextNode(c[y].substr(h+d.length)),c[y]=[E,M,K];break}}r.type===C.FB&&c.push(pt("Facebook message")),-1!==h&&(v?f=_('<img width="28px" height="28px">').attr({src:v,alt:""}):m&&(f=m),F=Ct("autocomplete-line",c[0]),J=Ct("autocomplete-line autocomplete-secondary",c[1]),D=Ct("autocomplete-left",f),W=Ct(null,[F,J]),R=_("<li>").attr("value",g).append(D,W),z.push([P,R])),g++}for(z.sort(function(e,t){return e[0]<t[0]?1:e[0]>t[0]?-1:0}),e._num_query_results=z.length,z=z.slice(0,e.options.choices),H=_("<ul>"),k=0,A=z.length;A>k;k++)V=z[k],H.append(V[1]);return e._num_contacts_shown=z.length,_(e.element).hasClass("no-profile-services-link-handler")||e.profile_services.has_unconnected_services(!0)&&(s=_(e.element).closest(".tokenized_autocompleter_container"),q=s.attr("data-provider"),w=pt(q===re.GOOGLE?"Select from your Gmail contacts":q===re.YAHOO?"Select from your Yahoo contacts":"Select from your contacts"),l=!1,q!==re.GOOGLE&&q!==re.YAHOO||e.profile_services.service_is_connected(q)?e.profile_services.has_connected_services()&&(l=!1,w=pt("Import Contacts")):l=!0,l?(u=e._autocompleter_profile_services_item_tmpl({email_provider_num:q,email_provider_img:re.to_img(q)[0],email_provider_name:w,bottom_text:""}).toHTML(),H.append(u)):(f=ye.make("web","user_add"),F=Ct("autocomplete-line autocomplete-line-center",w),D=Ct("autocomplete-left",f),W=Ct(null,[F]),R=_("<li>").addClass("profile-services-link-handler").append(D,W),H.append(R))),t=H.wrap("<span>").parent().html(),e.old_contents=t,t}}(this)},this.options=Object.extend(t,e)}});var Dt;Dt=Qe.Token=Class.create({initialize:function(e,t,n,i){return this.element=$(e),this.token_manager=n,this.hidden_input=t,this.element.token=this,this.selected=!1,this.info=i,_(this.element).closest(".tokenized_autocompleter_container").click(this.onclick.bindAsEventListener(this))},select:function(){var e;return this.token_manager.token=this,null!=(e=this.hidden_input)&&e.element.activate(),this.selected=!0,this.element.addClassName("token_selected")},deselect:function(){return this.token_manager.token===this&&(this.token_manager.token=null),this.selected=!1,this.element.removeClassName("token_selected")},onclick:function(e){return e&&e.preventDefault&&e.preventDefault(),this.detect(e)&&!this.selected?this.select():this.deselect()},remove:function(e){return this.token_manager.remove(this)},detect:function(e){var t,n,i;for(n=e.target?e.target:e.srcElement,i=n.token,t=n;null==i&&t.parentNode;)t=t.parentNode,i=t.token;return null!=i&&i.element===this.element}});var Tt;Tt=Qe.TokenManager=Class.create({initialize:function(e,t,n,i){return this.contact_search_logger=i,this.shift_boundary_right_func=t,this.shift_boundary_left_func=n,this.element=e,this.tokens=[],this.token=null},add:function(e){return this.tokens.push(e),this.element.fire("token:add",e.info)},populate:function(){var e,t,n,i,r,o,s;for(s=this.element.select(".token"),i=[],t=0,n=s.length;n>t;t++)o=s[t],e=o.hasClassName("token-warn"),r=new Dt(o,null,this,{external:e}),i.push(this.add(r));return i},remove:function(e){var t;return null==e&&(e=this.token),null!=e?(this.contact_search_logger.flag_record_as_removed(e.info.value),t=this.tokens.indexOf(e),this.tokens.splice(t,1),e.element.remove(),this.token===e&&t<this.tokens.length?this.tokens[t].select():(this.token=null,null!=this.shift_boundary_right_func&&this.shift_boundary_right_func()),this.element.fire("token:remove",e.info)):void 0},removeAll:function(){var e,t,n,i,r;for(r=this.tokens.slice(0),this.tokens.clear(),n=[],e=0,t=r.length;t>e;e++)i=r[e],i.element.remove(),n.push(this.element.fire("token:remove",i.info));return n},shift_left:function(){var e;return e=this.token?this.tokens.indexOf(this.token):this.tokens.length,e>0?(this.token&&this.token.deselect(),this.tokens[e-1].select()):null!=this.shift_boundary_left_func?this.shift_boundary_left_func():void 0},shift_right:function(){var e;return e=this.tokens.indexOf(this.token),this.token&&this.token.deselect(),e+1<this.tokens.length?this.tokens[e+1].select():null!=this.shift_boundary_right_func?this.shift_boundary_right_func():void 0}});var St;St=Qe.HiddenInput=Class.create({initialize:function(e,t,n){return this.element=$(e),this.auto_complete_element=t,this.token_manager=n,Event.observe(this.element,"keydown",this.onKeyPress.bindAsEventListener(this))},onKeyPress:function(e){switch(e.keyCode){case Event.KEY_LEFT:e.preventDefault(),this.token_manager.shift_left();break;case Event.KEY_TAB:e.preventDefault(),this.token_manager.shift_right();break;case Event.KEY_RIGHT:e.preventDefault(),this.token_manager.shift_right();break;case Event.KEY_BACKSPACE:case Event.KEY_DELETE:this.token_manager.remove()}return!1}});var At=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};Autocompleter.ContactsTokenizer=Class.create(Autocompleter.Contacts,{initialize:function($super,e,t,n,i,r){var o;return this.user=e,$super(this.user,t,n,r),this.contact_search_logger=new m.ContactSearchLogger,this.token_manager=new Tt(this.element,this.generate_shift_boundary_right_func(),null,this.contact_search_logger),this.hidden_input=new St(i,this.element,this.token_manager),this.textbox_height=0,this.element.hacks||(this.element.should_use_borderless_hack=Prototype.Browser.WebKit,this.element.should_use_shadow_hack=Prototype.Browser.IE||Prototype.Browser.Opera,this.element.hacks=!0),(this.element.should_use_borderless_hack||this.element.should_use_shadow_hack)&&_(this.element).parent().addClass("tokenizer_input_borderless"),this.options.onShow=function(e,t){return He.clone_position(_(t),_(e.parentNode.parentNode),{setHeight:!1,setTop:!1,setLeft:!1}),t.show()},this.options.onHide=function(e,t){return t.hide()},this.max_textbox_height=270,null!=r.max_textbox_height&&(this.max_textbox_height=r.max_textbox_height),this.members=[],null!=r.members&&(this.members=r.members),this.invitees=[],null!=r.invitees&&(this.invitees=r.invitees),this.new_style_groups=[],null!=r.new_style_groups&&(this.new_style_groups=r.new_style_groups),this.contacts_only=!1,null!=r.contacts_only&&(this.contacts_only=r.contacts_only),o=-1!==Y.get_url().indexOf("/referrals")?_("#retrieve-contacts-button"):_(this.element).closest("form").find(".tokenizer-submit-button")[0],_(o).on("mousedown",this.beforeSubmit.bindAsEventListener(this)),_(this.element).on("focus",this.onFocus.bindAsEventListener(this)),this.import_links=[],r.hide_import_contacts||(this.import_links=_(".import-contacts-link")),this.calculate_input_size(),this.dynamically_resize_input(),this.check_populated(),setInterval(this.check_populated.bind(this),100)},onClick:function(e){var t,n;return t=e.findElement("li"),this.index=t.autocompleteIndex,n=this.selectEntry(),n?void 0:this.hide()},onBlur:function($super,e){return $(this.element.parentNode).removeClassName("focused"),this.element.up(".tokenizer").removeClassName("focused"),$super(e)},onFocus:function(e){return $(this.element.parentNode).addClassName("focused"),this.element.up(".tokenizer").addClassName("focused")},beforeSubmit:function(e){return this.tokenize_emails_input(!0)},clearTokens:function(e){return this.token_manager.removeAll(),this.calculate_input_size(),this.dynamically_resize_input()},getTokenCount:function(){return this.token_manager.tokens.length},getEmails:function(){var e,t;return e=_(this.element).closest(".tokenized_autocompleter_container").find(".token-valid").find('[name="emails"]'),function(){var n,i,r;for(r=[],n=0,i=e.length;i>n;n++)t=e[n],r.push(_(t).val());return r}().join(", ")},check_populated:function(){var e,t;return e=$(this.element.parentNode),t=""===this.element.value&&0===this.token_manager.tokens.length,e.hasClassName("populated")&&t?e.removeClassName("populated"):e.hasClassName("populated")||t?void 0:e.addClassName("populated")},clean_email_addr:function(e,t){var n,i,r;for(i=0,r=e.length;r>i;i++)n=e[i],t=t.sub(n,"");return t.trim()},get_regexp_from_delimiters:function(e){var t,n,i,r;for(n="",i=0,r=e.length;r>i;i++)t=e[i],n+=t+"|";return new RegExp("["+n+"\\r\\n|\\r|\\n|\\t]+")},createTokenInfo:function(e,t,n){var i,r;return r=!0,i=t,n===C.FB&&(i=e),n!==C.EMAIL||vt.validate_email(t)?At.call(this.members,t)>=0?(r=!1,i=pt("Already member")):At.call(this.invitees,t)>=0?(r=!1,i=pt("Already invited")):n===C.NEW_STYLE_GROUP&&(At.call(this.new_style_groups,t)>=0?(r=!1,i=pt("Already member group")):(r=!0,i=pt("Group"))):r=!1,t!==this.user.email&&t!==this.user.id||(i=pt("You"),r=!this.contacts_only),!e&&t&&(e=t.toString()),{display:e,value:t,type:n,valid:r,bubble_title:i}},COMPOUND_EMAIL_REGEX:/([^<>]+)<([^@>]+@[^@>]+)>/,parse_compound_email:function(e){var t,n;return t=e.match(this.COMPOUND_EMAIL_REGEX),t?n=this.createTokenInfo(t[0],t[2],C.EMAIL):null},tokenize_emails_input:function(e,t){var n,i,r,o,s,a,l,_,u,c,d,h,m,p,f,v,g,w,b;if(i=this.options.tokens,v=this.get_regexp_from_delimiters(i),o=this.options.single_token?[this.element.value]:this.element.value.split(v),w="",e||(w=o[o.length-1],f=this.clean_email_addr(i,w),o=o.slice(0,o.length-1)," "!==(p=w[w.length-1])&&">"!==p||(f.match(this.COMPOUND_EMAIL_REGEX)||vt.validate_email(f))&&(o.push(f),w="")),n=!1,b=[],o.length>0)for(a=0,u=o.length;u>a;a++)r=o[a],g=this.parse_compound_email(r),(null!=g?g.valid:void 0)?(n=!0,this.set_input_size(1),this.addContact(g)&&(h={sort_variant:null,context:"legacy_tokenizer",contact_type:C.EMAIL,contact_id:g.value,contact_name:g.display,did_select_suggestion:!1},this.contact_search_logger.add_record(h))):b.push(r);if(o=b,!this.options.single_token){for(m=[],l=0,c=o.length;c>l;l++)r=o[l],m.push.apply(m,r.split(" "));o=m}if(o.length>0)for(_=0,d=o.length;d>_;_++)if(r=o[_],r=this.clean_email_addr(i,r)){if(g=this.createTokenInfo(r,r,C.EMAIL),g.valid)n=!0;else if(t)continue;this.set_input_size(1),this.addContact(g)&&(h={sort_variant:null,context:"legacy_tokenizer",contact_type:C.EMAIL,contact_id:r,did_select_suggestion:!1},this.contact_search_logger.add_record(h))}return this.element.value!==w&&(this.element.value=w),s=this.element.up("form"),n&&jt.clear_errors(s),this.dynamically_resize_input()},generate_shift_boundary_right_func:function(){var e,t;return e=this.element,t=function(){return e.focus()}},set_input_size:function(e){return(null==e||0>e)&&(e=20),this.element.setStyle({width:e+"px"})},calculate_input_size:function(){return this.import_links.length?(this.import_links_width=this.import_links.width(),this.import_links_visible=this.import_links.is(":visible")):void 0},dynamically_resize_input:function(){var e,t,n,i,r,o,s,a,l,u,c,d,h,m,p,f,v,g,w,b;for(p=$(this.element.parentNode.parentNode),v=parseInt(p.getStyle("width"),10)-15,f=parseInt(p.getStyle("height"),10),f!==this.textbox_height&&(this.textbox_height=f,f>=this.max_textbox_height?p.setStyle({"overflow-y":"auto"}):p.setStyle({"overflow-y":"hidden"})),s=v,e=_(".tokenizer-link",p.parentNode),e.length>0&&(s-=e.width()),w=this.token_manager.tokens,u=!1,b=0,r=0,a=w.length;a>r;r++)g=w[r],i=g.element,n=parseInt(i.getStyle("width"),10)+parseInt(i.getStyle("margin-right"),10),d=b+n,d>v?(b=n,u=!0):n>v?(b=0,u=!0):b=d;if(c=s-b,t=7*this.element.value.length,t>c&&(c=v),this.set_input_size(c),this.import_links.length&&this.import_links_visible&&(u||v-b-t<1.25*this.import_links_width)){for(this.import_links_visible=!1,h=this.import_links,m=[],o=0,l=h.length;l>o;o++)i=h[o],m.push(_(i).fadeOut(100));return m}},onKeyPress:function(e){var t,n;if(this.dynamically_resize_input(),this.active)switch(e.keyCode){case 44:case 188:case 59:case 186:return e.shiftKey||(this.has_selected_profile_services_entry()||this.has_selected_profile_services())&&this.tokenize_emails_input(!0),void this.reset_observer();case Event.KEY_TAB:case Event.KEY_RETURN:return this.has_selected_profile_services_entry()||this.has_selected_profile_services()?(this.tokenize_emails_input(!0),this.hide(),void Event.stop(e)):(this.selectEntry(),this.hide(),this.active=!1,void Event.stop(e));case Event.KEY_ESC:return this.hide(),this.active=!1,void Event.stop(e);case Event.KEY_LEFT:case Event.KEY_RIGHT:return;case Event.KEY_UP:return this.markPrevious(),this.render(),void Event.stop(e);case Event.KEY_DOWN:return this.markNext(),this.render(),void Event.stop(e)}else{if(this.tokenize_emails_input(!1),e.keyCode===Event.KEY_TAB||e.keyCode===Event.KEY_RETURN)return this.element.value&&e.preventDefault&&e.preventDefault(),void this.tokenize_emails_input(!0);if(""===this.element.value)(t=e.keyCode)!==Event.KEY_LEFT&&t!==Event.KEY_BACKSPACE||this.token_manager.shift_left();else if((n=e.keyCode)===Event.KEY_LEFT||n===Event.KEY_RIGHT||n===Event.KEY_UP||n===Event.KEY_DOWN)return}return this.update_typeahead(),this.reset_observer()},update_typeahead:function(){return this.changed=!0,this.hasFocus=!0},reset_observer:function(){return this.observer&&clearTimeout(this.observer),this.observer=setTimeout(this.onObserverEvent.bind(this),1e3*this.options.frequency)},onObserverEvent:function($super){var e,t,n,i,r,o;if(this.active){for(o=this.element.value,r=this.options.tokens,n=0,i=r.length;i>n;n++)if(e=r[n],t=o.indexOf(e),-1!==t){if(this.has_selected_profile_services_entry())return this.tokenize_emails_input(!0),void this.hide();this.element.value=o.substr(0,t),this.selectEntry(),this.hide(),this.active=!1,this.element.value=o.substr(t+1);break}this.update_typeahead()}return this.tokenize_emails_input(!1),$super()},has_selected_profile_services:function(e){return null==e&&(e=this.getCurrentEntry()),_(e).hasClass("profile-services-link-handler")},has_selected_profile_services_entry:function(e){var t;return null==e&&(e=this.getCurrentEntry()),0===e.value&&0!==(null!=(t=e.id)?t.length:void 0)},selectEntry:function(){var e,t,n,i,r,o,s,a,l;return t=this.getCurrentEntry(),this.has_selected_profile_services(t)?(m.SharedFolderActivityLogger.log("web","import_contacts_button_clicked",this.user),this.profile_services_show(),!0):this.has_selected_profile_services_entry(t)?(o="suggestion",n=t.id.split("_")[0],assert(At.call(re.importable_contact_services(),n)>=0,"The 'id-value' of an autocompleter-entry is not a valid Third Party contact import service"),a=re.to_name(n),this.profile_services.service_is_connected(n)?void Je.success(pt("You're already connected to %(service_name)s").format({service_name:a})):At.call(re.importable_contact_services(),n)>=0?this.link_handler.auth_service_with_user(n,this.user.id,function(e){return function(t){return e.link_callback(t)}}(this),o):assert(!1,"Should never get here. entry_value: "+n)):(e=this.options.array[t.value],i=e.type===C.FB?e.fb_id:e.type===C.NEW_STYLE_GROUP?e.group_id:e.email,this.set_input_size(1),s=this.element.value,l=this.createTokenInfo(e.name.trim(),i,e.type),this.addContact(l)&&(r={sort_variant:null,context:"legacy_tokenizer",search_expr:s,selected_pos:this.index,num_query_results:this.getNumQueryResults(),contact_type:e.type,contact_id:i,contact_name:e.name.trim(),did_select_suggestion:!0},this.contact_search_logger.add_record(r)),jt.clear_errors(this.element.up("form")),this.dynamically_resize_input(),this.index=0,this.element.focus())},addContact:function(e){var t,n,i,r,o,s,a,l,u,c,d,h,m,p,f,v,g,w,b;for(b=this.token_manager.tokens,i=0,l=b.length;l>i;i++)if(h=b[i],e.value===h.info.value)return!1;switch(this.element.value="",e.type){case C.FB:s="fb_ids",r=new Element("img",{src:"/static/images/icons/fb_16-vflbiYTkC.png",alt:pt("Facebook")});break;case C.EMAIL:s="emails",r=new Element("img",{src:"/static/images/icons/email_16-vflcFyDTl.png",alt:""});break;case C.NEW_STYLE_GROUP:s="new_style_group_ids",r=new Element("img",{src:"/static/images/icons/icon_spacer-vflN3BYt2.gif",class:"sprite sprite_groups s_groups_group",alt:pt("Group")});break;case C.INVALID:s="invalids",r=new Element("span",{class:"hidden"});break;default:assert(!1,"should never get here due to type: "+e.type)}for(m=this.getTokenClass(e),w=_("<span class='x'>").addClass(m),w.on("click",function(e){return this.parentNode.parentNode.parentNode.parentNode.parentNode.token.remove(e),!1}),f=new Element("input",{type:"hidden",name:s,value:e.value.toString()}),h=new Element("a",{class:"title_bubble token "+m,href:"#",tabindex:"-1",title:e.bubble_title}),o=new Element("span"),this.options.wrap_name?(v=new Element("div",{class:"token-display-text"}),v.__sert(e.display),p=v,t=1):(p=e.display,t=0),c=[f,r,p],a=0,u=c.length;u>a;a++)n=c[a],o.__sert(n);return _(o).append(w),h.__date(new Element("span").__date(new Element("span").__date(new Element("span").__date(o)))),null!=(d=$(h).down(5).next(t))&&(d.innerHTML="&nbsp;"),g=new Dt(h,this.hidden_input,this.token_manager,e),this.token_manager.add(g),this.element.up().__sert({before:h}),!0},getTokenClass:function(e){return e.valid?"token-valid":"token-error"},isTeamOnly:function(){return!1}});var At=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};Autocompleter.TeamTokenizer=Class.create(Autocompleter.ContactsTokenizer,{initialize:function($super,e,t,n,i,r){return $super(e,t,n,i,r),this.warn_only=!r.team_only,this.element.observe("token:remove",this.notifyExternal.bind(this)),this.element.observe("token:add",this.notifyExternal.bind(this)),this.team_contacts={},this.suspended_contacts={},this.pending_contacts={},this.reloadContacts(!0)},isTeamOnly:function(){return!this.warn_only},setTeamOnly:function(e){return this.warn_only=!e,this.reloadContacts()},reloadContacts:function(e){var t;return null==e&&(e=!1),t=nt.getOrCreateForViewer(),t.load_contacts(e=e,function(e){return function(t){return e.setContacts(t)}}(this))},setContacts:function($super,e){var t,n,i,r;for(this.team_contacts={},this.team_contacts[Ae.get_viewer().work_email]=1,_(this.element).hasClass("team-admin")||(e=e.excludeSuspended()),e=e.sortByTeamFirst(),r=e.contacts,n=0,i=r.length;i>n;n++)t=r[n],t.team&&"active"===t.join_state&&(this.team_contacts[t.email]=1),t.team&&"suspended"===t.join_state&&(this.suspended_contacts[t.email]=1),t.team&&"pending"===t.join_state&&(this.pending_contacts[t.email]=1);return $super(this.options.contact_filter?this.options.contact_filter(e):e)},createTokenInfo:function(e,t,n){var i,r,o,s,a;return a=!0,r=!1,i=t,s=!1,n===C.FB&&(i=e),n!==C.EMAIL||vt.validate_email(t)?At.call(this.members,t)>=0?(a=!1,i=pt("Already member")):At.call(this.invitees,t)>=0?(a=!1,i=pt("Already invited")):n!==C.EMAIL||this.team_contacts[t]||this.pending_contacts[t]?n===C.FB?(a=this.warn_only,r=!0):n===C.NEW_STYLE_GROUP&&(At.call(this.new_style_groups,t)>=0?(a=!1,i=pt("Already member group")):(a=!0,i=pt("Group"))):(a=this.warn_only,r=!0):a=!1,t!==this.user.email&&t!==this.user.id||(i=pt("You"),a=!this.contacts_only),this.suspended_contacts[t]&&(i=pt("Suspended user"),s=!0),!e&&t&&(e=t.toString()),o={display:e,value:t,type:n,valid:a,external:r,bubble_title:i,suspended:s}},getTokenClass:function(e){return e.valid?e.suspended?"token-warn token-suspended":e.external?"token-warn":"token-valid":"token-error"},notifyExternal:function(e){var t,n,i;return i=e.memo,i.external?(n=this.token_manager.tokens.filter(function(e){return e.info.external}),t=n?n.length:0,this.element.fire("sf:token:external",{count:t})):void 0}});var Rt,At=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};Rt=INLINE_JS.SharingModel=Qe.SharingModel={ALBUM_THUMB_SIZE:260,ALBUM_PADDING:40,THUMBS_BATCH_SIZE:12,SHARING_URL_PREFIXES:["/sh","/scl","/sc"],filename:null,c2d_vars:{},is_folder:!1,is_album:!1,gallery_enabled:!1,gallery_showing:!1,file_viewer_files:[],send_link_autocompleter:null,team_only_shmodel:!1,owner_name:null,account_menu_options:null,sync_vars:{},init:function(e,t){return this.filename=e,this.c2d_url=null!=t?t:"/sm/c2d",this.init_logger(),_(".nav-close").on("click",this.close_embedded_fileviewer.bind(this)),_(function(e){return function(){var t,n,i;return n=$("login-create-an-account"),n&&n.writeAttribute("href","/register?signup_tag=shmodel"),scrollTo(1,0),scrollTo(0,0),_("#download_button_link[data-dl-link]").on("click",e.download_zip),e.set_viewport_size(),t=function(t,n){return e.do_c2d(n.id)},_("#c2d-modal .login-form").on("db:login:success",t),_("#c2d-modal .register-form").on("db:register:success",t),i=Ge.parse(window.location.href),i.getQuery().force_dl?(i.updateQuery({force_dl:0,dl:1}),N.get({url:i.toString(),__do_not_use_expected_domain:Ie.PUBSERVER})):void 0}}(this))},init_folder:function(e,t,n,i,r,o,s,a,l,u,c,d){var h;return this.c2d_vars=e,this.sync_vars=t,null==a&&(a=!1),this.shared_link_infos=null!=l?l:null,this.share_tokens=null!=u?u:null,this.share_permissions=null!=c?c:null,null==d&&(d=null),this.is_folder=!0,this.gallery_enabled=n,this.gallery_showing=i,this.file_viewer_files=r,this.file_view_target=o,this.account_menu_options=d,this.file_view_target===Me.FileViewTargetType.SHARED_CONTENT_LINK?this.file_view_origin=Me.FileViewOriginType.SHARED_CONTENT_LINK_PAGE:this.file_view_origin=Me.FileViewOriginType.SHARED_LINK_PAGE,h=this._get_sharing_url_prefix(),At.call(Rt.SHARING_URL_PREFIXES,h)>=0&&Y.add_callback(h,this._handle_url_change,!0),_(function(e){return function(){return e._open_file_viewer(s),e.load_thumbs(),_("#gallery-toggle").click(function(){return e.switch_mode("gallery")}),_("#list-toggle").click(function(){return e.switch_mode("list")}),_(".file-link").click(function(t){return e._open_file_viewer(_(t.currentTarget).data("mediaIndex"))})}}(this)),o===Me.FileViewTargetType.SHARED_CONTENT_LINK?this._log_scl_ttv():void 0},_get_sharing_url_prefix:function(){var e;return e=window.location.pathname.match(/^(\/s[hc]l?)\//),e?e[1]:""},_handle_url_change:function(e,t){var n;return n=ae.isShown(),n&&!t.preview?ae.close():void 0},_open_file_viewer:function(e){var t,n,i;if(l.isNumber(e)&&!(0>e))return i=Ae.get_viewer(),t=i.is_role_signed_in(Pe.ROLE_WORK)?i.get_user_by_role(Pe.ROLE_WORK):Ae.get_viewer().get_users()[0],n="react-file-viewer",ae.open(this.file_viewer_files,e,t,n,{fileViewTarget:this.file_view_target,fileViewOrigin:this.file_view_origin,fileViewAction:Me.FileViewActionType.CLICK,sharedLinkInfos:this.shared_link_infos,shareTokens:this.share_tokens,sharePermissions:this.share_permissions,accountMenuOptions:this.account_menu_options}),!1},init_album:function(){return this.is_album=!0,this._resize_album_view(),Event.observe(window,"resize",this._resize_album_view.bind(this))},init_file:function(e,t,n){return this.c2d_vars=t,null==n&&(n=!1),this.is_folder=!1,n||this.c2d_vars.subpath||this.c2d_vars.is_package?void 0:this.c2d_vars.subpath="/"+e},init_logger:function(){return _(function(e){return function(){var e;return e=_("#login-hover-link")[0],e&&e.observe("click",function(){return Zn.log(Zn.CLICK_SIGN_IN)}),$("download_button_link")&&Zn.attachLogListener(Zn.CLICK_DOWNLOAD,$("download_button_link")),e=$("add_to_my_dropbox_link"),e&&Zn.attachLogListener(Zn.CLICK_ADD_TO_MY_DROPBOX,e),$$(".remove-link").length&&Zn.attachLogListener(Zn.REMOVE_LINK,$$(".remove-link")[0]),$$(".shmodel-filename").length&&Zn.attachLogListener(Zn.CLICK_FILENAME,$$(".shmodel-filename")[0]),e=$("default_content_download_button"),e&&Zn.attachLogListener(Zn.CLICK_DOWNLOAD,e),e=$("default_content_a2md"),e&&Zn.attachLogListener(Zn.CLICK_ADD_TO_MY_DROPBOX,e),e=_("#login-create-an-account")[0],Zn.attachLogListener(Zn.CLICK_SIGNUP_THRU_DEFAULT_DROPDOWN,e),e=_("#login-hover-cont .login-form")[0],Zn.attachLogListener(Zn.LOGIN_THRU_DEFAULT_DROPDOWN,e),_("#share-button").click(function(e){return Zn.log(Zn.CLICK_SHARE)})}}(this))},_log_scl_ttv:function(){var e,t,n,i,r,o,s;return e=(new Date).getTime(),r=Re.start_time(),t={ns_id:null!=(n=this.sync_vars)?n.sf_id:void 0,timing:e-r},s=Ae.get_viewer().get_users(),s[0]?(o=s[0].id,i=pe.SHARE_ACTION_ORIGIN_TYPE.PREVIEW_PAGE,m.ShareTibEventLogger.log(o,"PREVIEW_RENDER",i,t)):void 0},set_team_only_shmodel:function(e,t){return this.team_only_shmodel=e,this.owner_name=t},_resize_album_view:function(){var e;return e=Math.floor((He.viewport_dimensions().width-2*this.ALBUM_PADDING)/this.ALBUM_THUMB_SIZE)*this.ALBUM_THUMB_SIZE,$("content-wrapper").setStyle({display:"block",width:e+"px"})},load_thumbs:function(){var e,t,n;return n=this.gallery_showing?$$(".gallery-icon-view img"):$$(".browse-files .icon"),t=function(e){return e.src.endsWith(ye.SPACER)||e.addClassName("thumbnail"),Re.mark_time_to_view(),Re.mark_time_to_interactive()},e=te.batch_load_thumbs(n,this.THUMBS_BATCH_SIZE,t),0===e?Re.mark_time_to_interactive():void 0},switch_mode:function(e){var t,n,i,r,o,s,a;for(a=$A(["gallery","list"]),i=0,r=a.length;r>i;i++)s=a[i],n=$(s+"-view-container"),t=$(s+"-toggle"),e===s?(n.show(),t.addClassName("selected")):(n.hide(),t.removeClassName("selected"));return history.replaceState&&(o=window.location.pathname,"list"===e&&(o+="?lst"),history.replaceState({},"",o)),this.gallery_showing=!this.gallery_showing,this.load_thumbs()},set_viewport_size:function(){var e;return $(document.body).hasClassName("mobile")?(e=new Element("meta",{name:"viewport",content:"width = 480"}),document.head.appendChild(e)):void 0},toggle_dropdown:function(e,t,n){var i,r;return e&&Event.extend(e).preventDefault(),t.visible()?void 0:this.is_album?Bt.show(t,n,null,!0):(r=$$(".nav-header").first().getHeight(),i=$$(".nav-header .buttons").first().cumulativeOffset().top-4,0>i&&vt.ie8&&(i=4),Bt.show(t,n,r-i,!0))},prepare_confirm_remove_modal:function(e,t,n,i,r,o,s,a){var l,u,c;return n?(c=pt(i?"Unshare?":"Unshare album?"),l=_("#album-disable-token-modal")[0],wt.fillVal(e.escapeHTML(),"album_unshare_name")):(o?(c=pt("Remove link created by %(name)s").format({name:s}),u=pt("You are removing the link to “%(fname)s” created by <b>%(owner)s</b>.  This link will no longer work for anyone who has it.<br/><br/>We'll notify <b>%(owner_email)s</b>.  Do you want to continue?"),u=u.format({fname:I.em_snippet(e,17),owner:s,owner_email:a})):(c=pt("Delete link to “%(name)s”?").format({name:I.em_snippet(e,17)}),u=pt("This link will no longer work for anyone who has it.")),l=_("#disable-token-modal")[0],wt.fillVal(u,"disable-token-desc")),{title:c,contents:l}},confirm_remove:function(e,t,n,i,r,o,s,a,l,_){var u;return null==n&&(n=!1),null==i&&(i=!1),null==r&&(r=!1),null==o&&(o=null),null==s&&(s=!1),null==a&&(a=null),null==l&&(l=null),null==_&&(_=null),assert(t,"confirm_remove missing tkey"),assert(e,"confirm_remove missing name"),assert(o,"confirm_remove missing user_id"),assert(!s||!i,"admin removal of collections not supported"),assert(!s||a,"missing link owner name for admin removal"),assert(!s||l,"missing link owner email for admin removal"),Ae.get_viewer().is_uid_signed_in(o)?(u=Rt.prepare_confirm_remove_modal(e,n,i,r,o,s,a,l),zt.show(u.title,u.contents,{token:t,name:e,is_album:i,user_id:o,success_callback:_})):void J.show_modal({user_id:o,on_success:function(_){return function(){return _.confirm_remove(e,t,n,i,r,o,s,a,l)}}(this)})},confirm_remove_from_event_gid:function(e,t,n,i,r,o,s,a){var l;return null==r&&(r=!1),null==o&&(o=null),null==s&&(s=null),null==a&&(a=null),assert(t,"confirm_remove missing event gid"),assert(e,"confirm_remove missing name"),assert(i,"confirm_remove missing user_id"),assert(Ae.get_viewer().is_uid_signed_in(i),"user not logged in"),assert(!r||o,"missing link owner name for admin removal"),assert(!r||s,"missing link owner email for admin removal"),l=Rt.prepare_confirm_remove_modal(e,n,!1,!1,i,r,o,s),zt.show(l.title,l.contents,{name:e,user_id:i,activity_log_event_gid_dbase64:t,redirect_to_member_id:a})},do_remove:function(e){var t,n,i;return assert(e.token||e.activity_log_event_gid_dbase64,"missing token or event gid_dbase64"),t=_("#modal-content input").first(),t.attr("disabled",!0),_("#modal-content").addClass("ajax-loading"),i=window.location.pathname,"/links"===i||"/links/your_links"===i||"/recents"===i||i.match("^/home|^/work|^/personal")?new Ajax.DBRequest("/sm/disable/"+e.token,{subject_user:e.user_id,onSuccess:function(t){return function(){var t;return zt.hide(),"function"==typeof e.success_callback&&e.success_callback(),t=pt(e.is_album?"Unshared '%(name)s'":"Deleted link to “%(name)s”"),t=t.format({name:e.name}),Je.success(t),document.fire(M.LINKS_REMOVE,{token:e.token})}}(this),onComplete:function(e){return function(){return t.attr("disabled",!1),_("#modal-content").removeClass("ajax-loading")}}(this)}):(e.token?n=Ge({path:"/sm/disable/"+e.token}):(n=Ge({path:"/sm/disable_by_event_gid/"+e.activity_log_event_gid_dbase64}),n.updateQuery("redirect_to_member_id",e.redirect_to_member_id).toString()),jt.postRequest(n.updateQuery(Pe.UID_PARAM_NAME,e.user_id).toString()))},show_shmodal_onload:function(e,t,n,i){return null==i&&(i=null),_(function(r){return function(){return Y.remove_query_param("m"),Ae.get_viewer().is_uid_signed_in(i)?null!=i&&et.get_for_user(Ae.get_viewer().get_user_by_id(i)).verified_or_show()?r.show_shmodal(e,t,n,i):null==i?(assert(Ae.get_viewer().is_paired,"Expected viewer to be paired."),
r.show_share_shmodel_role_chooser(e,t,n)):void 0:void J.show_modal({user_id:i,on_success:function(){return r.show_shmodal_onload(e,t,n,i)}})}}(this))},show_shmodal:function(t,n,i,r){var o,s,a,l,u,c,d,h,m,p;if(this.url=t,this.short_url=n,!Ae.get_viewer().is_uid_signed_in(r))return void J.show_modal({user_id:r,on_success:function(e){return function(){return e.show_shmodal(e.url,e.short_url,i,r)}}(this)});if(p=Ae.get_viewer().get_user_by_id(r),et.get_for_user(p).verified_or_show()){if(h="shmodal-user-"+r,zt.show(this._get_shmodal_title(p.is_team),wt.fromElm($(h))),u={},u[Pe.UID_PARAM_NAME]=r,jt.add_vars("shmodal-send-form",u),this._get_thumbnail_type())for(m=$$(".shmodal-image"),c=0,d=m.length;d>c;c++)l=m[c],l.addClassName("thumbnail");return a="contacts"===i?Autocompleter.ContactsTokenizer:Autocompleter.TeamTokenizer,this.send_link_autocompleter=new a(p,h+"-new-collab-input",h+"-new-whobulk",h+"-hidden-input",{tokens:[",",";"],include_fb:!0,include_team:!0,team_only:"team_only"===i,user_id:r}),this.configure_dropdown(),this.disabled||(e.installed?(o=b.clipboard_overlay(this.url,_("#"+h+"-copy-link"),Rt.copied_to_clipboard),o.css({position:"fixed",zIndex:1001}),o.children().height(o.height()),clearInterval(this.follow_freshbutton),s=function(e){return function(){return He.clone_position(o,_("#"+h+"-copy-link"),{offsetHeight:6,offsetWidth:6})}}(this),this.follow_freshbutton=setInterval(s,500)):$(h+"-copy-link").hide()),Ht._create($("modal").down(".custom-message-container")),Ht._create($("modal").down(".fb-post-sickinput")),Ht._create($("modal").down(".twitter-post-sickinput")),this._populate_twitter_info(this.short_url,r),$(h+"-new-collab-input").focus(),Zn.log("shmodal_show")}},configure_dropdown:function(){var e,t,n,i,r;for(i=$$(".dropdown-menu-container"),t=0,n=i.length;n>t;t++)e=i[t],r=e.down(".dropdown-menu-trigger"),null!=r&&r.observe("click",function(e){return function(e){var t;return t=e.target.up(".dropdown-menu-container"),t.toggleClassName("dropdown-shown")}}(this));return document.on("click",function(e){return function(e){var t,n,i,r,o;if(!e.target.hasClassName("dropdown-menu-trigger")&&!e.target.up(".dropdown-menu-trigger")){for(r=$$(".dropdown-shown"),o=[],n=0,i=r.length;i>n;n++)t=r[n],o.push(t.removeClassName("dropdown-shown"));return o}}}(this))},copied_to_clipboard:function(){return Je.success(pt("Link copied to clipboard")),zt.hide(),Zn.log("shmodal_copy_link"),m.ViralLogger.log(Ae.get_viewer().get_user_ids(),"shmodel","send",{src:"shmodel_copy_link",file_type:Rt.is_album?"collection":Rt.is_folder?"folder":-1===Rt.filename.indexOf(".")?"file":Fn.EXTENSION_TO_CATEGORY[U.file_extension(Rt.filename).toLowerCase()]||"file"})},get_shmodel_send_recipients:function(e){var t,n,i,r,o,s,a,l,_,u,c,d,h;for(assert(e,"Must pass the shmodal send form into get_shmodel_send_recipients"),t=e.select('input[name="emails"]'),n=e.select('input[name="fb_ids"]'),i=e.select('input[name="group_ids"]'),u=e.select('input[name="new_style_group_ids"]'),d=[],h=[t,n,i,u],r=0,l=h.length;l>r;r++)for(s=h[r],a=0,_=s.length;_>a;a++)o=s[a],c=o.up().innerHTML.stripTags().escapeHTML(),d.push(c.substring(0,c.indexOf("&")));return d},close_embedded_fileviewer:function(e){var t;return e.preventDefault(),t=new q,t.configureParentMessaging(function(){},["parent-ready"]),t.startListening(),t.postMessageToParent("close-fileviewer")},send_shmodel_link:function(e){var t,n,i,r;return t=$("shmodal-send-form"),assert(t,"Couldn't find the shmodal send form."),r=this.get_shmodel_send_recipients(t),i=function(e){return function(e){var t;return t=Et.success_string_for_recipients(r),Je.success(t),zt.hide(),Zn.log("shmodal_send")}}(this),n=function(e){return function(e){return jt.remove_loading()}}(this),jt.ajax_submit(t,"/sm/share",i,n,t.down(".tokenizer-submit-button"))},show_content:function(e){var t,n,i,r;for($("shmodal-title-text").__date(Nt.to_title_str(e)),i=Nt.list,t=0,n=i.length;n>t;t++)r=i[t],r!==e&&($(Nt.to_toggle_str(r)).removeClassName("toggled"),$(Nt.to_content_str(r)).hide());return $(Nt.to_content_str(e)).show(),$(Nt.to_toggle_str(e)).addClassName("toggled"),_("#modal .focusarea").focus()},show_send_content:function(){return this.show_content(Nt.SEND)},show_fb_content:function(){return this.show_content(Nt.FB)},show_twitter_content:function(){return this.show_content(Nt.TWITTER)},start_fb_post:function(e,t){var n,i,r,o;return i=function(n){return function(){return x.do_auth(n.do_fb_post.curry(e,t),t)}}(this),n=_("#modal:visible, #modal-overlay:visible"),r=function(){return n.show()},x.authed_user_id===t?this.do_fb_post(e,t):Ae.get_viewer().is_uid_associated(x.authed_user_id)?(n.hide(),o=new k(Ae.get_viewer().get_user_by_id(t),r,i.bind(this)),o.show()):i()},start_twitter_post:function(e){return Gn.is_authed(e)?this.do_twitter_post(e):Gn.do_auth(this.do_twitter_post,e)},do_fb_post:function(e,t){return x.custom_show_posting=function(){return jt.add_loading($("shmodal-fb-post-submit"))},x.custom_show_complete=function(){return zt.hide(),Je.success(pt("Successfully posted to Facebook")),Zn.log("shmodal_fb_post"),m.ViralLogger.log(Ae.get_viewer().get_user_ids(),"shmodel","send",{src:"shmodel_fb_post",file_type:Rt.is_album?"collection":Rt.is_folder?"folder":-1===Rt.filename.indexOf(".")?"file":Fn.EXTENSION_TO_CATEGORY[U.file_extension(Rt.filename).toLowerCase()]||"file"})},x.post($F("shmodal-fb-post-input"),e,null,null,null,function(){return zt.hide()},t)},do_twitter_post:function(e){var t;return(t=$F("shmodal-twitter-post-input"))?t.length>140?void Je.error(pt("Your post must be 140 characters or less")):(Gn.custom_show_posting=function(){return $("twitter-chars").hide(),jt.add_loading($("shmodal-twitter-post-submit"))},Gn.custom_post(t,function(e){return function(){return zt.hide(),Je.success(pt("Successfully posted to Twitter")),Zn.log("shmodal_tweet"),m.ViralLogger.log(Ae.get_viewer().get_user_ids(),"shmodel","send",{src:"shmodel_twitter",file_type:Rt.is_album?"collection":Rt.is_folder?"folder":-1===Rt.filename.indexOf(".")?"file":Fn.EXTENSION_TO_CATEGORY[U.file_extension(Rt.filename).toLowerCase()]||"file"})}}(this),e)):void Je.error(pt("Please enter a Twitter post"))},_get_shmodal_title:function(e){return null==e&&(e=!1),this.generate_title_content(this._get_shmodal_title_text(),function(e){return function(){return e.show_send_content()}}(this),function(e){return function(){return e.show_fb_content()}}(this),function(e){return function(){return e.show_twitter_content()}}(this),e)},generate_title_content:function(e,t,n,i,r){var o,s,a,l,u,c;return null==r&&(r=!1),l=_("<div/>",{id:"shmodal-title"}),u=_("<div/>",{id:"shmodal-title-text",text:e}),l.append(u),r||(a=_("<a/>",{id:"shmodal-send-toggle",class:"freshtoggle ft-left toggled"}),a.html(ye.make("web","email_20")),a.on("click",t),s=_("<a/>",{id:"shmodal-fb-toggle",class:"freshtoggle ft-middle"}),s.html(ye.make("web","fb_20")),s.on("click",n),c=_("<a/>",{id:"shmodal-twitter-toggle",class:"freshtoggle ft-right"}),c.html(ye.make("web","twitter_20")),c.on("click",i),l.append([a,s,c])),o=_("<div/>",{class:"clear"}),l.append(o),l[0]},_get_shmodal_title_text:function(){var e,t;return this.is_folder?(e=pt("Share link to ‘%(folder_name)s’"),e=e.format({folder_name:I.em_snippet(this.filename,15)})):(t=this._get_thumbnail_type(),t===Fn.CATEGORY_TO_TRANSLATION.IMAGE?pt("Share this image"):t===Fn.CATEGORY_TO_TRANSLATION.VIDEO?pt("Share this video"):pt("Share '%(filename)s'").format({filename:I.em_snippet(this.filename,18)}))},_get_thumbnail_type:function(){var e,t;return-1===this.filename.indexOf(".")?!1:(t=U.file_extension(this.filename).toLowerCase(),e=Fn.EXTENSION_TO_CATEGORY[t],!e||"IMAGE"!==e&&"VIDEO"!==e?!1:Fn.CATEGORY_TO_TRANSLATION[e])},_populate_twitter_info:function(e,t){var n,i;return n=this.is_folder?pt("Just shared some files using @Dropbox"):(i=this._get_thumbnail_type(),pt(i&&i===Fn.CATEGORY_TO_TRANSLATION.IMAGE?"Just shared an image using @Dropbox":"Just shared a file using @Dropbox")),$("shmodal-twitter-post-input").setValue(n+" "+e),vt._track_twitter_chars_left("shmodal-twitter-post-input",140),Gn.is_authed(t)?Gn.get_user_info(function(e){return $("shmodal-twitter-profile").down(".profile-pic").__date(new Element("img",{src:e.profile_image_url_https})),$("shmodal-twitter-profile").down(".name").__date(e.name),$("shmodal-twitter-profile").down(".username").__date("@"+e.screen_name),$("modal").down(".twitter-post-sickinput").addClassName("shrank"),$("shmodal-twitter-profile").show()},t):void 0},download_zip:function(e){var t,n,i,r,o;return t=_("#download_button_link").attr("data-dl-link"),o=_("#download_button_link").attr("data-test-link"),r="true"===_("#download_button_link").attr("data-owner"),i=function(e){return function(e){var n;return"OK"===e?window.location=t:0===e.indexOf("err:")?(n=pt(r?"The zip file is too large.":"The zip file is too large. Please add it to your Dropbox."),Je.error(n)):Je.error(pt("Failed to download zip file.")),!1}}(this),n=function(e){return function(e){return Je.error(pt("Failed to download zip file.")),!1}}(this),o&&_.support.cors===!0?h.SilentBackgroundRequest({url:o,success:i,error:n}):window.location=t,!1},show_share_shmodel_role_chooser:function(e,t,n){return null==this.shmodel_select_role_modal&&(this.shmodel_select_role_modal=new vn({element_id:"share-shmodel-select-role-modal",link_url:e,short_url:t,tokenizer_type:n})),this.shmodel_select_role_modal.show().set_title(this._get_shmodal_title_text())},prompt_login_then_share:function(e,t,n,i){var r;return r=function(r){return function(){var r;return zt.hide(),_("#role-selector option").removeClass("disabled"),r=Ae.get_viewer().get_uid_by_role(i),Ae.get_viewer().sign_in_user_by_id(r),m.ShmodelUILogger.log("via-shmodel-viewer"),Rt.show_shmodal(e,t,n,r)}}(this),Ae.get_viewer().is_role_signed_in(i)?r():J.show_modal({role:i,on_success:r})},show_c2d_modal:function(e,t){var n,i,r,o,s;if(null==e&&(e=""),null==t&&(t=!1),e){if(e===Pe.ROLE_PERSONAL&&assert("forbid"!==this.team_only_shmodel,"Can't copy to personal Dropbox if restricted"),!Ae.get_viewer().is_role_signed_in(e))return void J.show_modal({role:e,on_success:function(t){return function(){return t.show_c2d_modal(e)}}(this)})}else if(Ae.get_viewer().is_paired)return void new gn({element_id:"select-role-modal"}).show();return m.WebMiscActivityLogger.log("show-c2d-modal",{filename:this.filename,auth_google:null!=_.find(".auth-google")}),o=e?"#c2d-modal-"+e:"#c2d-modal",s=this._c2d_modal_msg(e,Ae.get_viewer().team_name),n=this._c2d_modal_button_msg(e,Ae.get_viewer().team_name),i=this._c2d_modal_desc(e,Ae.get_viewer().team_name),t&&(i=this._c2d_modal_team_only_desc(Ae.get_viewer().team_name)+"<br/><br/>"+i),r=this._c2d_modal_login_desc(e,Ae.get_viewer().team_name),wt.fillVal(i,"c2d-desc"),wt.fillVal(r,"c2d-login-desc"),_(".c2d-submit-button").val(n),_(".c2d-login-register-desc").hide(),this.is_album?_(".c2d-login-register-album-desc").show():this.is_folder?_(".c2d-login-register-folder-desc").show():_(".c2d-login-register-file-desc").show(),zt.show(s,_(o)[0],!1,!1,!1,!1)},_c2d_modal_msg:function(e,t){var n,i;return null==e&&(e=""),null==t&&(t=""),this.c2d_vars.title?i=this.c2d_vars.title:e===Pe.ROLE_PERSONAL?(i=pt("Save '%(filename)s' to my personal Dropbox"),i.format({filename:I.em_snippet(this.filename,10)})):e===Pe.ROLE_WORK?(i=pt("Save '%(filename)s' to my %(team_name)s Dropbox"),n=Math.max(10,15-new I(t).length),i.format({filename:I.em_snippet(this.filename,n),team_name:t})):(i=pt("Save '%(filename)s' to my Dropbox"),i.format({filename:I.em_snippet(this.filename,15)}))},_c2d_modal_button_msg:function(e,t){var n;return null==e&&(e=""),null==t&&(t=""),e===Pe.ROLE_PERSONAL?n=pt("Save to my personal Dropbox"):e===Pe.ROLE_WORK?(n=pt("Save to my %(team_name)s Dropbox"),n.format({team_name:t})):pt("Save to my Dropbox")},_c2d_modal_team_only_desc:function(e){var t;return t=pt(this.is_album?"You can only add this album to your <b>%(team_name)s Dropbox</b> because <b>%(owner_name)s</b> has restricted the album to members of <b>%(team_name)s</b>.":this.is_folder?"You can only add this folder to your <b>%(team_name)s Dropbox</b> because <b>%(owner_name)s</b> has restricted the folder to members of <b>%(team_name)s</b>.":"You can only add this file to your <b>%(team_name)s Dropbox</b> because <b>%(owner_name)s</b> has restricted the file to members of <b>%(team_name)s</b>."),t.format({owner_name:this.owner_name,team_name:e})},_c2d_modal_desc:function(e,t){var n;return null==e&&(e=""),null==t&&(t=""),e===Pe.ROLE_PERSONAL?this.is_album?"warn"===this.team_only_shmodel?(n=pt("The photos and videos in this album were sent from <b>%(owner_name)s</b> on your <b>%(team_name)s</b> team.  Are you sure you want to copy them to your personal Dropbox?"),n.format({owner_name:this.owner_name,team_name:t})):n=pt("The photos and videos in this album will be instantly saved to your personal Dropbox and downloaded to all the computers linked to your personal account."):this.is_folder?"warn"===this.team_only_shmodel?(n=pt("This folder was sent from <b>%(owner_name)s</b> on your <b>%(team_name)s</b> team.  Are you sure you want to copy it to your personal Dropbox?"),n.format({owner_name:this.owner_name,team_name:t})):n=pt("This folder will be instantly saved to your personal Dropbox and downloaded to all the computers linked to your personal account."):"warn"===this.team_only_shmodel?(n=pt("This file was sent from <b>%(owner_name)s</b> on your <b>%(team_name)s</b> team.  Are you sure you want to copy it to your personal Dropbox?"),n.format({owner_name:this.owner_name,team_name:t})):n=pt("This file will be instantly saved to your personal Dropbox and downloaded to all the computers linked to your personal account."):e===Pe.ROLE_WORK?(n=pt(this.is_album?"The photos and videos in this album will be instantly saved to your %(team_name)s Dropbox and downloaded to all the computers linked to your %(team_name)s account.":this.is_folder?"This folder will be instantly saved to your %(team_name)s Dropbox and downloaded to all the computers linked to your %(team_name)s account.":"This file will be instantly saved to your %(team_name)s Dropbox and downloaded to all the computers linked to your %(team_name)s account."),n.format({team_name:t})):pt(this.is_album?"The photos and videos in this album will be instantly saved to your Dropbox and downloaded to all the computers linked to your account.":this.is_folder?"This folder will be instantly saved to your Dropbox and downloaded to all the computers linked to your account.":"This file will be instantly saved to your Dropbox and downloaded to all the computers linked to your account.")},_c2d_modal_login_desc:function(e,t){var n;return null==e&&(e=""),null==t&&(t=""),e===Pe.ROLE_PERSONAL?n=pt(this.is_album?"Once you sign in to your personal Dropbox, the photos and videos in this album will be instantly saved to your personal Dropbox and downloaded to all the computers linked to your personal account.":this.is_folder?"Once you sign in to your personal Dropbox, this folder will be instantly saved to your personal Dropbox and downloaded to all the computers linked to your personal account.":"Once you sign in to your personal Dropbox, this file will be instantly saved to your personal Dropbox and downloaded to all the computers linked to your personal account."):e===Pe.ROLE_WORK?(n=pt(this.is_album?"Once you sign in to your %(team_name)s Dropbox, the photos and videos in this album will be instantly saved to your %(team_name)s Dropbox and downloaded to all the computers linked to your %(team_name)s account.":this.is_folder?"Once you sign in to your %(team_name)s Dropbox, this folder will be instantly saved to your %(team_name)s Dropbox and downloaded to all the computers linked to your %(team_name)s account.":"Once you sign in to your %(team_name)s Dropbox, this file will be instantly saved to your %(team_name)s Dropbox and downloaded to all the computers linked to your %(team_name)s account."),n.format({team_name:t})):void 0},do_c2d:function(e){var t;return assert(e,"Must specify a user_id for saving to Dropbox."),t=pt("Saving to your Dropbox..."),Ae.get_viewer().is_paired&&(Ae.get_viewer().get_user_by_id(e).is_team?(t=pt("Saving to your %(team_name)s Dropbox..."),t=t.format({team_name:Ae.get_viewer().team_name})):t=pt("Saving to your personal Dropbox...")),Je.success(t),zt.hide(),new Ajax.DBRequest(this.c2d_url,{parameters:this.c2d_vars,job:this.is_folder,progress_text:t,subject_user:e,onSuccess:function(e){return function(e){return e.responseText?Be.redirect(e.responseText):void 0}}(this)})},request_shared_folder_sync:function(e){var t;return null==e&&(e=""),t=pe.SHARE_ACTION_ORIGIN_TYPE.PREVIEW_PAGE,we.mountSharedFolder(this.sync_vars.sf_id,e,t)}};var Nt;Nt=Qe.ShmodalPanes={SEND:0,FB:1,TWITTER:2,list:[0,1,2],_content_str:["shmodal-send-content","shmodal-fb-content","shmodal-twitter-content"],_toggle_str:["shmodal-send-toggle","shmodal-fb-toggle","shmodal-twitter-toggle"],_title_str:["Share by Email",pt("Share on Facebook"),pt("Share on Twitter")],to_content_str:function(e){return this._content_str[e]},to_toggle_str:function(e){return this._toggle_str[e]},to_title_str:function(e){return 0===e?Rt._get_shmodal_title_text():this._title_str[e]},to_focus_str:function(e){return this._focus_str[e]}};var It,$t,Ot=function(e,t){return function(){return e.apply(t,arguments)}},Lt=function(e,t){function n(){this.constructor=e}for(var i in t)Mt.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},Mt={}.hasOwnProperty;It=INLINE_JS.ShareLinkModal=Qe.ShareLinkModal=function(e){function t(e,n,i,r,o){var s,a;this.user_id=e,null==r&&(r=!1),null==o&&(o=void 0),this.before_show=Ot(this.before_show,this),this.show=Ot(this.show,this),this.prompt_login_then_show=Ot(this.prompt_login_then_show,this),m.LegacySharingVortexLogger.log("construct-share-link-modal"),a={origin:i},a[Pe.UID_PARAM_NAME]=this.user_id,s=o?Ge({path:"/sm/get_link_modal_content/"+o}).toString():Ge({path:"/sm/share_link"+n}).toString(),t.__super__.constructor.call(this,{element_id:"share-link-modal",endpoint_url:s,parameters:a})}return Lt(t,e),t.prototype.prompt_login_then_show=function(){var e;return e=function(e){return function(){return zt.hide(),_("#role-selector option").removeClass("disabled"),Ae.get_viewer().sign_in_user_by_id(e.user_id),m.ShmodelUILogger.log("via-shmodel-viewer"),e.show()}}(this),Ae.get_viewer().is_uid_signed_in(this.user_id)?e():J.show_modal({user_id:this.user_id,on_success:e})},t.prototype.show=function(){var e;return m.LegacySharingVortexLogger.log("show-share-link-modal"),e=Ae.get_viewer().get_user_by_id(this.user_id),et.get_for_user(e).verified_or_show(d.SHMODAL)?t.__super__.show.call(this):void 0},t.prototype.before_show=function(){var e,t,n,i;return i=this.$modal_window.find(".share-link-modal-content").length,i?(e={class:"ajax-loading-indicator",src:"/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif",alt:pt("Loading...")},n=_("<img />",e),t=_("<div />",{class:"loading-spinner"}).append(n),this.$modal_window.find(".dynamic-content").html(t)):void 0},t}(A),$t=Qe.ShareLinkModalContent=function(){function e(e,t,n,i,r,o,s,a,l,u,c){var d,h;this.owner_id=e,this.tkey=t,this.fq_path=n,this.link=i,this.filename=r,this.is_dir=o,this.tokenizer_type=s,this.tokenizer_ctx_str=a,this.is_restricted_to_members=l,this.fq_path_of_restricting_sf=c,this._send_link=Ot(this._send_link,this),this._show_shared_link_remove_confirm_modal=Ot(this._show_shared_link_remove_confirm_modal,this),this._show_shared_folder_settings_modal=Ot(this._show_shared_folder_settings_modal,this),this._select_all_text=Ot(this._select_all_text,this),this._toggle_send_link_button=Ot(this._toggle_send_link_button,this),this._toggle_recipients_outside_team_warning=Ot(this._toggle_recipients_outside_team_warning,this),this._toggle_close_button_text=Ot(this._toggle_close_button_text,this),this._mark_onboarding_as_seen=Ot(this._mark_onboarding_as_seen,this),this._add_message_checkbox_changed=Ot(this._add_message_checkbox_changed,this),this._toggle_comment_option=Ot(this._toggle_comment_option,this),this._listen=Ot(this._listen,this),this._init_autocompleter=Ot(this._init_autocompleter,this),this.$content=_(".share-link-modal-content"),this.modal=it.get_containing_modal(this.$content),this.modal&&("shared_folder"===this.tokenizer_type&&(this.shared_folder_members=E.create_contacts_list(u)),h={filename:this.filename,fq_path:this.fq_path,tkey:this.tkey,user_id:this.owner_id},document.fire(M.LINKS_ADD,h),_(document).trigger(M.LINKS_ADD,h),this.modal.set_title(pt("Share link to ‘%(filename)s’").format({filename:I.em_snippet(this.filename,15)})),this.collab_input_id=this.tokenizer_ctx_str+"-new-collab-input",this.$collab_input=this.$content.find("#"+this.collab_input_id),this.$send_link_button=this.$content.find(".confirm-button"),this.$share_link_url_input=this.$content.find(".copy-link-input-container input[type='text']"),this.$cancel_button=this.$content.find(".cancel-button"),this.$custom_message_textarea=this.$content.find("#share-link-modal-custom-message"),this.$comment_option_container=this.$content.find(".add-message-as-comment-container"),this._init_autocompleter(),this._listen(),null!=(d=this.$share_link_url_input[0])&&d.select())}return e.prototype._init_autocompleter=function(){var e,t;return e={tokens:[",",";"],include_fb:!0,include_team:!0,team_only:"team_only"===this.tokenizer_type,user_id:this.owner_id},"shared_folder"===this.tokenizer_type?this.autocompleter=new Autocompleter.SharedFolderTokenizer(Ae.get_viewer().get_user_by_id(this.owner_id),this.collab_input_id,this.tokenizer_ctx_str+"-new-whobulk",this.tokenizer_ctx_str+"-hidden-input",e,this.shared_folder_members):"contacts"===this.tokenizer_type?this.autocompleter=new Autocompleter.ContactsTokenizer(Ae.get_viewer().get_user_by_id(this.owner_id),this.collab_input_id,this.tokenizer_ctx_str+"-new-whobulk",this.tokenizer_ctx_str+"-hidden-input",e):this.autocompleter=new Autocompleter.TeamTokenizer(Ae.get_viewer().get_user_by_id(this.owner_id),this.collab_input_id,this.tokenizer_ctx_str+"-new-whobulk",this.tokenizer_ctx_str+"-hidden-input",e),t=function(e){return function(t){return function(){return e.autocompleter.contact_search_logger.log_records(e.owner_id,t)}}}(this),this.modal.logger_keydown_close_handler=t(!0),this.modal.$overlay.on("click",t(!0)),this.modal.$db_modal_x.on("click",t(!0)),this.$send_link_button.on("click",t(!1)),this.$cancel_button.on("click",t(!0)),Ht.init(),this.$collab_input.focus()},e.prototype._listen=function(){var e,t,n,i,r,o,s;return this.$send_link_button.on("click",this._send_link),this.$share_link_url_input.on("click",this._select_all_text),this.$cancel_button.on("click",function(e){return function(e){return rt.pop()}}(this)),this.$content.find("#shared-folder-options-link").on("click",this._show_shared_folder_settings_modal),this.$content.find("#shared-link-delete-link").on("click",this._show_shared_link_remove_confirm_modal),this.$comment_option_container.length>0&&(this.$custom_message_textarea.on("input",this._toggle_comment_option),this.$comment_option_container.find("#add-message-as-comment").on("change",this._add_message_checkbox_changed),e=this.$comment_option_container.find(".bubble-dropdown-x"),e.length>0&&e.on("click",this._mark_onboarding_as_seen)),null!=(t=this.$collab_input)&&t.keyup(this._toggle_send_link_button),null!=(n=this.$collab_input)&&n.on("input",this._toggle_send_link_button),null!=(i=this.$collab_input[0])&&i.observe("token:remove",this._toggle_send_link_button),null!=(r=this.$collab_input[0])&&r.observe("token:add",this._toggle_close_button_text),null!=(o=this.$collab_input[0])&&o.observe("token:remove",this._toggle_close_button_text),null!=(s=this.$collab_input[0])?s.observe("sf:token:external",this._toggle_recipients_outside_team_warning):void 0},e.prototype._toggle_comment_option=function(e){var t;return t=this.$custom_message_textarea.val().length,t>0?this.$comment_option_container.css("visibility","visible"):this.$comment_option_container.css("visibility","hidden")},e.prototype._add_message_checkbox_changed=function(e){return h.SilentBackgroundRequest({url:"/file_activity/set_share_modal_checkbox_preference",data:{fq_path:this.fq_path,checked:e.currentTarget.checked},subject_user:this.owner_id})},e.prototype._mark_onboarding_as_seen=function(e){return h.SilentBackgroundRequest({url:"/file_activity/has_seen_add_message_as_comment_onboarding",data:{fq_path:this.fq_path},subject_user:this.owner_id})},e.prototype._toggle_close_button_text=function(e){var t,n;return n=0===(null!=(t=this.autocompleter)?t.token_manager.tokens.length:void 0),n?this.$cancel_button.text(pt("Close")):this.$cancel_button.text(pt("Cancel"))},e.prototype._toggle_recipients_outside_team_warning=function(e){var t,n;return t=_(".external-recipient-warning-message"),t.length?(n=e.memo.count,e.memo.shared_folder_warning?n>0?t.show():t.hide():n>1?(t.find(".external-recpient-num").text(n),t.removeClass("single").show()):1===n?t.addClass("single").show():t.hide()):void 0},e.prototype._toggle_send_link_button=function(e){var t,n;return n=0===(null!=(t=this.autocompleter)?t.token_manager.tokens.length:void 0),n=n&&""===_.trim(this.$collab_input.val()),this.$send_link_button.prop("disabled",n)},e.prototype._select_all_text=function(e){return _(e.currentTarget)[0].select()},e.prototype._show_shared_folder_settings_modal=function(e){var t;return e.preventDefault(),t=Ae.get_viewer().get_user_by_id(this.owner_id),dt(t,{fqPath:this.fq_path_of_restricting_sf,isFolder:!0,origin:"SHARE_LINK_MODAL"}),rt.pop()},e.prototype._show_shared_link_remove_confirm_modal=function(e){var t;return e.preventDefault(),t=function(e){return function(){return rt.pop(),_(document).trigger(M.LINKS_REMOVE,{fq_path:e.fq_path})}}(this),Rt.confirm_remove(this.filename,this.tkey,this.is_dir,!1,!1,this.owner_id,!1,null,null,t)},e.prototype._send_link=function(e){var t,n,i,r,o;return i=this.$content.find(".share-link-modal-send-form")[0],r=this.get_shmodel_send_recipients(i),o=function(e){return function(e){var t;return t=Et.success_string_for_recipients(r),Je.success(t),rt.pop(),Zn.log("shmodal_send")}}(this),n=function(e){return function(e){return jt.remove_loading()}}(this),t=this.$content.find(".tokenizer-submit-button")[0],jt.ajax_submit(i,"/sm/share",o,n,t)},e.prototype.get_shmodel_send_recipients=function(e){var t,n,i,r,o,s,a,l,_,u,c,d,h;for(assert(e,"Must pass the shmodal send form into get_shmodel_send_recipients"),t=e.select('input[name="emails"]'),n=e.select('input[name="fb_ids"]'),i=e.select('input[name="group_ids"]'),u=e.select('input[name="new_style_group_ids"]'),d=[],h=[t,n,i,u],r=0,l=h.length;l>r;r++)for(s=h[r],a=0,_=s.length;_>a;a++)o=s[a],c=o.up().innerHTML.stripTags().escapeHTML(),d.push(c.substring(0,c.indexOf("&")));return d},e}();var Ut;Ut=INLINE_JS.FileOps=Qe.FileOps={do_folder_restore:function(e,t){var n;return n=function(t){var n,i;return n=pt("Restoring '%(folder_name)s'").format({folder_name:U.filename(e)}),i=t.responseText,i.startsWith("err:")?(i=i.substring(4),_("#async-result").html(i),Je.error(new We(i),60)):(n=pt("Restored '%(folder_name)s'").format({folder_name:U.filename(e)}),_("#status-of-files").text(pt("Restored files")),Je.success(n,60)),_("#restore-done-heading").text(n),_(".pre-restore").hide(),_(".post-restore").show()},new Ajax.DBRequest("/cmd/restore",{parameters:{files:[e]},job:!0,html_in_error_msg:!0,progress_text:pt("Restoring..."),onSuccess:n,onFailure:n,subject_user:t})}};var jt,Mt={}.hasOwnProperty;jt=INLINE_JS.Forms=Qe.Forms={submitOnlyOnce:function(){var e;return e=jt.submitted!==!0,jt.submitted=!0,e},disable:function(e){return e?setTimeout(function(){return e.disabled=!0},0):void 0},enable:function(e){return e?setTimeout(function(){return e.disabled=!1},0):void 0},_button_on_change:function(e,t,n,i){var r,o,s,a;return r=_(e),r[t](),null==i&&(i=r.closest("form")),o=i[0],null==this.next_id&&(this.next_id=0),s=this.next_id++,null==this.initial_vars&&(this.initial_vars={}),this.initial_vars[s]=this.collect_form_vars(o),r.attr("data-id",s),i.data("button-id",s),a=function(e){return function(){var i,a,l;r[t](),a=e.collect_form_vars(o),Object.keys(a).length!==Object.keys(e.initial_vars[s]).length&&r[n](),l=[];for(i in a)a[i]!==e.initial_vars[s][i]?l.push(r[n]()):l.push(void 0);return l}}(this),i.change(a),i.find("input").filter(":text").on("input",a),i.find("textarea").on("input",a)},show_button_on_change:function(e,t){return this._button_on_change(e,"hide","show",t)},hide_button_on_change:function(e,t){return this._button_on_change(e,"show","hide",t)},add_vars:function(e,t){var n,i,r;e=$(e),r=[];for(i in t)Mt.call(t,i)&&(n=new Element("input",{type:"hidden",name:i}),n.setValue(t[i]),r.push(e.__sert(n)));return r},collect_form_vars:function(e,t){var n,i,r,o,s,a;for(null==t&&(t=!1),e=e||$(document.body),i=e.select("input").concat(e.select("textarea")).concat(e.select("select")),s={},r=0,o=i.length;o>r;r++)n=i[r],n.name&&"t"!==n.name&&!_(n).attr("data-ignore-var")&&(a=n.getValue(),(a||t)&&("string"!=typeof a&&(a=a.join(",")),null!=s[n.name]?"string"==typeof s[n.name]?s[n.name]=[s[n.name],a]:s[n.name].push(a):s[n.name]=a));return s},add_loading:function(e,t){var n;return e?(e=$(e),n=new Element("img",{src:"/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif"}),n.addClassName("text-img ajax_submit_loading"),"after"===t?_(e).after(n):_(e).before(n)):void 0},remove_loading:function(e){return _(".ajax_submit_loading").remove()},ui_form_submit:function(e,t){return t=t||e.action,e.ajax_submitted?!1:(e.ajax_submitted=!0,new Te(_(e),t,{data:jt.collect_form_vars(e),success:function(t){return function(n,i,r){var o,s;return s=_(e).data("button-id"),null!=s?(o=_(e).find("*[type='submit'][data-id='"+s+"']"),t.initial_vars[s]=t.collect_form_vars(e),o.hide()):void 0}}(this),complete:function(t){return function(t,n){return e.ajax_submitted=!1}}(this)}))},ajax_submit_obj:function(e){var t,n,i,r,o,s,a,l,_,u,c;return r=e.form,c=e.url,u=e.success_callback,i=e.fail_callback,t=e.button,a=e.more_vars,l=e.position,s=e.job,o=e.html_response,n=e.complete_callback,_=e.progress_text,jt.ajax_submit(r,c,u,i,t,a,l,s,o,n,_)},ajax_submit:function(e,t,n,i,r,o,s,a,l,u,c){var d,h,m,p,f;if(null==l&&(l=!1),e.ajax_submitted)return!1;for(e.ajax_submitted=!0,f=_(e).find(".suggestion-input"),h=0,m=f.length;m>h;h++)d=f[h],Kt.blank(d.identify())();return r&&jt.add_loading(r,s),p=jt.collect_form_vars(e),o&&Object.extend(p,o),new Ajax.DBRequest(t||e.action,{noAutonotify:!0,parameters:p,job:a,progress_text:c,evalJSON:!1,onSuccess:function(e){return jt.remove_loading(),n&&"function"==typeof n?n(e):void 0},onFailure:function(t){var n,r;return t&&(0===t.responseText.indexOf("err:")?(n=t.responseText.substr(4),0===n.indexOf("{")?(r=n.evalJSON(!0),jt.fill_errors(e,r)):(l&&(n=new We(n)),Je.error(n))):Je.error(),jt.remove_loading(),i&&"function"==typeof i)?i(t):void 0},onComplete:function(t){var n,i,r;for(r=e.select(".suggestion-input"),n=0,i=r.length;i>n;n++)d=r[n],Kt.blur_elm(d);return e.ajax_submitted=!1,u&&"function"==typeof u?u(t):void 0}}),!1},clear_errors:function(e){return e=e||$(document.body),this.hide_errors(e),e.select(".error-removable").invoke("remove")},fill_errors:function(e,t){var n,i,r,o,s,a;t=t||{},e=e||$(document.body),jt.clear_errors(e);for(s in t)Mt.call(t,s)&&(i=e.down("[data-error-field-name='"+s+"']")||e.down("[name='"+s+"']"),i&&(n=new Element("br",{class:"error-removable"}),r=new Element("span",{class:"error-message error-removable"}),o=t[s],assert(o.message_html||o.message_text,"Error message must have a message_html or message_text property"),o.message_html?r.update(o.message_html):r.__date(o.message_text),_(i).before(r),_(i).before(n),a=_(e).find("input[name='"+s+"'], textarea[name='"+s+"']"),a&&a.addClass("input-error")));return this.show_errors(e)},value:function(e){var t,n,i,r,o;for(i=$$('input[name="'+e+'"]'),o=null,t=0,r=i.length;r>t;t++)n=i[t],o=$(n).getValue()||o;return o},postRequest:function(e,t,n){
var i;return null==t&&(t={}),null==n&&(n={}),assert(null!=e,"postRequest missing action"),t.t=ze.read(Ue.JS_CSRF_COOKIE),i=new Element("form",{action:e,method:"POST"}),n.target&&(i.target=n.target),document.body.appendChild(i),jt.add_vars(i,t),i.submit()},hide_errors:function(e){var t,n,i,r,o;for(t=this.get_errors(e),r=[],n=0,i=t.length;i>n;n++)o=t[n],o.down("span.error-message")?r.push(o.hide()):r.push(void 0);return r},show_errors:function(e){var t,n,i,r;for(t=this.get_errors(e),n=0,i=t.length;i>n;n++)r=t[n],r.down("span.error-message")&&r.show();return _(".sick-input").find("label").css("top","")},get_errors:function(e){var t,n;return n=".error-bubble, .error-plain-text",t=e?e.select(n):$$(n)}},_(function(){return jt.show_errors()});var Ft;Ft=Qe.ActAsBlock={elm_list:["margin-left","margin-right","padding-left","padding-right","border-left-width","border-right-width"],parent_list:["padding-left","padding-right","border-left-width","border-right-width"],register:function(e,t){var n,i,r,o;for(null==t&&(t=document.body),r=$(t).getElementsByClassName("act_as_block"),o=[],n=0,i=r.length;i>n;n++)e=r[n],o.push(this.resize(e));return o},resize:function(e){var t,n,i,r;return e=$(e),n=e.up(),t=vt.sumStyles(e,this.elm_list),i=vt.sumStyles(n,this.parent_list),e.style.width="1px",r=n.getWidth()-t-i,r>0?e.style.width=r+"px":void 0}};var qt;qt=Qe.BrowseStyleRows={register_all:function(){var e,t,n,i;for(n=$$(".bs-row"),e=0,t=n.length;t>e;e++)i=n[e],this.register(i);return Event.observe(document,"click",this.kill_current.bind(this)),_(document).on("dropdown-opened",this.kill_current.bind(this))},register:function(e){var t;return e=$(e),e.db_observe("mouseover",this.mouseover.bind(this)),e.db_observe("mouseout",this.mouseout.bind(this)),t=e.down(".action-button"),t?t.db_observe("click",this.click.bind(this)):void 0},mouseover:function(e,t){return t.hasClassName("no-hover")?void 0:t.addClassName("hover")},mouseout:function(e,t){return t.removeClassName("hover")},click:function(e,t){var n,i,r;if("A"!==e.target.tagName)return i=t.up(".bs-row"),Event.stop(e),i.hasClassName("selected")?void this.kill_current(!1):(_(document).trigger("dropdown-opened"),this.kill_current(!1),r=$(e.target),r.match(".bs-actions-list *")||i.addClassName("selected"),n=r.hasClassName("bs-row")?r:r.up(".bs-row"),n.style.zIndex=9)},kill_current:function(e){var t,n,i,r,o;for(r=$$(".bs-row.selected"),o=[],n=0,i=r.length;i>n;n++)t=r[n],t.removeClassName("selected"),o.push(t.style.zIndex="");return o}};var Pt;Pt=Qe.Bubble={make:function(e,t,n,i,r){var o,s,a,l,_,u,c,d,h,m,p,f,v,g,w,b,y,k,x,E;return null==t&&(t="left"),r=null!=r?r:{},["left","right"].contains(t)?(n=n||"middle",assert(["top","middle","bottom"].contains(n),"expected tail position ['top', 'middle', 'bottom'], got "+n)):["bottom","top"].contains(t)?(n=n||"center",assert(["left","center","right"].contains(n),"expected tail position ['left', 'center', 'right'], got "+n)):["none"].contains(t)||assert(!1,"unexpected tail side, got "+t),f=new Element("table"),"titled"===r.style?(f.addClassName("bluebubble"),v="bluebubble"):(f.addClassName("bubble"),v="bubble"),i&&(f.style.width=i+"px"),w=new Element("tbody"),k=new Element("tr"),b=new Element("td"),b.addClassName("tl"),p=new Element("td"),p.addClassName("t"),"titled"===r.style&&i&&(p.style.width=i-42+"px"),y=new Element("td"),y.addClassName("tr"),"top"===t&&(g=new Element("img",{src:"/static/images/"+v+"_arrow_top.png"}),g.addClassName("tarrow"),"titled"===r.style?(g.addClassName("arrow-"+n),s=new Element("div"),s.addClassName("arrow-container"),i&&(s.style.width=i-42+"px"),s.__sert(g),p.__sert(s)):(p.style.textAlign=n,p.__sert(g))),k.__sert(b),k.__sert(p),k.__sert(y),w.__sert(k),x=new Element("tr"),d=new Element("td"),d.addClassName("l"),"left"===t&&(o="titled"===r.style?new Element("img",{src:"/static/images/bluebubble_arrow_left-vfl8zzy_-.png"}):new Element("img",{src:"/static/images/bubble_arrow-vfl8m7tk-.png"}),o.addClassName("arrow"),d.__sert(o),d.vAlign=n),c=new Element("td"),c.addClassName("c"),c.update(e),h=new Element("td"),h.addClassName("r"),"right"===t&&(m=new Element("img",{src:"/static/images/bubble_arrow_right-vflmW3_2s.png"}),m.addClassName("rarrow"),h.__sert(m),h.vAlign=n),x.__sert(d),x.__sert(c),x.__sert(h),w.__sert(x),E=new Element("tr"),_=new Element("td"),_.addClassName("bl"),a=new Element("td"),a.addClassName("b"),"bottom"===t&&(l=new Element("img",{src:"/static/images/"+v+"_arrow_bottom.png"}),l.addClassName("barrow"),"titled"===r.style?(l.addClassName("arrow-"+n),s=new Element("div"),s.addClassName("arrow-container"),i&&(s.style.width=i-42+"px"),s.__sert(l),a.__sert(s)):(a.style.textAlign=n,a.__sert(l))),u=new Element("td"),u.addClassName("br"),E.__sert(_),E.__sert(a),E.__sert(u),w.__sert(E),f.__sert(w),f}};var Bt;Bt=INLINE_JS.FreshDropdown=Qe.FreshDropdown={show:function(e,t,n,i){var r,o,s,a;return null==i&&(i=!1),_(document).trigger("dropdownOpened",[1]),r=_(t),n||(n=r[0].offsetHeight+10),this.hide_all(),o=_(e).show(),a=o[0].offsetWidth,s=r[0].offsetWidth,He.clone_position(o,r,{setHeight:!1,setWidth:!1,offsetLeft:-1*(a-s)+22,offsetTop:n}),i&&o.width(a),r.addClass("pressed"),function(e){return function(){return document.observe("click",Bt.hide_all)}}(this).defer()},hide_all:function(e){var t,n;return n=_(".freshdropdown-menu"),t=0,n.each(function(){return _(this).is(":visible")?t+=1:void 0}),n.hide(),_(document).trigger("dropdownClosed",[t]),$$(".freshdropdown-button").invoke("removeClassName","pressed"),document.stopObserving("click",Bt.hide_all)}};var Yt;Yt=Qe.JumpWatcher={inverval:null,last_hash:null,last_page_offset:0,check:function(){return window.location.href.endsWith("#")&&0===window.pageYOffset&&0!==Yt.last_page_offset?this.report():(this.last_page_offset=window.pageYOffset,this.last_hash=Ge.parse(window.location.href).fragment)},report:function(){return clearInterval(Yt.interval),raiseAndReport("Hash jump detected, last hash = "+this.last_hash+". You may have an onclick handler that isn't firing, or you are not preventing the default action (eg. by returning false in your handler)")}};var zt;zt=INLINE_JS.Modal=Qe.Modal={KEY_SCOPE:"modal",width:640,vertical_offset:90,show:function(e,t,i,r,o,s,a,l,u){var c,d,h,m,p,f;return null==i&&(i=!1),null==r&&(r=!1),null==o&&(o=!1),null==s&&(s=!1),null==a&&(a=""),null==l&&(l=!0),null==u&&(u=!1),zt.shown()&&zt._cleanup(),o=o||this.width,d="#modal-content .error-message, #modal-content .error-removable, #modal-content .error-bubble",$$(d).invoke("hide"),assert(t,"Missing modal content!"),p=this.vars._prev_scope,this.vars=i||{},this.vars._prev_scope=p,$("modal").setStyle({width:o+"px",margin:"0 0 0 "+Math.floor(-o/2).toString()+"px"}),this.vars.extra_class="",a&&($("modal").addClassName(a),this.vars.extra_class=a),s||(m=vt.childElement($("modal-content"),0),m&&m!==t&&$("grave-yard").__sert(m),c=new Element("div"),c.update(t),$("modal-content").__sert(c),t.show&&t.show(),Element.show("modal")),_("#modal-overlay").off("click"),l?_("#modal-overlay").on("click",function(e){return zt.hide(null,!1,!0),e.preventDefault(),e.stopPropagation()}):_("#modal-overlay").on("click",function(e){return e.preventDefault(),e.stopPropagation()}),this.fix_position(),$("modal-overlay").show(),$("modal-behind").setStyle({width:o+20+"px",margin:"0 0 0 "+Math.floor(-o/2-10).toString()+"px"}),_("#modal-behind").css("opacity",.2),$("modal-behind").show(),r?$("modal-content").select("#"+r.id).first().focus():vt.ie||(h=$("modal").down("input[type=submit]")||$("modal").down("input[type=button]"),h&&h.focus()),this.track_id||this.track_resizes(),e?(vt.isElm(e)?_("#modal-title").html(e):_("#modal-title").text(e),_("#modal-title").show(),f=_("#modal-title").text()):_("#modal-title").hide(),Ft.register(!1,"modal"),this.keydownHandler=this.keydown.bind(this),document.observe("keydown",this.keydownHandler),$("modal-content").style.height="auto",n.getScope()!==this.KEY_SCOPE&&(this.vars._prev_scope=n.getScope()),n.setScope(this.KEY_SCOPE),this.prevent_hide_if_loading=u,_("#modal").find("input").filter(":visible:first").focus(),this.in_viewport()&&(this.scroll_locked=!0,He.scroll_lock_document()),_(document).trigger("modalOpened",[1]),!1},in_viewport:function(){var e,t,n,i,r;return e=_("#modal"),t=e.height(),r=e.width(),n=He.viewport_dimensions(),i=He.viewport_offset(e),i.left>0&&i.top>0&&i.left+r<n.width&&i.top+t<n.height},fix_position:function(e){var t,n;return n=document.viewport.getScrollOffsets().top+this.vertical_offset,t=parseInt($("modal").getStyle("height"),10),t+this.vertical_offset<document.viewport.getHeight()?($("modal").setStyle({position:"fixed",top:this.vertical_offset+"px"}),$("modal-behind").setStyle({position:"fixed",height:t+20+"px",top:this.vertical_offset-10+"px"})):($("modal").setStyle({position:"absolute",top:n+"px"}),$("modal-behind").setStyle({position:"absolute",height:t+20+"px",top:n-10+"px"}))},keydown:function(e){var t,n,i,r;if(i=e.keyCode||e.which||e.charCode,(27===i||8===i&&!He.focus_in_input())&&(e.preventDefault(),this.hide(null,!1,!0)),9===i&&!He.focus_in_input()){for(n=$("modal").down("input[type=text], input[type=email]"),r=$("modal").down(".modal-tabs"),t=r;t&&t.next();)if(t=t.next(),t.visible()){n=t.down("input[type=text], input[type=email]");break}if(n)return e.preventDefault(),n.focus()}},shown:function(){return $("modal").visible()},hide:function(e,t,i){return e&&Event.stop(e),this.should_prevent_hide()?!1:(this.prevent_hide_if_loading=!1,this.onHide?void this.onHide(i):(this.onHide=null,Element.hide("modal-behind"),Element.hide("modal-overlay"),$("modal").removeClassName(this.vars.extra_class),t?$("modal").style.marginLeft="-10000000px":Element.hide("modal"),zt._cleanup(),this.track_id&&(clearInterval(this.track_id),this.track_id=!1),document.stopObserving("keydown",this.keydownHandler),document.activeElement&&-1===[document,window,document.body].indexOf(document.activeElement)&&$(document.activeElement).blur(),n.setScope(this.vars._prev_scope)))},_cleanup:function(){return _(document).trigger("modalClosed",[1]),this.scroll_locked?He.scroll_unlock_document():void 0},should_prevent_hide:function(){return this.prevent_hide_if_loading&&l.some(_("#modal form"),function(e){return e.ajax_submitted})},track_resizes:function(){return this.track_id=setInterval(this.on_resize.bind(this),150)},on_resize:function(){var e;return e=$("modal").getHeight(),this.old_height!==e||$("modal-behind").getHeight()<e?(this.old_height=e,this.fix_position()):void 0},vars:{}};var Ht;Ht=Qe.SickInput={init:function(){var e,t,n,i,r;for(i=$$(".sick-input"),r=[],t=0,n=i.length;n>t;t++)e=i[t],e.hasClassName("sickified")||r.push(this._create(e));return r},_create:function(e){var t,n,i;if(null!=e)return n=e.identify(),i=e.down("input")||e.down("textarea")||e.down("select"),i.observe("focus",function(){return e.addClassName("focused")}),i.observe("blur",function(){return e.removeClassName("focused")}),t=function(){return e.hasClassName("populated")&&""===i.getValue()?e.removeClassName("populated"):e.hasClassName("populated")||""===i.getValue()||e.addClassName("populated"),n in Ht._handler_map?Ht._handler_map[n]():void 0},jt.show_errors(),t(),setInterval(t,100)},_handler_map:{},add_interval_handler:function(e,t){var n;return n=e.identify(),this._handler_map[n]=t},remove_interval_handler:function(e,t){var n;return n=e.identify(),this._handler_map[n]===t?delete this._handler_map[n]:void 0}};var Kt;Kt=Qe.SuggestionInput={register:function(e){var t;return e=$(e),t=e.up("form"),Kt.defaulted(e)||""===e.getValue()?e.setValue(e.title):e.addClassName("suggestion-input-unfaded"),e.observe("blur",this.blur.bind(this)),e.observe("focus",this.focus.bind(this)),e.observe("db:value_change",this.focus.bind(this)),t?(e.id||(e.id="r_elm_id_"+Math.random().toString()),t.observe("submit",Kt.blank(e.id).bind(this))):void 0},register_all:function(){var e,t,n,i,r;for(i=$$(".suggestion-input"),r=[],e=0,n=i.length;n>e;e++)t=i[e],r.push(this.register(t));return r},blank:function(e){return function(t){return function(){var n;return(n=$(e))&&t.defaulted(n)?n.setValue(""):void 0}}(this)},defaulted:function(e){return e=$(e),e.getValue()===e.title},do_blank:function(e){return this.blank(e)()},clear:function(e){var t;return t={target:e},this.focus(t)},focus:function(e){var t;return(t=$(e.target))&&this.defaulted(t)?(t.addClassName("suggestion-input-unfaded"),t.setValue("")):void 0},blur_elm:function(e){return""===e.getValue()&&(e.removeClassName("suggestion-input-unfaded"),e.setValue(e.title)),e.blur()},blur:function(e){var t;return(t=$(e.target))?this.blur_elm(t):void 0},reset:function(e){var t;return(t=$(e))?(t.removeClassName("suggestion-input-unfaded"),t.setValue(t.title),t.defaulted=!0,t.blur()):void 0},setValue:function(e,t){var n;return(n=$(e))?(n.addClassName("suggestion-input-unfaded"),n.setValue(t),n.defaulted=!1):void 0}};var Wt;Wt=Qe.TitleBubble=function(){var e,t,n,i,r,o,s;return s=0,e=0,o=function(e){return s=e},r=function(i){var r,o,a,l,u,c,d,h,m,p,f;return o=_(i.currentTarget),f=o.attr("title"),(null!=f?f.length:void 0)&&(o.attr("data-title",f),o.removeAttr("title")),u=parseInt(o.data("title-delay")),l="title-bubble-"+e++,o.data("bubble-id",l),r=_("<div/>",{id:l,class:"title_bubble_container"}),u||(r.css({opacity:0}),r.addClass("has-transition")),o.hasClass("white")&&r.addClass("white"),o.hasClass("black")&&r.addClass("black"),r.text(o.attr("data-title")),h=o.attr("data-title-html"),r.html(h),p="yes"!==o.attr("data-title-hide-tail"),p&&(a=_("<div/>",{class:"tail"}),r.append(a)),_(document.body).append(r),d=n(o[0],r[0]),c=t(d,r[0],o[0]),He.clone_position(r,o,{setWidth:!1,setHeight:!1,offsetTop:c.top-s,offsetLeft:c.left}),r.addClass("position-"+d),p&&He.clone_position(a,o,{setWidth:!1,setHeight:!1,setTop:!1,offsetLeft:c.left+c.tail_offset_left+_(r).outerWidth()/2}),m=function(){var e;if(r.data("pending-delay")&&o.data("bubble-id")===l)return e=parseInt(o.data("title-fade-time"))||400,r.fadeIn(e)},u?(r.hide(),r.data("pending-delay",!0),setTimeout(m,u)):r.css({opacity:""})},n=function(e,t){var n,i,r;if(e=$(e),r=e.getAttribute("data-title-position"),n=document.viewport.getDimensions(),i=e.viewportOffset(),"above"!==r&&"below"!==r&&"right"!==r&&"left"!==r&&(r="above"),"left"===r){if(i.left<t.width)return"right"}else if("right"===r){if(n.width-(i.left+e.getWidth())<t.width)return"left"}else if("below"===r){if(n.height-(i.top+e.getHeight())<t.height)return"above"}else if("above"===r&&i.top<t.height)return"below";return r},t=function(e,t,n){var i,r,o,s,a,l,_,u,c,d;return t=$(t),n=$(n),o=document.viewport.getDimensions(),i=t.getDimensions(),s=n.viewportOffset(),r=6,a=0,l=0,c=0,d=0,"below"!==e&&"above"!==e||(l="below"===e?n.getHeight()+r:-1*i.height-r,_=n.getWidth()/2-i.width/2,s.left+_+i.width>o.width?(a=o.width-s.left-i.width,c=_-a-5):(a=_,c=-5)),"left"!==e&&"right"!==e||(a="right"===e?n.getWidth()+r:-1*i.width-r,u=n.getHeight()/2-i.height/2,s.top+u+i.height>o.height?(l=o.height-s.top-i.height,d=u-l-5):(l=u,d=-5)),{left:a,top:l,tail_offset_left:c,tail_offset_top:d}},i=function(e){var t,n,i;return n=_(null!=e?e.currentTarget:void 0),t=_("#"+n.data("bubble-id")),t.data("pending-delay")?(t.removeData("pending-delay"),i=parseInt(n.data("title-fade-time"))||400,t.fadeOut(i,function(){return t.remove()})):t.remove()},{init:function(){return _(document).on("mouseenter",".title_bubble",r),_(document).on("mouseleave",".title_bubble",i).on("mouseup",".title_bubble",i),_(document).on("mouseenter",".title_bubble_sticky",r),_(document).on("mouseleave",".title_bubble_sticky",i)},set_vertical_space:o,hide_all:function(){return _(".title_bubble_container").remove()}}}();var Vt;Vt=INLINE_JS.Tooltip=Qe.Tooltip={attach:function(e,t,n,i){var r,o;return null==i&&(i={}),e=$(e),n=n?$(n):null,r=Pt.make(t,e.tail_position,i.tail_position,i.width,i),r.setStyle({display:"none",position:"absolute"}),$("floaters").__sert(r),e.match("#modal-content *")||e.match(".db-modal-content *")?r.style.zIndex="13001":r.style.zIndex="","right"===e.tail_position&&(o=vt.ie?32:12,r.style.marginLeft=-(r.getWidth()+e.getWidth()+o)+"px"),e.tooltip=r,e.out_target=!!n,e.observe("mouseout",this.mouseout("target",e)),e.observe("mouseover",this.mouseover("target",e)),e.out_trigger=!n,n&&(n.observe("mouseout",this.mouseout("trigger",e)),n.observe("mouseover",this.mouseover("trigger",e))),e.out_tooltip=!0,r.observe("mouseout",this.mouseout("tooltip",e)),r.observe("mouseover",this.mouseover("tooltip",e))},update:function(e,t){return e.tooltip?$(e.tooltip).update(t):void 0},mouseover:function(e,t){return function(){return t["out_"+e]=!1}},mouseout:function(e,t){return function(){return t["out_"+e]=!0,Vt.hide_if_out.defer(t)}},show_by:function(e){var t,n;return t=_(e.tooltip),e=_(e),t.show(),n=Math.floor(t[0].offsetHeight/2),He.clone_position(t,e,{setWidth:!1,setHeight:!1,offsetTop:Math.floor(e[0].offsetHeight/2)-n,offsetLeft:e[0].offsetWidth+1})},hide_if_out:function(e){var t;if(e.out_target&&e.out_trigger&&e.out_tooltip)return t=$(e.tooltip),t.hide()},show:function(e,t,n,i,r){return null==i&&(i="left"),e=$(e),e.tail_position||(e.tail_position=i),n=n?$(n):null,e.tooltip||this.attach(e,t,n,r),this.show_by(e)}};var Jt;Jt=INLINE_JS.TreeView=Qe.TreeView={tv:{},loaded:!1,user:null,role_icon:"",set_params:function(e){return this.ajax_params=e},init:function(e,t,n){var i;return null==n&&(n="treeview"),this.tv[n]={},i=this.tv[n],i.autohide=null===t?!0:t,i.handler=e,i.viewdiv=$(n),i.hidefunc=this.hide.bindAsEventListener(this),this.ajax_params={},document.observe(Un.ADD,function(e){return function(t){return e.schedule_reset()}}(this)),document.observe(Un.REMOVE,function(e){return function(t){return e.schedule_reset()}}(this)),document.observe(Un.MOVE,function(e){return function(t){return e.schedule_reset()}}(this))},schedule_reset:function(){return this.loaded=!1},reset:function(e){var t,n,i,r,o,s,a;return t={url:"/ajax_subtreeview",data:_.extend({},this.ajax_params),success:function(t){return function(n){var i,r;i=[];for(r in t.tv)t.tv.hasOwnProperty(r)?(t.tv[r].viewdiv.down(".treeview-folders").update(n),e&&e.onSuccess?i.push(e.onSuccess(n)):i.push(void 0)):i.push(void 0);return i}}(this)},(null!=e?e.user:void 0)?(e.user.id!==(null!=(n=this.user)?n.id:void 0)&&(o=_("<p />",{id:"treeview-loading"}),s=_("<img />",{src:"/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif"}),o.append(s),a=" "+pt("Loading your folders"),o.append(a),_("#dest-treeview .treeview-folders").html(o),this.user=e.user),t.subject_user=e.user,r=Ae.get_role_title(e.user),i=Ae.get_viewer().is_paired?e.user.is_team?"s_briefcase":"s_house":"dropbox",r||(r=pt("Dropbox")),_("#first-treeview-link span").text(r),ye.replace(_("#root-img")[0],"web",this.role_icon,i),this.role_icon=i):_("#first-treeview-link span").text(pt("Dropbox")),h.SilentBackgroundRequest(t)},toggle:function(e,t){var n;return Event.stop(e),n=this.tv[t||"treeview"],n.shown?(n.shown=!1,this.hide(e,t)):(n.shown=!0,this.show(e.target,t)),!1},hide:function(e,t){var n;return n=this.tv[t||"treeview"],e&&$(e.target).descendantOf(n.viewdiv)?void 0:(n.viewdiv.hide(),Event.stopObserving(window,"click",n.hidefunc),n.shown=!1)},show:function(e,t){var n,i;return i=this.tv[t||"treeview"],e=$(e),e.blur(),n=e.cumulativeOffset(),i.viewdiv.setStyle({top:n.top+e.getHeight()+"px",left:n.left-4+"px"}),i.viewdiv.show(),Event.observe(window,"click",i.hidefunc)},toggleNode:function(e){var t;return e=$(e),t=e.down("img"),t.className.match("bullet_plus")?ye.replace(t,"web","bullet_plus","bullet_minus"):ye.replace(t,"web","bullet_minus","bullet_plus"),e.up().next("div").toggle(),e.blur(),!1},toggleNodeAjax:function(e,t,n){var i,r;return e.fetched_children?this.toggleNode(e):(e=$(e),i=e.down("img"),r=ye._get(i),i.src="/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif",h.SilentBackgroundRequest({url:"/ajax_subtreeview"+t,data:_.extend({},this.ajax_params),subject_user:n,success:function(t){return function(n){var o;return o=new Element("div",{style:"display: none;"}).update(n),e.up().__sert({after:o}),e.fetched_children=!0,ye._set(i,r),t.toggleNode(e)}}(this),complete:function(){return/loading/.match(i.src)?ye._set(i,r):void 0}}),!1)},handle:function(e,t){var n,i;return n=$H(this.tv).keys(),(i=$(t).ancestors().find(function(e){return n.include(e.id)}))?(i=this.tv[i.id],_(document).trigger("db:treeview_selected",[e]),i.handler&&i.handler(e,t),i.autohide&&this.hide(i.id),!1):void 0},move:function(e,t,n){var i;return i=$(e),this.loaded?n&&n.onSuccess&&n.onSuccess():this.reset({onSuccess:function(i){return function(){return i.loaded=1,i.move(e,t,n)}}(this),user:null!=n?n.user:void 0}),assert(i,"Couldn't find tree_id"),assert($(t),"Couldn't find location_id"),$(t).appendChild(i),i.show()}};var Gt;Gt=Qe.ULSelectMenu=function(){var e,t,n,i,r,o,s,a,l,u,c;return e=function(e){return e.removeClassName("shown")},c=function(e){return e.toggleClassName("shown")},s=function(){return this.removeClassName("hover")},o=function(){return this.addClassName("hover")},a=function(e,t){var n,i,r,o;for(r=[],n=0,i=t.length;i>n;n++)o=t[n],r.push(e.insert(o));return r},i=function(e,t,n){return a(e,n),e.firstChild!==t?e.__sert({top:t}):void 0},l=function(e,t){var n;return n="selected",_(e).find("."+n).removeClass(n),_(t).addClass(n)},u=function(e,t){var n,i,r,o,s;for(o=e.select("li"),s=[],i=0,r=o.length;r>i;i++)n=o[i],n.getAttribute("data-value")===t?s.push(l(e,n)):s.push(void 0);return s},r=function(t,n,r){return function(o){return t.hasClassName("selected")?(i(n,t,r),c(n)):(l(n,t),n.fire("db:change",t.getAttribute("data-value")),e(n))}},t=function(t){var n,i,a,l,_,u,c,d;if(l=t.select("li"),assert(l.length,"Empty list of options "+t.identify()),_=void 0,1===l.length)t.addClassName("one");else{for(i=0,a=l.length;a>i;i++)n=l[i],c=n.getAttribute("data-value"),assert(c,n.identify()+" missing data value"),n.observe("click",r(n,t,l)),n.observe("mouseenter",o),n.observe("mouseleave",s),n.hasClassName("selected")&&(_=n);$(document.body).observe("click",function(n){return $(n.target).up(".ul_select_menu")!==t?e(t):void 0})}return _||(_=l[0]),_.addClassName("selected"),d=new Element("span"),u=_.getDimensions(),d.setStyle({width:u.width+"px",height:u.height+"px",position:"relative",display:"inline-block"}),t.wrap(d)},n=function(){var e,n,i,r,o;for(r=$$(".ul_select_menu"),o=[],n=0,i=r.length;i>n;n++)e=r[n],o.push(t(e));return o},_(n),{init:function(e){return t(e)},set_selected_by_value:u}}();var Xt;Xt=Qe.DBCalendar=Class.create({initialize:function(e,t){return this.options=t||{},this.container=$(e),assert(this.container,"Couldn't find the element"),this.today=new Date,this.options.disable_future&&(this.options.last_day=vt.start_of_day(this.options.last_day||this.today)),this.options.disable_past&&(this.options.first_day=vt.start_of_day(this.options.first_day||this.today)),this.view_date=vt.start_of_day(this.options.selected_date||this.today),this.selected_date=vt.start_of_day(this.options.selected_date||this.today),this.render()},_change_month:function(e,t){return Event.stop(e),this.view_date.setMonth(t),this.render()},is_valid_date:function(e,t,n,i,r){var o;return e=parseInt(e,10),t=parseInt(t,10),n=parseInt(n,10),i=parseInt(i,10),r=parseInt(r,10),i=i||1970,r=r||(new Date).getFullYear()+1,t+=1,i>n?!1:n>r?!1:1>t||t>12?!1:0>=e?!1:2===t?(o=n%4===0&&(n%100!==0||n%400===0),o?29>=e:28>=e):4===t||6===t||9===t||11===t?30>=e:31>=e},change_date:function(e,t,n){var i;if(this.is_valid_date(e,t,n))return i=n!==this.view_date.getFullYear()||t!==this.view_date.getMonth(),this.selected_date=new Date(n,t,e),i?(this.view_date.setMonth(t),this.view_date.setFullYear(n),this.render()):(_(this.container).find(".selected").removeClass("selected"),_(this.container).find("a#day"+e+"-"+t).addClass("selected")),this.options.onDateChange?this.options.onDateChange(this.selected_date):void 0},render:function(){var e,t,n,i,r,o,s,a,l,u;return t=this.render_days(),i=_(".current-month",t),s=i.first().data("date"),o=i.last().data("date"),u=s<=this.options.first_day,l=o>=this.options.last_day,e=new Element("div"),e.addClassName("calendar clearfix"),l||(this._next_month=function(e){return this._change_month(e,this.view_date.getMonth()+1)}.bind(this),r=new Element("a"),r.addClassName("changemonth next"),r.update(ye.make("web","arrowright",{})),Event.observe(r,"click",this._next_month),e.__sert(r)),u||(this._prev_month=function(e){return this._change_month(e,this.view_date.getMonth()-1)}.bind(this),a=new Element("a"),a.addClassName("changemonth prev"),a.update(ye.make("web","arrowleft",{})),Event.observe(a,"click",this._prev_month),e.__sert(a)),n=new Element("h5"),n.update(pt("%(month)s %(year)s",{comment:"For example 'January 2010'. This is used as part of a calendar."}).format({month:T.month_name(this.view_date.getMonth()),year:this.view_date.getFullYear()})),e.__sert(n),e.__sert(t),this.container.__date(e)},render_days:function(){var e,t,n,i,r,o,s,a,l;for(t=new Date(this.view_date.getFullYear(),this.view_date.getMonth(),1),a=t.getDay(),e=new Element("div"),e.addClassName("days"),n=r=l=a;0>=l?0>r:r>0;n=0>=l?++r:--r)s=new Date(t.getFullYear(),t.getMonth(),t.getDate()),s.setDate(s.getDate()-n),e.__sert(this.render_day(s,!0));for(i=new Date(this.view_date.getFullYear(),this.view_date.getMonth(),1);i.getMonth()===this.view_date.getMonth();)e.__sert(this.render_day(i)),i=new Date(this.view_date.getFullYear(),this.view_date.getMonth(),i.getDate()+1);for(o=new Date(this.view_date.getFullYear(),this.view_date.getMonth()+1,0);6!==o.getDay();)o=new Date(o.getFullYear(),o.getMonth(),o.getDate()+1),e.__sert(this.render_day(o,!0));return e},render_day:function(e,t){var n,i;return i=!t,this.options.last_day&&(t=t||e>this.options.last_day),this.options.first_day&&(t=t||e<this.options.first_day),n=new Element(t?"span":"a"),_(n).data("date",e),i&&n.addClassName("current-month"),n.update(e.getDate()),n.addClassName("date"),n.writeAttribute("id","day"+e.getDate()+"-"+e.getMonth()),this.selected_date.getDate()===e.getDate()&&this.selected_date.getMonth()===e.getMonth()&&this.selected_date.getFullYear()===e.getFullYear()&&n.addClassName("selected"),t?n.addClassName("inactive"):(this._handler=function(e){var t;return t=e.target.identify().substr(3).split("-"),this.change_date(t[0],this.view_date.getMonth(),this.view_date.getFullYear())}.bind(this),Event.observe(n,"click",this._handler)),n}});var Zt;Zt=Qe.DatePickerInput=Class.create({initialize:function(e,t){var n,i,r,o;return this.container=e,this.options={},Object.extend(this.options,t||{}),this.input=this.container.down(".input-date"),this.display=this.container.down(".visible-date"),o=this.input.value?vt.from_mysql_date(this.input.value):new Date,this.container.hasAttribute("data-first")&&(r=vt.from_mysql_date(this.container.getAttribute("data-first"))),n=null!=this.options.disable_future?this.options.disable_future:!0,i=null!=this.options.disable_past?this.options.disable_past:!0,this.cal_container=this.container.down(".cal-container"),this.calendar=new Xt(this.cal_container,{onDateChange:this.onDateChange.bind(this),first_day:r,disable_future:n,disable_past:i,selected_date:o}),this.container.observe("click",this.show_cal.bindAsEventListener(this)),$(document.body).observe("click",this.hide_cal.bind(this)),this.onDateChange(o)},show_cal:function(e){var t;return e&&Event.stop(e),t=$(e.target),t.match(".cal-container")||t.up(".cal-container")?void 0:(_(".cal-container").hide(),this.cal_container.show())},hide_cal:function(){return this.cal_container.hide()},onDateChange:function(e){return this.input.value=vt.to_mysql_date(e,!1),this.display.update(Kn.localize(e)),this.hide_cal()}});var Qt;Qt=Qe.TextInputDatePicker=Class.create({initialize:function(e,t){var n,i,r,o;return this.options={include_seconds:!0,include_microseconds:!0,choose_eod:!1},Object.extend(this.options,t||{}),this.input=$(e),assert(this.input,"Couldn't find the element "+e.toString()),r=new Date,o=this.input.value?vt.from_mysql_date(this.input.value):!1,i=new Date(r.getUTCFullYear(),r.getUTCMonth(),r.getUTCDate()),this.cal_icon=ye.make("web","calendar_view_month",{align:"absmiddle"}),this.cal_container=new Element("div",{id:"cal_container_"+e,style:"display: none; position: absolute; z-index: 1"}),this.calendar=new Xt(this.cal_container,{onDateChange:this.onDateChange.bind(this),last_day:i,selected_date:o}),this.input.__sert({after:this.cal_icon}),this.cal_icon.observe("click",this.toggle_cal.bindAsEventListener(this)),n=_(this.input),He.clone_position(_(this.cal_container),n,{setWidth:!1,setHeight:!1,offsetTop:n[0].offsetHeight}),this.cal_icon.__sert({after:this.cal_container})},toggle_cal:function(e){return e&&Event.stop(e),this.cal_container.toggle()},hide_cal:function(e){return e&&Event.stop(e),this.cal_container.hide()},onDateChange:function(e){return this.options.choose_eod&&e.setTime(vt.start_of_day(e).getTime()+86399999),this.input.value=vt.to_mysql_date(e,this.options.include_seconds,this.options.include_microseconds),this.hide_cal()}}),O.window_load(Ft.register.bind(Ft)),_(Ht.init.bind(Ht)),_(Kt.register_all.bind(Kt)),Event.observe(window,"scroll",function(){return Wt.hide_all()}),_(function(){return Yt.interval=setInterval(Yt.check.bind(Yt),500),Wt.init()});var en,Lt=function(e,t){function n(){this.constructor=e}for(var i in t)Mt.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},Mt={}.hasOwnProperty;en=INLINE_JS.ChangeNameModal=Qe.ChangeNameModal=function(e){function t(){t.__super__.constructor.call(this,{element_id:"change-name-modal"}),this.on_confirm_button_click=function(e){return function(t){var n,i,r;return t.preventDefault(),n=_(t.target),i=n.closest("form"),r=function(){return e.hide(),location.reload()},jt.ajax_submit(i[0],!1,r,null,n[0])}}(this)}return Lt(t,e),t}(it);var tn;tn=INLINE_JS.BonusTable=Qe.BonusTable={_tmpl:null,_inited:null,_next_page:0,_fetching_page:!1,init:function(e){return this.user_id=e,!tn._inited&&$("bonus-loading")?(tn._inited=!0,$("bonus-loading").show(),tn._tmpl=We.tmpl("bonus_row_tmpl"),tn.listen(),tn.get_next_page()):void 0},_render:function(e){var t,n,i,r;for(t=[],n=0,i=e.length;i>n;n++)r=e[n],t.push(tn._tmpl({row:r,Sprite:ye}));return $("bonus-table").__sert(t)},get_next_page:function(){return tn._fetching_page?void 0:(tn._fetching_page=!0,new Ajax.DBRequest("/account/bonus_page/"+tn._next_page,{onSuccess:function(e){var t,n,i;return t=e.responseText.evalJSON(),i=t.rows,n=t.has_more,tn._render(i),$("bonus-loading").hide(),n?(tn._next_page+=1,$("load-more-bonus").show()):$("load-more-bonus").hide(),tn._fetching_page=!1},subject_user:this.user_id}))},_max_referral_over:function(e){var t,n,i;return n=_(e.currentTarget),i=pt("You've earned the maximum amount of referral space. Thanks for inviting people to Dropbox!"),t=_(Pt.make(i,"right","middle")),Element.absolutize(t[0]),n.append(t),He.clone_position(t,n,{setWidth:!1,setHeight:!1}),t.css({width:"200px",left:parseInt(t.css("left"),10)-210+"px",top:parseInt(t.css("top"),10)-55+"px"})},_max_referral_out:function(e){var t,n,i,r,o;for(r=_(".reached-max-referral-bonus .bubble"),o=[],n=0,i=r.length;i>n;n++)t=r[n],o.push(t.remove());return o},listen:function(){return _("#load-more-bonus").on("click",tn.get_next_page.bind(tn)),_(document).on("mouseenter",".reached-max-referral-bonus",tn._max_referral_over),_(document).on("mouseleave",".reached-max-referral-bonus",tn._max_referral_out)},toggle:function(){return _("#bonus-list").is(":visible")?(this.hide(),_("#space-earned-link").text(pt("View all space earned"))):(this.show(),_("#space-earned-link").text(pt("Hide space earned")))},show:function(){return _("#bonus-list").slideDown(150)},hide:function(){return _("#bonus-list").slideUp(150)}};var nn,rn,on,sn;nn=INLINE_JS.DowngradeReasons=Qe.DowngradeReasons={reasons:{},addReason:function(e){return this.reasons[e]=!0},addReasons:function(e){var t,n,i,r;for(r=[],t=0,i=e.length;i>t;t++)n=e[t],r.push(this.addReason(n));return r},change:function(e,t,n){var i,r,o,s,a,l;e=parseInt(e,10),r=$(t),assert(r,"Couldn't find container for DowngradeReason"),i=!1,a=this.reasons;for(s in a)o=a[s],
l=$(n+s),assert(l,"Couldn't find container for "+(n+s)),o&&parseInt(s,10)===e?(l.show(),i=!0):l.hide();return i?r.show():r.hide()}},rn=Qe.DowngradeReasons2={init:function(){var e,t,n,i;for(i=["input[name=downgrade_reason_id]","input[name=other_reason_id]"],e=0,t=i.length;t>e;e++)n=i[e],_(n).change(function(e){var t;return t=e.target.id.indexOf("other")>=0,rn.change(t,e.target.getValue())});return _(".shared-additional-info").attr("name","shared_additional_info")},change:function(e,t){var n;return _(".downgrade-other-reason .error-message").hide(),e?void 0:(n="#downgrade-info-"+t,_(".downgrade-info").hide(),_(n).show(),_(".downgrade-info textarea").removeAttr("name"),_(n+" textarea").attr("name","additional_info"),_("input[name=other_reason_id]").removeAttr("checked"))}},on=Qe.DowngradeSurvey={init:function(){var e;return e="#downgrade-survey-form",_(""+e).on("submit",function(t){return function(t){var n,i;return i=_(e+" input[name=other_reason_id]:checked").length,n=_(e+" input[id=downgrade-radio-8]"),n.is(":checked")&&0===i?(_(".downgrade-other-reason .error-message").show(),t.preventDefault()):void 0}}(this))}},sn=Qe.TrialDowngradeReasons={init:function(){return _(document).on("click",".reasons-option",function(e){var t,n,i,r;return i=e.target.getValue(),r=e.target.name,"other_reason_id"===r&&(n="#other-info-"+i,_(".other-info").hide(),_(n).show()),"downgrade_reason_id"===r?(t="#downgrade-info-"+i,_(".downgrade-info").hide(),_(t).show()):void 0}),_("#downgrade-survey-form").on("submit",function(e){var t,n;return n=_("#downgrade-survey-form input[id=downgrade-radio-207]"),n.is(":checked")&&0===_(".q1-other-reason.textinput").val().length?(_(".trial-downgrade--error-message").show(),void e.preventDefault()):(t="",_(".reasons-option:checked").each(function(e,n){var i,r,o;return i=n.getValue(),r=_("#downgrade-info-"+i+" textarea").val(),o=_("#other-info-"+i+" textarea").val(),(null!=r?r.length:void 0)>0&&(t=i+":"+r),(null!=o?o.length:void 0)>0?t+=" "+i+":"+o:void 0}),_(".downgrade-info textarea").removeAttr("name"),_(".other-info textarea").removeAttr("name"),_('#downgrade-survey-form input:hidden[name="additional_info"]').val(t))})}};var an;an=INLINE_JS.GetSpace=Qe.GetSpace={_current_space:null,_why_msg:null,_twitter_url:null,offer_highlight_color:"#ffa",init:function(e,t,n){var i;return an._current_space=e,an._why_msg=t,an._twitter_url=n,$("space-actions").on("click",".space-action",an.perform_action),i=Ge.parse(window.location.href).fragment,i?an.highlight_offer(i):void 0},highlight_offer:function(e){var t,n;return t=_("#"+e),n=t.css("background-color"),t.css("background-color",an.offer_highlight_color).delay(2e3).animate({"background-color":n}).queue(function(){return t.css("background-color","")})},perform_action:function(e){var t,n;return e.preventDefault(),n={contact_sales:an._contact_sales,contact_support:an._contact_support,teams:an._teams,upgrade:an._upgrade,plans:an._plans,refer:an._refer,get_started:an._get_started,fb_link:an._fb_link,twitter_link:an._twitter_link,twitter_follow:an._twitter_follow,why_like:an._why_like,mailbox_link:an._mailbox_link},t=$(e.target),t.hasClassName("space-action")||(t=t.up(".space-action")),n[t.id]()},_teams:function(){return window.location.href="/business?tk=dropbox&ag=getspace&ad=v1"},_contact_sales:function(){return window.location.href="mailto:sales@dropbox.com"},_contact_support:function(){return window.location.href="/support"},_plans:function(){return window.location.href="/plans"},_upgrade:function(){return window.location.href="/upgrade"},_refer:function(){return window.location.href="/referrals"},_get_started:function(){return window.location.href="/gs"},_fb_link:function(){return x.do_auth(function(){return an._refresh_link_bonuses(),an._completed($("fb_link"))},Ae.get_viewer().personal_user.id)},_twitter_link:function(){return Gn.do_auth(function(){return an._refresh_link_bonuses(),Gn.set_is_authed(Ae.get_viewer().personal_user.id,!0),an._completed($("twitter_link"))},Ae.get_viewer().personal_user.id)},_twitter_follow:function(){return Gn.is_authed(Ae.get_viewer().personal_user.id)?an.follow_dropbox():Gn.do_auth(an.follow_dropbox,Ae.get_viewer().personal_user.id)},_why_like:function(){return zt.show(pt("Tell us why you love Dropbox"),$("why-i-like-modal")),$("why-i-like-input").focus(),vt._track_twitter_chars_left("why-i-like-input",90)},_mailbox_link:function(){return window.location.href="http://www.mailboxapp.com/"},follow_dropbox:function(){return Gn.is_authed(Ae.get_viewer().personal_user.id)||(an._refresh_link_bonuses(),Gn.set_is_authed(Ae.get_viewer().personal_user.id,!0)),Gn.follow_dropbox({showWorking:function(){return $("twitter_follow").down(".title").__date(pt("Following Dropbox on Twitter..."))},onFailure:function(){return $("twitter_follow").down(".title").__date(pt("Follow Dropbox on Twitter"))},onSuccess:function(){return $("twitter_link")&&$("twitter_link").visible()&&an._completed($("twitter_link")),an._completed($("twitter_follow"))}},Ae.get_viewer().personal_user.id)},submit_why:function(){return an._why_msg=$F("why-i-like-input"),jt.ajax_submit($("why-i-like-form"),!1,function(){return zt.hide(),an._completed($("why_like"))},!1,$("why-i-like-submit"))},_completed:function(e){var t,n;return e.addClassName("completed"),null!=(n=e.down(".icon-col"))&&n.__date(Element("img",{src:"/static/images/check_36-vflimxFPn.png"})),_(e).css("opacity",.5).fadeTo(500,1),setTimeout(function(){return _(e).css("opacity",1).slideUp().animate({opacity:0},{queue:!1,duration:"normal"})},1500),t=parseInt(e.down(".space").readAttribute("data-space"),10),an._current_space+=t,$("current-space").__date(R.format_bytes(an._current_space)),$("current-space").addClassName("updated"),setTimeout(function(){return $("current-space").removeClassName("updated")},5e3)},_refresh_link_bonuses:function(){return new Ajax.DBRequest("/social_recheck")}};var ln;ln=Qe.Help={toggle_more_help:!1,show_os:function(e,t,n){return t=$(t),$$(".os-filter").invoke("removeClassName","selected"),t.addClassName("selected"),$$(".help-os-section").invoke("hide"),$$(".help-os-"+n).invoke("show"),Event.stop(e)},vote:function(e,t){return new Ajax.DBRequest("/help/"+e+"/vote/"+t),_("#help-vote-cont").fadeOut(),Je.success(pt("Thanks for your feedback!"))}};var _n,un,cn,dn,Ot=function(e,t){return function(){return e.apply(t,arguments)}},Lt=function(e,t){function n(){this.constructor=e}for(var i in t)Mt.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},Mt={}.hasOwnProperty;un=INLINE_JS.Hosts=Qe.Hosts={attach_host_listener:function(e,t){var n,i,r,o;return n=_("#"+e),r=n.data("host-ids"),i=n.data("display-name"),o=function(){return new cn(r,i,t,null,null).show()},_(".unlink-host-link",n).on("click",o),n.on("dblclick",function(){return un.edit(r,e)})},edit:function(e,t){var n,i,r,o,s,a;return r=_("#"+t+" .host-item .sprite-text"),"true"===r.data("editing")?!1:(r.data("editing","true"),i=r.text(),r.data("previous",i),e=l.values(e),o=_('<input type="text" class="name-input skinny-input" size="20" maxlength="256" style="word-wrap: break-word;" />').val(i),a=_('<input type="button" class="button">').val(pt("Save")),a.on("click",function(){return un.doneEditing(e,t)}),n=_('<input type="button" class="button grayed">').val(pt("Cancel")),n.on("click",function(){return un.cancelEditing(t)}),r.empty(),r.append(o,"&nbsp;",a,"&nbsp;",n),s=_("input",r),s.on("keydown",function(){return un.checkKey(e,t)}),s.focus(),!1)},doneEditing:function(e,t){var n,i;return n=_("#"+t+" .host-item .sprite-text"),i=_("input",n).val(),h.SilentBackgroundRequest({url:"/account/change_host_name",data:{host_ids:JSON.stringify(e),name:i},dataType:"json",success:function(e){return un.unedit(n,e.display_name)}})},cancelEditing:function(e){var t;return t=_("#"+e+" .host-item .sprite-text"),un.unedit(t,t.data("previous"))},unedit:function(e,t){return e.data("editing","false"),e.text(t)},dismiss:function(e,t,n,i,r){return h.SilentBackgroundRequest({url:"/account/dismiss_unlink",data:{host_id:e,user_id:t,team_id:n},subject_user:r,success:function(e){return i.remove()}}),!1},checkKey:function(e,t){return function(n){return n=n||window.event,n.keyCode===Event.KEY_RETURN&&un.doneEditing(e,t),n.keyCode===Event.KEY_ESC?un.cancelEditing(t):void 0}},show_device_unlink_modal:function(e,t,n,i,r,o){var s,a;return s=_("#unlink-device-modal-"+r),a={both:l.values(i),personal:[i[Pe.ROLE_PERSONAL]],work:[i[Pe.ROLE_WORK]]},zt.show(n,s[0]),l.values(i).length>1&&s.addClass("show-selector"),_("form input[type=submit]",s).on("click",function(n){return n.preventDefault(),i=a[_(".unlink-select select",s).val()],jt.add_vars(_("form",s)[0],{user_ids:JSON.stringify(i),app_id:t,device_id:JSON.stringify(e),device_name:o}),_("form",s).submit()})}},_n=Qe.DeleteFailuresModal=function(e){function t(){return this.on_show=Ot(this.on_show,this),this.on_confirm_button_click=Ot(this.on_confirm_button_click,this),t.__super__.constructor.apply(this,arguments)}return Lt(t,e),t.prototype.on_confirm_button_click=function(e){return e.preventDefault(),window.location.href="/delete_failures?host_id="+this.host_id,this.hide()},t.prototype.on_show=function(e){var t;return t=mt("Dropbox couldn't delete %(num_failures)d file from the computer <strong>%(host_name)s</strong>. You can download the name of this file and the reason why it couldn't be deleted.","Dropbox couldn't delete %(num_failures)d files from the computer <strong>%(host_name)s</strong>. You can download the names of these files and the reasons why they couldn't be deleted.",this.num_failures).format({host_name:this.name.escapeHTML(),num_failures:this.num_failures}),this.$modal_window.find(".failures_message").html(t)},t}(it),dn=INLINE_JS.show_delete_failures_modal=Qe.show_delete_failures_modal=function(e,t,n){var i;return i=new _n({element_id:"delete-failures-modal"}),i.host_id=e,i.name=t,i.num_failures=n,i.show(),!1},cn=INLINE_JS.UnlinkHostModal=Qe.UnlinkHostModal=function(e){function t(e,n,i,r,o){this.host_ids=e,this.name=n,this.delete_support_type=i,this.owner_id=r,this.team_id=o,this.on_show=Ot(this.on_show,this),this._set_delete_text=Ot(this._set_delete_text,this),this.fail_callback=Ot(this.fail_callback,this),this.success_callback=Ot(this.success_callback,this),this.on_confirm_button_click=Ot(this.on_confirm_button_click,this),t.__super__.constructor.call(this,{element_id:"unlink-host-modal"}),this.show_host_selector=l(this.host_ids).values().length>1}return Lt(t,e),t.prototype.on_confirm_button_click=function(e){var t,n,i;return e.preventDefault(),n=this.$modal_window.find(".unlink_host_form")[0],t=$(this.$modal_window.find(".confirm-button")[0]),this.$modal_window.find("[type=button]").attr("disabled",""),i={host_ids:JSON.stringify(this.get_selected_hosts())},jt.ajax_submit(n,!1,this.success_callback,this.fail_callback,t,i)},t.prototype.success_callback=function(){return window.location.reload()},t.prototype.fail_callback=function(){return this.$modal_window.find("[type=button]").removeAttr("disabled")},t.prototype._set_delete_text=function(e){return this.$modal_window.find(".delete_data_label").text(e)},t.prototype._get_unlink_select=function(){return this.$modal_window.find(".unlink-select select").val()},t.prototype._clear_delete_checkbox=function(){return this.$modal_window.find(".delete_data").prop("checked",!1)},t.prototype.on_show=function(e){var t;return this._clear_delete_checkbox(),this.delete_support_type===Oe.DELETE_ON_UNLINK_OLD_CLIENT?this.$modal_window.find(".unlink_host_modal_content").addClass("show_old_client_modal"):this.delete_support_type===Oe.DELETE_ON_UNLINK_UNSUPPORTED?this.$modal_window.find(".unlink_host_modal_content .unlink_host_form").addClass("hidden"):this.delete_support_type===Oe.DELETE_ON_UNLINK_SUPPORTED_TEAM_ONLY?(this.$modal_window.find(".unlink-choice").change(function(e){return function(t){return e._get_unlink_select()===Pe.ROLE_PERSONAL?e.$modal_window.find(".new_client").hide():e.$modal_window.find(".new_client").show()}}(this)),this._set_delete_text(pt("Delete files from %(team_name)s Dropbox the next time this computer comes online.").format({team_name:Ae.get_viewer().team_name}))):this.delete_support_type===Oe.DELETE_ON_UNLINK_SUPPORTED_PERSONAL_ONLY?(this.$modal_window.find(".unlink-choice").change(function(e){return function(t){return e._get_unlink_select()===Pe.ROLE_WORK?e.$modal_window.find(".new_client").hide():e.$modal_window.find(".new_client").show()}}(this)),this._set_delete_text(pt("Delete files from my personal Dropbox the next time this computer comes online."))):this.delete_support_type===Oe.DELETE_ON_UNLINK_SUPPORTED&&(this._set_delete_text(pt("Delete files from these Dropboxes the next time this computer comes online.")),this.$modal_window.find(".unlink-choice").change(function(e){return function(t){return e._get_unlink_select()===Pe.ROLE_PERSONAL?e._set_delete_text(pt("Delete files from my personal Dropbox the next time this computer comes online.")):e._get_unlink_select()===Pe.ROLE_WORK?e._set_delete_text(pt("Delete files from %(team_name)s Dropbox the next time this computer comes online.").format({team_name:Ae.get_viewer().team_name})):e._set_delete_text(pt("Delete files from these Dropboxes the next time this computer comes online."))}}(this))),this.show_host_selector&&(t="<span class='host_name'></span>",this.$modal_window.find(".unlink-select").removeClass("hidden"),this.$modal_window.find(".unlink-modal-text").html(pt("Which Dropboxes do you want to unlink from %(host_name)s? Any Dropbox you unlink will immediately stop syncing.").format({host_name:t}))),this.$modal_window.find("[name=host_id]").attr("value",this.host_id),this.$modal_window.find("[name=team_id]").attr("value",this.team_id),this.$modal_window.find("[name=user_id]").attr("value",this.owner_id),this.$modal_window.find(".host_name").text(this.name)},t.prototype.get_selected_hosts=function(){var e;return 1===l.values(this.host_ids).length?l.values(this.host_ids):(e=_(".unlink-choice").val(),"both"===e?l.values(this.host_ids):[this.host_ids[e]])},t}(it);var hn;hn=Qe.News={DEFAULT_TAB:"recent-news",init:function(){return $("news-home").on("click","#nav a",function(e,t){var n;return t.hasAttribute("data-div")?(e.preventDefault(),n=t.readAttribute("data-div"),Y.push_state("/news/"+n)):void 0}),Y.add_callback("/news",hn.history_change)},change_tab:function(e){var t;return t=$$("#nav a[data-div="+e+"]").first(),$(t)?($$(".section").invoke("removeClassName","selected"),$$("#nav a").invoke("removeClassName","selected"),$(t).addClassName("selected"),$(e).addClassName("selected")):void 0},history_change:function(e){return e=e||hn.DEFAULT_TAB,hn.change_tab(e)}};var mn;mn=Qe.Recover={init:function(){var e;return e=$("recover-form"),e.observe("submit",this.form_submit.bind(this))},form_submit:function(e){return this.clear_error(),e.preventDefault(),jt.ajax_submit($("recover-form"),null,this.submit_response.bind(this))},submit_response:function(e){var t;return t=JSON.parse(e.responseText),"error"===t.status&&this.show_error(t.msg),"ok"===t.status&&this.show_hosts(t),"redirect"===t.status?window.location.href=t.url:void 0},show_hosts:function(e){var t,n,i,r,o,s,a;for(jt.add_vars($("recover-form"),{check_file:"true"}),$("filename-to-create").update(e.filename),n=$("trusted-hosts"),n.update(),a=e.hosts,i=0,o=a.length;o>i;i++)t=a[i],s=new Element("li"),r="lnx","mac"===t.platform&&(r="osx"),"win"===t.platform&&(r="win"),s.__sert(ye.make("web",r)),s.__sert(new We(t.display_name.escapeHTML())),n.appendChild(s);return $("login-step").hide(),$("hosts-step").show()},show_error:function(e){return $("error-messages").update(e),$("error-messages").show()},clear_error:function(){return $("error-messages").update()}};var pn;pn=Qe.Restore={next:function(e,t){var n,i;return i=_("ul.selected"),n=i.next("ul"),n.addClass("selected"),i.removeClass("selected"),n.next("ul").length?_("#next-page").show():_("#next-page").hide(),_("#prev-page").show(),pn.inc_page(1)},prev:function(e,t){var n,i;return i=_("ul.selected"),n=i.prev("ul"),n.addClass("selected"),i.removeClass("selected"),n.prev("ul").length?_("#prev-page").show():_("#prev-page").hide(),_("#next-page").show(),pn.inc_page(-1)},inc_page:function(e){var t,n;return t=parseInt(_("#page_num").text(),10),n=t+e,_("#page_num").text(n)},init:function(e,t,n){var i;return i=Ae.get_viewer().get_user_by_id(n),_("#next-page").on("click",function(e){return pn.next(e),!1}),_("#prev-page").on("click",function(e){return pn.prev(e),!1}),_("#restore-submit-button").on("click",function(t){return Ut.do_folder_restore(e,i),!1}),_("#restore-cancel-button").on("click",function(e){return Be.redirect(t)}),_("#restore-back-button").on("click",function(e){return Be.redirect(t)})}};var fn,vn,gn,Ot=function(e,t){return function(){return e.apply(t,arguments)}},Lt=function(e,t){function n(){this.constructor=e}for(var i in t)Mt.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},Mt={}.hasOwnProperty;fn=Qe.SelectRoleModal=function(e){function t(){return this.on_show=Ot(this.on_show,this),t.__super__.constructor.apply(this,arguments)}return Lt(t,e),t.prototype.on_select_role=null,t.prototype.on_show=function(){return _(".role-options li").click(function(e){return function(t){var n,i;return n=_(t.target).closest("li"),i=n.data("role"),assert(e.on_select_role,"missing on_select_role implementation"),e.on_select_role(i),e.hide()}}(this))},t}(it),gn=Qe.ShmodelC2DSelectRoleModal=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return Lt(t,e),t.prototype.on_select_role=function(e){var t;return t=function(){return Rt.show_c2d_modal(e)},Ae.get_viewer().is_role_signed_in(e)?t():J.show_modal({role:e,on_success:t})},t}(fn),vn=Qe.ShareShmodelSelectRoleModal=function(e){function t(){return this.on_select_role=Ot(this.on_select_role,this),t.__super__.constructor.apply(this,arguments)}return Lt(t,e),t.prototype.on_select_role=function(e){return Rt.prompt_login_then_share(this.options.link_url,this.options.short_url,this.options.tokenizer_type,e)},t}(fn);var wn;wn=Qe.TabController=Class.create({initialize:function(e,t){var n;return n=$(e),assert(n,e+" is missing."),this.container=n,this.options={killEvent:!0},Object.extend(this.options,t),this.listen()},listen:function(){var e,t,n,i,r,o;for(o=this,i=this.container.select("a"),r=[],t=0,n=i.length;n>t;t++)e=i[t],assert(e.id&&e.id.length>0,"Element is missing an id"),r.push(e.observe("click",function(e){return this.click(e)}.bindAsEventListener(o)));return r},click:function(e){return this.options.killEvent&&Event.stop(e),this.toggle($(e.target))},toggle:function(e){var t,n,i,r,o;return o=this.container.down("a.selected"),o&&(r=$(o.id+"-content"),r&&r.hide()),this.container.select(".selected").invoke("removeClassName","selected"),n=!1,e||(e=this.container.down("a"),n=!0),e.addClassName("selected"),t=$(e.id+"-content"),t&&t.show(),this.options.onTabChange&&this.options.onTabChange(e,o),this.options.url_prefix?(i=this.options.url_prefix,n||(i+="/"+e.id),Y.push_state(i)):void 0}});var bn;bn=Qe.InviteForm={initialized:!1,init:function(){return this.initialized?void 0:_(function(e){return function(){return e.add_auto_completer=new Autocompleter.ContactsTokenizer(Ae.get_viewer().get_user_by_role(Pe.ROLE_WORK),"team-invite-new-collab-input","team-invite-new-whobulk","team-invite-hidden-input",{tokens:[",",";"],hide_import_contacts:!0,suggestions_disabled:!0,contact_filter:function(e){return e.excludeTeamMembers().excludeFacebook().excludeNewStyleGroups().excludeMe()}}),e.add_auto_completer.clearTokens(),e.tokenAdd=_.proxy(e._tokenAdd,e),e.tokenRemove=_.proxy(e._tokenRemove,e),_("#team-invite-new-collab-input")[0].on("token:add",e.tokenAdd),_("#team-invite-new-collab-input")[0].on("token:remove",e.tokenRemove),e.reset_licenses(),e.update_free_licenses_message(),e.initialized=!0,e.setup_tab_support(_),Ht.init()}}(this))},set_emails:function(e,t){return this.invite_modal&&this.invite_modal.update_is_suggestion(t),null!=e?_(function(t){return function(){var n,i,r,o,s;for(t.init(),s=[],r=0,o=e.length;o>r;r++)n=e[r],i=t.add_auto_completer.createTokenInfo(null,n,C.EMAIL),s.push(t.add_auto_completer.addContact(i));return s}}(this)):void 0},rebind_modal_submit_autocompleter:function(){var e,t;return e=this.invite_modal.$modal_window,t=e.find(".tokenizer-submit-button"),t.on("mousedown",function(e){return function(){return e.add_auto_completer.beforeSubmit()}}(this)),this.setup_tab_support(e)},setup_tab_support:function(e){return e.find("#team-invite-new-collab-input").first().on("keyup change",function(){var t;return t=e.find(".new-collab-input").first(),""!==t.val()?t.attr("tabindex",-1):t.removeAttr("tabindex")})},reset_modal_licenses:function(){var e,t,n;return n=null!=__CIRCULAR_DEPENDENCY__.Dashboard?__CIRCULAR_DEPENDENCY__.Dashboard.get_licensed_members():null!=__CIRCULAR_DEPENDENCY__.MembersReact?__CIRCULAR_DEPENDENCY__.MembersReact.get_licensed_members():window.active_team_member_table.get_licensed_members(),this.total_licenses=null!=(e=null!=(t=__CIRCULAR_DEPENDENCY__.MembersReact)&&"function"==typeof t.get_total_licenses?t.get_total_licenses():void 0)?e:this.total_licenses,this.update_used_licenses(n),this.available_licenses=this.total_licenses-this.used_licenses,this.update_license_count(),this.new_users=0},reset_licenses:function(){return this.available_licenses=this.total_licenses-this.used_licenses,this.update_license_count(),this.new_users=0},get_new_users:function(){return this.new_users},_tokenAdd:function(e){return this.available_licenses--,_(window).trigger("token:changed",{remaining_licenses:this.available_licenses}),this.new_users++},_tokenRemove:function(e){return this.available_licenses++,_(window).trigger("token:changed",{remaining_licenses:this.available_licenses}),this.new_users--},already_invited_user:function(e){var t,n,i;if(window.active_team_member_table){t=window.active_team_member_table.data.users;for(i in t)if(n=t[i],n.email===e)return!0}},update_license_count:function(){var e,t;return e=_("#license-count-message"),this.available_licenses<0?(t=this.invite_modal.get_remaining_licenses_message(this.available_licenses),e.addClass("over")):0===this.available_licenses?(t=pt("You have no remaining licenses."),e.removeClass("over")):this.available_licenses>0?(t=mt("You have %(invites)d remaining license.","You have %(invites)d remaining licenses.",this.available_licenses).format({invites:this.available_licenses}),e.removeClass("over")):t="You have   remaining licenses.",e.text(t)},init_modal_licenses_and_reseller:function(e,t,n,i){return this.total_licenses=e,this.is_trial=t,this.invite_modal||(this.invite_modal=new yn(n,this.is_trial,i)),_("body").trigger("invite-modal-initialized")},update_used_licenses:function(e){return this.used_licenses=e,this.reset_licenses()},init_form_licenses:function(e,t,n){return this.total_licenses=e,this.used_licenses=t,this.is_trial=n,bn.reset_licenses()},add_total_licenses:function(e){return e=e||0,e>0&&(this.total_licenses+=e,this.available_licenses+=e,this.update_license_count(),null!=__CIRCULAR_DEPENDENCY__.Dashboard)?__CIRCULAR_DEPENDENCY__.Dashboard.add_licenses(e):void 0},on_add_licenses_exit:function(e,t){var n;return(null!=(n=this.invite_modal)?n.$modal_window:void 0)&&this.rebind_modal_submit_autocompleter(),this.add_total_licenses(t)},reset_modal:function(){var e;return e=this.invite_modal.$modal_window,Kt.reset(e.find("#team-invite-message")[0]),this.add_auto_completer&&(this.add_auto_completer.clearTokens(),this.add_auto_completer.update.hide()),this.reset_modal_licenses(),e.find(".new-collab-input").val("")},on_add_licenses_click:function(e){return e.preventDefault(),null!=this.add_licenses_cb&&rt.unregister(__CIRCULAR_DEPENDENCY__.AddLicensesModal.LICENSES_ADDED,this.add_licenses_cb),this.add_licenses_cb=_.proxy(this.on_add_licenses_exit,this),rt.register(__CIRCULAR_DEPENDENCY__.AddLicensesModal.LICENSES_ADDED,this.add_licenses_cb),rt.push(new __CIRCULAR_DEPENDENCY__.AddLicensesModal)},update_free_licenses_message:function(){var e;return e=this.invite_as_limited(),_(".team-invite-add-licenses").toggle(!e),_("#license-count-message").toggle(!e),_("#license-free-message").toggle(e)},invite_as_limited:function(){var e;return e=_('input[name="membership_type"]'),e&&e.is(":checked")}};var yn,Ot=function(e,t){return function(){return e.apply(t,arguments)}},Lt=function(e,t){function n(){this.constructor=e}for(var i in t)Mt.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},Mt={}.hasOwnProperty;Xe(["modules/core/browser"],function(e){}),yn=function(e){function t(e,n,i){var r;this.transition_view_model=e,this.is_trial=n,this.reseller_contact_info=i,this._reset=Ot(this._reset,this),this._update_form_pricing_information=Ot(this._update_form_pricing_information,this),this._update_remaining_licenses_message=Ot(this._update_remaining_licenses_message,this),this._make_transition_info_request=Ot(this._make_transition_info_request,this),this._handle_token_change=Ot(this._handle_token_change,this),this._licenses_total=Ot(this._licenses_total,this),this.is_making_transition_info_request=Ot(this.is_making_transition_info_request,this),this.__overlay_click_handler=Ot(this.__overlay_click_handler,this),this.__x_click_handler=Ot(this.__x_click_handler,this),this.on_cancel_button_click=Ot(this.on_cancel_button_click,this),this.on_cancel_and_log=Ot(this.on_cancel_and_log,this),this.on_hide=Ot(this.on_hide,this),this.on_show=Ot(this.on_show,this),t.__super__.constructor.call(this,{element_id:"team-invite-wizard",focus:".new-collab-input",title:pt("Invite team members")}),this.inline_add_license=null!=this.transition_view_model,this.inline_add_license&&(this.transition_info_fetcher=new _t([this.transition_view_model]),this.probability=Math.random()),this.skip_reset=!1,this.making_transition_info_request=!1,this.transition_info_callback=null,this.subgrowth_biz_upsell="V1"===qe.SUBGROWTH_BIZ_UPSELL_VARIANT,this.exp_subgrowth_biz_teams_im_incremental_license_cost="V1"===(r=qe.SUBGROWTH_BIZ_TEAMS_IM_INCREMENTAL_LICENSE_COST)||"V2"===r}return Lt(t,e),t.prototype.on_confirm_button_click=function(e){var t,n,i;return i=bn.invite_as_limited()?0:this.add_qty,n="send_invites",i&&(n="invite_buy"),t="false",_("#team-invite-message").val()&&(t="true"),m.TeamsWebActionsLogger.log("invite_member_open_invite_click",{invite_or_buy:n,invite_count:""+this._getInvitesCount(),added_message:t,transition_request:this.is_making_transition_info_request(),licenses_to_add:Math.max(0,this._licenses_to_add()),expected_price:_("#expected_price").val()}),In.add_users(e,i)},t.prototype.on_show=function(){var e,t,n;return this._reset(),n=_('input[name="membership_type"]'),null!=n&&n.attr("checked",!1),null!=n&&n.click(function(e){return function(){return bn.update_free_licenses_message(),e._updated_charges_messages(bn.invite_as_limited())}}(this)),e=_("#team-invite-wizard .team-invite-add-licenses"),e.on("click",_.proxy(bn.on_add_licenses_click,bn)),_(window).on("token:changed",this._handle_token_change),bn.initialized&&(jt.clear_errors(),bn.update_license_count(),bn.update_free_licenses_message()),rt.register(rt.CLEAR,function(){return bn.reset_modal()}),t=this.inline_add_license&&this.add_qty>0&&!bn.invite_as_limited(),m.TeamsWebActionsLogger.log("invite_member_open",{invite_or_buy:t?"invite_buy":"send_invites",url:Be.get_uri().path})},t.prototype.on_hide=function(){return _(window).off("token:changed",this._handle_token_change)},t.prototype.on_cancel_and_log=function(){var e,t,n;return n=this.inline_add_license&&this.add_qty>0&&!bn.invite_as_limited(),t="send_invites",n&&(t="invite_buy"),e="false",_("#team-invite-message").val()&&(e="true"),m.TeamsWebActionsLogger.log("invite_member_open_cancel",{invite_or_buy:t,invite_count:""+this._getInvitesCount(),added_message:e})},t.prototype.on_cancel_button_click=function(e){return this.on_cancel_and_log(),t.__super__.on_cancel_button_click.call(this,e)},t.prototype.__x_click_handler=function(e){return this.on_cancel_and_log(),t.__super__.__x_click_handler.call(this,e)},t.prototype.__overlay_click_handler=function(e){return this.on_cancel_and_log(),t.__super__.__overlay_click_handler.call(this,e)},t.prototype.is_making_transition_info_request=function(){return this.making_transition_info_request},t.prototype._licenses_to_add=function(){return-1*bn.available_licenses},t.prototype._licenses_total=function(){return bn.total_licenses+this._licenses_to_add()},t.prototype._getInvitesCount=function(){return bn.total_licenses-bn.used_licenses-bn.available_licenses},t.prototype._handle_token_change=function(e,t){return this.remaining_licenses=t.remaining_licenses,this._updateConfirmButton(),this._update_remaining_licenses_message(),this.inline_add_license?(clearTimeout(this.fetch_transition_timeout_id),this.fetch_transition_timeout_id=setTimeout(function(e){return function(){return e._make_transition_info_request(),e.fetch_transition_timeout_id=null}}(this),100)):void 0},t.prototype._make_transition_info_request=function(){var e,t,n,i;return this.making_transition_info_request=!0,t=(new Date).getTime(),this.current_callback_token=t,e=this._licenses_to_add(),n=this._licenses_total(),i=function(i){return function(r){return i._update_form_pricing_information(t,e,n,null!=r?r[0]:void 0)}}(this),e>0?this.transition_info_fetcher.get(i,{total_users:this._licenses_total()}):i(null)},t.prototype._update_remaining_licenses_message=function(){var e,t;return e=this.$modal_window.find("#license-count-message"),t=this.get_remaining_licenses_message(this.remaining_licenses),e.text(t)},t.prototype.get_remaining_licenses_message=function(e){var t,n,i,r;return i=this._getInvitesCount(),n="",r=mt("invitation","invitations",i),0>e?n=this.reseller_contact_info?this.reseller_contact_info.name&&this.reseller_contact_info.phone?mt("You need more licenses for this %(type)s. Contact %(name)s at %(phone)s to add more.","You need more licenses for these %(type)s. Contact %(name)s at %(phone)s to add more.",i).format({name:this.reseller_contact_info.name,phone:this.reseller_contact_info.phone,type:r}):mt("You need more licenses for this %(type)s. Contact your reseller to add more.","You need more licenses for these %(type)s. Contact your reseller to add more.",i).format({type:r}):mt("You need more licenses for this %(type)s.","You need more licenses for these %(type)s.",i).format({type:r}):0===e?(n=pt("After these %(type)s, you’ll have no remaining licenses.").format({type:r}),1===i&&(n=pt("After this %(type)s, you’ll have no remaining licenses.").format({type:r}))):(t=mt("After this %(type)s","After these %(type)s",i).format({type:r}),n=t+mt(", you’ll have %(count)d remaining license.",", you’ll have %(count)d remaining licenses.",e).format({count:e})),n},t.prototype._update_form_pricing_information=function(e,t,n,i){var r,o,s,a,l,u,c,d,h;if(e===this.current_callback_token)return i&&t>0?(this.add_qty=t,r=this.transition_view_model.state.currency,l=i.current_total.amount,a=lt.formatCurrency(l,r),d=lt.formatCurrency(i.recurring_total_tax.amount,r),o=this.is_trial?0:i.transition_view_model.expected_price,s=mt("license","licenses",t),this.exp_subgrowth_biz_teams_im_incremental_license_cost&&(c=t*i.per_license_price.amount,h=i.tax_percentage/100,h>0&&(c*=1+h),u=lt.formatCurrency(c,r),_(".non-prorated-new-amount").text(u)),_(".new-amount").text(a),_(".add-qty").text(t),_(".license-word").text(s),_(".recurring-amount").text(d),_(".total-qty").text(n),_("#expected_price").val(o),_("#expected_overage").val(t),this._updated_charges_messages(bn.invite_as_limited())):this._reset(),this.making_transition_info_request=!1},t.prototype.update_is_suggestion=function(e){return this.subgrowth_biz_upsell&&(this.is_suggestion=e,this._updateConfirmButton(),this._updateTitle(),this.remaining_licenses)?this._update_remaining_licenses_message():void 0},t.prototype._updateTitle=function(){return this.subgrowth_biz_upsell?_("#team-invite-wizard .db-modal-title .db-modal-title-text").text(pt("Invite team members")):void 0;
},t.prototype._updateConfirmButton=function(e){var t,n;return null==e&&(e=!1),t=_(".team-invite-buttons .confirm-button"),n=this.subgrowth_biz_upsell?e?pt(this.is_trial?"Invite and add":"Invite and buy"):mt("Send invite","Send invites",this._getInvitesCount()):e?pt(this.is_trial?"Invite and add":"Invite and buy"):mt("Send invite","Send invites",this._getInvitesCount()),t.val(n)},t.prototype._reset=function(){return this.add_qty=0,_(".charges-section").hide(),_("#expected_price").val(0),_("#expected_overage").val(0),this._updateConfirmButton()},t.prototype._updated_charges_messages=function(e){var t;return t=this.inline_add_license&&this.add_qty>0&&!e,_(".charges-section").toggle(t),this._updateConfirmButton(t)},t}(it);var kn,xn,En,Cn,Dn,Tn,Sn,An,Rn,Nn,In,$n,On,Ln,Mn,Ot=function(e,t){return function(){return e.apply(t,arguments)}},Lt=function(e,t){function n(){this.constructor=e}for(var i in t)Mt.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},Mt={}.hasOwnProperty;Xe(["modules/core/browser"],function(e){}),An={ACTIVE:1,PENDING:2,ERROR:3,REMOVED:4,SUSPENDED:5},In=INLINE_JS.Team=Qe.Team={_use_async_reset:!1,team_id:Ae.get_viewer().team_id,set_team_id:function(e){this.team_id=e},setup_beta_modal_listeners:function(){var e,t,n,i,r,o,s,a,l,u,c,d;for(n=_(".feature-list .enroll-button"),t=_(".feature-list .enroll-button-admins"),r=_(".feature-list .feedback-button"),o=0,l=n.length;l>o;o++)e=n[o],i=_(e).data("feature"),_(e).click(function(e){return function(){return new xn(e,!0).show()}}(i)),e.disabled=!1;for(s=0,u=t.length;u>s;s++)e=t[s],i=_(e).data("feature"),_(e).click(function(e){return function(){return new xn(e,!1).show()}}(i)),e.disabled=!1;for(d=[],a=0,c=r.length;c>a;a++)e=r[a],i=_(e).data("feature"),d.push(_(e).click(function(e){return function(){return new En(e).show()}}(i)));return d},invite_modal_show:function(e,t){return bn.invite_modal?(this.invite_modal_already_initialized?(bn.invite_modal.show(),bn.rebind_modal_submit_autocompleter()):(bn.invite_modal.show(),bn.init(),this.invite_modal_already_initialized=!0),null!=window.active_team_member_table&&bn.update_used_licenses(window.active_team_member_table.get_licensed_members()),bn.set_emails(e,t)):_("body").one("invite-modal-initialized",function(t){return function(){return t.invite_modal_show(e)}}(this))},init_admin:function(){return Wt.set_vertical_space(2),_("form.activity-report-generator").submit(this.submit_report_form.bind(this))},init_team_name_change_notice:function(){return _(".team_name_change_notice .hide_link").click(function(e){return function(t){return e.hide_team_name_change_banner()}}(this))},add_users:function(e,t){var n,i,r,o,s;return Event.stop(e),r=$("team-invite-form"),assert(r,"Couldn't find the team invite form."),i=_(r).find("input[name='emails']"),o="send_invites",t&&(o="invite_buy"),n="false",_("#team-invite-message").val()&&(n="true"),0===i.length?(Je.error(pt("You haven't included anyone to invite! Please invite at least one person.")),void m.TeamsWebActionsLogger.log("invite_member_open_invite_error",{invite_or_buy:o,error_reason:"no_invites"})):(s=function(s){return function(){var a;return a=jt.collect_form_vars(r),_.extend(a,{team_id:s.team_id,url:Be.get_uri().path}),jt.add_loading(e.target),new Ajax.DBRequest("/account/team/add_users",{parameters:a,subject_user:Ae.get_viewer().work_user,progress_text:pt("Inviting members..."),noAutonotify:!0,onSuccess:function(e){var r,s,a,l;return jt.remove_loading(),bn.reset_modal(),bn.add_total_licenses(t),bn.invite_modal.hide(),a=JSON.parse(e.responseText),a?(null!=__CIRCULAR_DEPENDENCY__.MembersReact?__CIRCULAR_DEPENDENCY__.MembersReact.refresh_member_stats():window.active_team_member_table?window.active_team_member_table.add_users(null!=a?a.users:void 0):null!=__CIRCULAR_DEPENDENCY__.Dashboard&&__CIRCULAR_DEPENDENCY__.Dashboard.set_num_invited(null!=a?a.num_invited:void 0),r=function(){var e,t;e=null!=a?a.users:void 0,t=[];for(s in e)l=e[s],t.push(l);return t}(),1===r.length?Je.success(pt("Invited %(user_email)s.").format({user_email:r[0].email})):r.length>1?Je.success(pt("Invited %(user_count)d people.").format({user_count:r.length})):Je.error(mt("Skipped %(num_skipped)d person who is already a member of the team.","Skipped %(num_skipped)d people who are already members of the team.",i.length).format({num_skipped:i.length})),m.TeamsWebActionsLogger.log("invite_member_open_invite_success",{invite_or_buy:o,invite_count:""+r.length,added_message:n})):Je.error()},onFailure:function(e){var t,n;return e&&(0===e.responseText.indexOf("err:")?(t=e.responseText.substr(4),0===t.indexOf("{")?(n=t.evalJSON(!0),jt.fill_errors(r,n),m.TeamsWebActionsLogger.log("invite_member_open_invite_error",{invite_or_buy:o,error_reason:"form_input_invalid"})):(t=new We(t),Je.error(t))):(Je.error(),m.TeamsWebActionsLogger.log("invite_member_open_invite_error",{invite_or_buy:o,error_reason:"problem_request"}))),jt.remove_loading(),_("input[type='submit']").prop("disabled",!1)}})}}(this),setTimeout(function(){return bn.invite_modal.is_making_transition_info_request()?void 0:s()},100))},show_demo_signup_modal:function(e,t,n,i,r){var o,s,a,l;return this.webinar_key=e,this.webinar_iso_datetime=t,this.webinar_date=n,this.webinar_title=i,this.tab_url=r,l=pt("Register for a webinar on %(start_time)s").format({start_time:this.webinar_date}),s=new Cn({element_id:"demo-signup-modal",title:l}),s.show(),s.$modal_window.find("input[name=webinar_key]").attr("value",this.webinar_key),s.$modal_window.find("input[name=webinar_title]").attr("value",this.webinar_title),s.$modal_window.find("input[name=Sales_Webinar_Topic__c]").attr("value",this.webinar_title),s.$modal_window.find("input[name=Sales_webinar_date__c]").attr("value",this.webinar_iso_datetime),a=s.$modal_window.find("input[name=retURL]"),a.attr("value",a.val()+"#"+this.tab_url),o=s.$modal_window.find("#demo-signup-form")[0],o.on("submit",s.on_confirm_button_click)},show_unsuspend_modal:function(e,t,n,i){var r;return r=new Sn({element_id:"dfe-unsuspend-modal",focus:"confirm"}),r.user_name=e||n,r.email=n,r.user_id=t,r.team_id=this.team_id,r.refresh_cb=i,r.show(),!1},show_remove_or_deactivate_modal:function(e,t,n,i,r,o,s,a,l,_){var u;return u=new Dn({element_id:"dfe-remove-or-deactivate-user-modal",focus:".new-collab-input"}),u.user_name=t||i,u.email=i,u.user_id=n,u.team_id=this.team_id,u.invited=r,u.limited=s,u.num_api_apps=o,u.hide_transfer_wipe=a,u.user_recovery_enabled=l,u.refresh_cb=_,u.show(),!1},show_remove_modal:function(e,t,n,i,r,o,s,a,l,_,u){var c;return c=new Tn({element_id:"dfe-remove-user-modal",focus:".new-collab-input"}),c.user_name=t||i,c.email=i,c.user_id=n,c.team_id=this.team_id,c.invited=r,c.num_api_apps=o,c.hide_transfer_setting=s,c.hide_remote_wipe_setting=a,c.user_recovery_enabled=_,c.refresh_cb=u,c.user_is_managed=l,c.show(),!1},remove_user:function(e,t){var n,i,r;return alert("in remove_user"),Event.stop(e),i=_("input[type=submit]","#remove-user-modal"),i.attr("disabled",1),r=zt.vars.user_id,n=t?!0:_("input[name=should_disable]:checked","#remove-user-modal").val(),new Ajax.DBRequest("/account/team/remove_user",{parameters:{team_id:this.team_id,user_id:r,should_disable:n},onSuccess:function(e){return function(t){var n,i,r;return r=JSON.parse(t.responseText),null!=(n=window.active_team_member_table)&&n.remove_user(zt.vars.user_id),null!=(i=window.removed_team_member_table)&&i.add_users(r),e.decrement_used_licenses(),Je.success(pt("User removed."))}}(this),cleanUp:function(){return zt.hide(),i.removeAttr("disabled")}})},show_reinvite_modal:function(e,t,n,i){var r;return wt.fillVal(i,"reinvite-user-email"),wt.fillVal(t,"reinvite-user-team"),r=pt("Resend invite to '%(email_address)s'").format({email_address:I.em_snippet(i,18)}),zt.show(r,$("reinvite-user-modal"),{user_id:n,button:e})},email_verification:this.email_verification=new et("work"),show_email_verification_modal:function(){return this.email_verification.show_verify_modal(null,d.NEW_DFB_TEAM)},reinvite_user:function(e){var t;return Event.stop(e),t=zt.vars.user_id,new Ajax.DBRequest("/account/team/reinvite_user",{parameters:{team_id:this.team_id,user_id:t},onSuccess:function(e){var n,i,r,o;return Je.success(pt("Invite sent.")),null!=(i=$("team-member-info"))&&i.update(e.responseText),n=window.active_team_member_table,n?(o=n.data.users[t],o.invite_expired=!1,r={},r[t]=o,n.update_user_data(r)):void 0},cleanUp:function(){return zt.hide()}})},show_request_license_modal:function(e,t){var n;return n=pt("Send upgrade request?"),zt.show(n,$("request-license-modal"),{user_id:t,button:e})},request_license:function(e){var t;return Event.stop(e),t=zt.vars.user_id,new Ajax.DBRequest("/team/request_license",{parameters:{team_id:this.team_id,user_id:t},onSuccess:function(e){return _("#request_license_text").hide(),_("#request-license-section").hide(),Je.success(pt("Request sent."))},cleanUp:function(){return zt.hide()}})},show_user_activity_log_modal:function(e,t,n){var i;return i=_("#activity-log-modal"),i.find(".activity-log-email").text(t),i.find(".activity-log-name").text(n),i.find("#activity-log-user-message").show(),zt.show(pt("Create activity report"),i[0],{user_id:e})},show_team_activity_log_modal:function(e,t){var n;return n=_("#activity-log-modal"),n.find(".activity-log-email").text(e),n.find(".activity-log-name").text(t),n.find("#activity-log-team-message").show(),zt.show(pt("Create full activity report"),n[0])},generate_activity_log:function(e){var t,n,i,r,o,s,a;return Event.stop(e),n=_("#activity-log-modal"),i=n.find("input[name='from_date']").val(),o=n.find("input[name='to_date']").val(),i>o?void Je.error(pt("Your start date is after your end date.")):(r=this.team_id,a=zt.vars.user_id,s=(new Date).getTimezoneOffset().toString(),t=_(".activity-report-generator .freshbutton-blue"),t.prop("disabled",!0),new Ajax.DBRequest("/team/events_report/csv",{parameters:{from_date:i,to_date:o,team_id:r,user_id:a,tzoffset:s},onSuccess:function(e){return Je.success(pt("Report started. We'll email you when it's ready."))},cleanUp:function(){return zt.hide(),t.prop("disabled",!1)}}))},show_reset_password_modal:function(e,t,n){var i,r;return r=Ge({path:"/team/admin/member",query:{id:n}}).toString(),_("#reset-password-modal .member-name").text(t),_("#reset-password-modal .member-page-link").attr("href",r),i=pt("Reset password for '%(user_name)s'").format({user_name:t}),zt.show(i,$("reset-password-modal"),{user_id:n,button:e})},reset_password:function(e){var t;return Event.stop(e),t=zt.vars.user_id,new Ajax.DBRequest("/account/team/reset_password",{parameters:{team_id:this.team_id,user_id:t},onSuccess:function(e){return Je.success(pt("User's password reset."))},cleanUp:function(){return zt.hide()}})},show_admin_status_modal:function(e,t,n,i,r,o){var s,a,l,_;return a=r.trim()||i,l=void 0,s=void 0,_=void 0,o?(_=pt("Add admin permissions for '%(person_name)s'").format({person_name:a.escapeHTML()}),l=pt("Are you sure you want to add admin permissions for <strong>%(person_name)s</strong>?").format({person_name:a.escapeHTML()}),s=pt("Add admin permissions",{comment:"make this user an admin; give them the permissions an admin has"})):(_=pt("Remove admin privileges from '%(person_name)s'").format({person_name:a.escapeHTML()}),l=pt("Are you sure you want to remove admin permissions from <strong>%(person_name)s</strong>?").format({person_name:a.escapeHTML()}),s=pt("Remove admin permissions",{comment:"clicking this button completes the action: it removes a person's admin status"})),wt.fillVal(i,"admin-status-email"),wt.fillVal(l,"admin-status-action"),wt.fillVal(s,"admin-status-button-action"),zt.show(_,$("admin-status-modal"),{user_id:n,button:e,admin_on:o}),!1},set_admin_status:function(e){var t;return Event.stop(e),t=zt.vars.user_id,new Ajax.DBRequest("/account/team/set_admin_status",{parameters:{team_id:this.team_id,user_id:t,on:zt.vars.admin_on?"yes":"no"},onSuccess:function(e){var t,n;return t=pt(zt.vars.admin_on?"User's admin status granted.":"User's admin status removed."),null!=__CIRCULAR_DEPENDENCY__.MembersReact?__CIRCULAR_DEPENDENCY__.MembersReact.refresh_member_stats():window.active_team_member_table?(n=JSON.parse(e.responseText),window.active_team_member_table.update_user_data(n),Je.success(t)):zt.vars.admin_on?window.location="/team/admin/member?id=%d&msg=granted".format(zt.vars.user_id):window.location="/team/admin/member?id=%d&msg=removed".format(zt.vars.user_id)},cleanUp:function(){return zt.hide()}})},show_disable_2fa_modal:function(e,t,n){return _("#disable-2fa-modal .member-name").text(n),zt.show(pt("Disable two-step verification"),$("disable-2fa-modal"),{user_id:t,elm:e})},show_reset_2fa_modal:function(e,t,n){return _("#reset-2fa-modal .member-name").text(n),zt.show(pt("Reset two-step verification"),$("reset-2fa-modal"),{user_id:t,user_name:n,elm:e})},reset_2fa:function(){return new Ajax.DBRequest("/account/team/reset_2fa",{parameters:{team_id:this.team_id,user_id:zt.vars.user_id},onSuccess:function(e){var t;return _(".tfa_enabled").replaceWith(pt("Disabled")),t=JSON.parse(e.responseText),null!=__CIRCULAR_DEPENDENCY__.MembersReact?__CIRCULAR_DEPENDENCY__.MembersReact.refresh_member_stats():window.active_team_member_table?window.active_team_member_table.update_user_data(t):__CIRCULAR_DEPENDENCY__.MemberActionsMenu&&__CIRCULAR_DEPENDENCY__.MemberActionsMenu.update_container_users(".buttons",t),Je.success(pt("Two-step verification reset for %(user_name)s").format({user_name:zt.vars.user_name})),zt.hide()}})},disable_2fa:function(){return new Ajax.DBRequest("/account/team/disable_2fa",{parameters:{team_id:this.team_id,user_id:zt.vars.user_id},onSuccess:function(e){var t;return _(".tfa_enabled").replaceWith(pt("Disabled")),t=JSON.parse(e.responseText),null!=__CIRCULAR_DEPENDENCY__.MembersReact?__CIRCULAR_DEPENDENCY__.MembersReact.refresh_member_stats():window.active_team_member_table?window.active_team_member_table.update_user_data(t):__CIRCULAR_DEPENDENCY__.MemberActionsMenu&&__CIRCULAR_DEPENDENCY__.MemberActionsMenu.update_container_users(".buttons",t),Je.success(pt("Two-step verification disabled.")),zt.hide()}})},show_sso_preview_email:function(e){return zt.show(pt("Email preview"),$(e))},show_sso_sample_email:function(e){return zt.show(pt("Sample email"),$(e))},show_user_message_modal:function(e,t,n){var i;return wt.fillVal(n,"user-message-email"),i=pt("Send email to '%(user_name)s'").format({user_name:e}),$("user-message").value="",zt.show(i,$("user-message-modal"),{user_name:e,user_id:t}),vt.focus.defer("user-message")},send_user_message:function(){var e,t;return t=zt.vars.user_id,e=$F("user-message").trim(),new Ajax.DBRequest("/account/team/send_user_message",{parameters:{user_id:t,team_id:this.team_id,message:e},onSuccess:function(){var e;return e=zt.vars.user_name,Je.success(pt("Message successfully sent to %(user_name)s.").format({user_name:e})),zt.hide()}})},hide_team_name_change_banner:function(){return new Ajax.DBRequest("/account/team/name_change_notice_received",{parameters:{team_id:this.team_id}}),_(".team_name_change_notice").hide(),!1},hide_pin_banner:function(){return new Ajax.DBRequest("/team/invalidate_pin"),_(".pin_notice").hide()},hide_pin_banner_with_user_id:function(e,t){var n;return n=function(e){return _(t).closest("span").removeClass("on").addClass("off")},null===e?new Ajax.DBRequest("/team/invalidate_pin",{onSuccess:n}):new Ajax.DBRequest("/team/invalidate_pin",{parameters:{user_id:e},onSuccess:n})},get_pin_with_user_id:function(e,t,n){var i;return null==n&&(n=null),null===n&&(n=function(e,t){return _(t).closest("span").find(".pin-value").text(e.pin+" -"),_(t).closest("span").removeClass("off").addClass("on")}),i=function(e){var i;return i=JSON.parse(e.responseText),n(i,t)},null===e?new Ajax.DBRequest("/team/generate_pin",{onSuccess:i}):new Ajax.DBRequest("/team/generate_pin",{parameters:{user_id:e},onSuccess:i})},send_team_message:function(e){var t;return Event.stop(e),t=$F("team-message").trim(),t?new Ajax.DBRequest("/account/team/send_team_message",{parameters:{team_id:this.team_id,message:t},onSuccess:function(e){return Je.success(pt("Message successfully sent to team.")),zt.hide()}}):void 0},show_security_message_modal:function(){return(new $n).show()},send_team_security_message:function(e){var t,n;return Event.stop(e),n=$F("team-security-message").trim(),t=$("team-security-message-form"),new Ajax.DBRequest("/account/team/send_team_message",{parameters:t.serialize(!0),onSuccess:function(e){return Je.success(pt("Message successfully sent.")),zt.hide()}})},used_licenses:0,total_licenses:0,set_used_licenses:function(e,t){return this.used_licenses=e,this.total_licenses=t},decrement_used_licenses:function(){return this.set_used_licenses(this.used_licenses-1,this.total_licenses)},show_migration_link:function(e,t){return $("migration-url").value=t,zt.show(pt("Migration link for '%(email)s'").format({email:I.em_snippet(e,18)}),$("migrate-url-modal")),$("migration-url").select()},show_end_session_modal:function(e,t,n){return Wt.hide_all(),_("#end-session-modal .member-name").text(_("#member-name").text()),zt.show(pt("Close web session",{comment:"Log out of your current Dropbox web session"}),$("end-session-modal"),{login_id:e,user_id:t,elm:n})},end_session:function(){return new Ajax.DBRequest("/logout_remote_session",{parameters:{remote_login_id:zt.vars.login_id,team_id:this.team_id,user_id:zt.vars.user_id},onSuccess:function(){return zt.hide(),In.remove_closest_row(zt.vars.elm),Je.success(pt("Web session closed."))}})},unlink_device:function(e,t,n,i,r,o,s){var a,l;return Wt.hide_all(),a=$("unlink-device-modal-"+o),l=pt("Unlink %(device_name)s").format({device_name:n}),zt.show(l,a,{app_id:t,user_id:r,elm:s,device_id:e,display_name:n})},unlink_device_submit:function(){return new Ajax.DBRequest("/account/unlink_team_device",{parameters:{app_id:zt.vars.app_id,team_id:this.team_id,user_id:zt.vars.user_id,device_id:JSON.stringify(zt.vars.device_id)},subject_user:Ae.get_viewer().work_user,onSuccess:function(){return zt.hide(),In.remove_closest_row(zt.vars.elm),Je.success(pt("%(device_name)s unlinked.").format({device_name:zt.vars.display_name}))}})},disable_app:function(e,t,n,i){return Wt.hide_all(),_("#disable-app-modal .app-name").text(t),_("#disable-app-modal .member-name").text(_("#member-name").text()),zt.show(pt("Disable '%(app_name)s'?").format({app_name:t}),$("disable-app-modal"),{app_id:e,user_id:n,elm:i})},disable_app_submit:function(){return new Ajax.DBRequest("/api/uninstall_app",{parameters:{app_id:zt.vars.app_id,keep_sandbox_files:!0,team_id:this.team_id,user_id:zt.vars.user_id},subject_user:Ae.get_viewer().work_user,onSuccess:function(e){return zt.hide(),In.remove_closest_row(zt.vars.elm),Je.success(e.responseText)}})},remove_closest_row:function(e){var t,n,i;return t=_(e).closest(".team_admin_table_row"),n=_(t).closest(".team_admin_table"),1===n.find(".team_admin_table_row").length?(i=n.prev(".team_admin_table_title"),i.length||(i=_(".team_apps_table_panel")),i.remove(),n.remove()):t.remove()},submit_report_form:function(e){return _(e.target.elements.tzoffset).val(""+(new Date).getTimezoneOffset()),!0},show_recover_user_modal:function(e,t,n,i,r){var o;return o=new Nn({element_id:"recover-user-modal",focus:"cancel"}),o.user_name=e||n,o.email=n,o.user_id=t,o.team_id=this.team_id,o.refresh_cb=r,o.pre_removal_join_state=i,o.show(),!1}},xn=Qe.BetaEnrollConfirmationModal=function(e){function t(e,n){var i;this.feature_name=e,this.on_confirm_button_click=Ot(this.on_confirm_button_click,this),i="admins-",n&&(i=""),t.__super__.constructor.call(this,{element_id:"beta-enroll-"+i+"confirmation-modal__"+this.feature_name}),this.enroll_team=i}return Lt(t,e),t.prototype.on_confirm_button_click=function(e){var t;return t="#beta-enroll-%(enroll_team)sconfirmation-modal__%(feature_name)s form".format({enroll_team:this.enroll_team,feature_name:this.feature_name}),_("<input>").attr({type:"hidden",name:"feature_name",value:this.feature_name}).appendTo(t),this.$modal_window.addClass("ajax-loading")},t}(it),En=Qe.BetaFeedbackModal=function(e){function t(e){this.feature_name=e,this.success=Ot(this.success,this),t.__super__.constructor.call(this,{element_id:"beta-feedback-modal"}),this.on_confirm_button_click=function(e){return function(t){var n,i,r;return t.preventDefault(),n=_(t.target),i=n.closest("form"),r={feature_name:e.feature_name},jt.ajax_submit(i[0],!1,e.success,e.error,n[0],r)}}(this)}return Lt(t,e),t.prototype.success=function(e){return Je.success(pt("Thank you for your feedback.")),this.$modal_window.hide()},t.prototype.error=function(e){return 200!==e.status?Je.error(pt("Failed to submit feedback. Please try again.")):void 0},t}(it),Cn=Qe.DemoSignupModal=function(e){function t(){return this.on_show=Ot(this.on_show,this),this.on_confirm_button_click=Ot(this.on_confirm_button_click,this),t.__super__.constructor.apply(this,arguments)}return Lt(t,e),t.prototype.on_confirm_button_click=function(e){var t,n,i,r,o,s,a,l,u,c,d,h;return e.preventDefault(),d=$("demo-signup-form"),l=$("1210"),s=_(d).find("input[name='first_name']").val(),_(l).find("input[name='FirstName']").attr("value",s),a=_(d).find("input[name='last_name']").val(),_(l).find("input[name='LastName']").attr("value",a),o=_(d).find("input[name='email']").val(),_(l).find("input[name='Email']").attr("value",o),c=_(d).find("input[name='phone_number']").val(),_(l).find("input[name='Phone']").attr("value",c),t=_(d).find("input[name='company_name']").val(),_(l).find("input[name='Company']").attr("value",t),i=_(d).find("select[name='company_size']"),n=i.find("option:selected").val(),_(l).find("input[name='Company_size__c']").attr("value",n),r=$(this.$modal_window.find(".confirm-button")[0]),h=function(e){return function(t){return e.$modal_window.hide(),l.submit()}}(this),u=jt.collect_form_vars(d,!0),jt.ajax_submit(d,!1,h,!1,r,u,!0)},t.prototype.on_show=function(e){return this.$modal_window.find(".db-modal-content").css({"overflow-y":""}),Ht.init()},t}(it),kn=Qe.AccountTransferBaseModal=function(e){function t(e,n,i){this.file_action_selector=n,this.transfer_choice_selector=i,this._clearInput=Ot(this._clearInput,this),this._markInputInvalid=Ot(this._markInputInvalid,this),this._markInputValid=Ot(this._markInputValid,this),this._tokenRemove=Ot(this._tokenRemove,this),this._tokenAdd=Ot(this._tokenAdd,this),this._selectChange=Ot(this._selectChange,this),this._isTransferSelected=Ot(this._isTransferSelected,this),this.checkAndApproveMemberRemoval=Ot(this.checkAndApproveMemberRemoval,this),this.on_cancel_button_click=Ot(this.on_cancel_button_click,this),this.execute_form=Ot(this.execute_form,this),this.get_cancel_button=Ot(this.get_cancel_button,this),this.get_confirm_button=Ot(this.get_confirm_button,this),this.get_button_class=Ot(this.get_button_class,this),this.set_modal_class=Ot(this.set_modal_class,this),this.handleAjaxFailure=Ot(this.handleAjaxFailure,this),this.on_show=Ot(this.on_show,this),t.__super__.constructor.call(this,e,this.file_action_selector,this.transfer_choice_selector)}return Lt(t,e),t.prototype.on_show=function(){return 0!==this.$modal_window.find("#manage-files-new-collab-input").length?(this.auto_completer=new Autocompleter.TeamTokenizer(Ae.get_viewer().get_user_by_role(Pe.ROLE_WORK),"manage-files-new-collab-input","manage-files-new-whobulk","manage-files-hidden-input",{hide_import_contacts:!0,suggestions_disabled:!0,wrap_name:!0,single_token:!0,contact_filter:function(e){return function(t){return t.excludeNonTeam().excludeNewStyleGroups().excludeByEmail(e.email)}}(this)}),this.tokenAdd=_.proxy(this._tokenAdd,this),this.tokenRemove=_.proxy(this._tokenRemove,this),this.$collab_input=this.$modal_window.find("#manage-files-new-collab-input")[0],this.$collab_input.on("token:add",this.tokenAdd),this.$collab_input.on("token:remove",this.tokenRemove),this.$textinput=this.$modal_window.find(".tokenized_autocompleter_container .textinput"),this.selectChange=_.proxy(this._selectChange,this),this.$modal_window.find(this.file_action_selector).on("change",this.selectChange)):void 0},t.prototype.handleAjaxFailure=function(e){return 200===e.status&&this._isTransferSelected()?this._markInputInvalid():void 0},t.prototype.set_modal_class=function(e){var t,n,i,r,o,s;return i="suspending deleting approve_transfer_to_suspended",r=this.get_form(),r.removeClass(i),null!=e&&r.addClass(e),null!=(o=_(".suspend_option_content"))&&o.removeClass("title_bubble no_suspend"),n=null!=this.limited&&this.limited,t=null!=this.invited&&this.invited,n||t?(_(".suspend_option_content").addClass("title_bubble no_suspend"),s="",s=pt(t?"Invited members can not be suspended":"Limited members can not be suspended"),_(".suspend_option_content").attr("data-title",s)):void 0},t.prototype.get_button_class=function(){var e;return e=this.get_form(),e.hasClass("suspending")?".confirm_deactivate_button":e.hasClass("deleting")?".confirm_delete_button":e.hasClass("approve_transfer_to_suspended")?".confirm_transfer_to_suspended_button":void 0},t.prototype.get_confirm_button=function(){var e;return e=this.get_button_class(),null!=e?$(this.$modal_window.find(e+" .confirm-button")):$(this.$modal_window.find(".confirm-button"))},t.prototype.get_cancel_button=function(){var e;return e=this.get_button_class(),null!=e?$(this.$modal_window.find(e+" .cancel-button")):$(this.$modal_window.find(".cancel-button"))},t.prototype.execute_form=function(){var e,t;return t=this.get_form()[0],e=this.get_confirm_button(),jt.ajax_submit(t,!1,this.success_callback,this.handleAjaxFailure,e)},t.prototype.on_cancel_button_click=function(e){var n;return e.preventDefault(),n=this.get_form(),n.hasClass("approve_transfer_to_suspended")?(this.reset_button_click(this.$confirm_button,this.on_confirm_button_click),this.reset_button_click(this.$cancel_button,this.on_cancel_button_click)):t.__super__.on_cancel_button_click.apply(this,arguments)},t.prototype.reset_button_click=function(e,t){return e.off("click"),null!=t?e.on("click",t):void 0},t.prototype.checkAndApproveMemberRemoval=function(e){var t,n;return!_("#deactivate_option").is(":checked")&&_("#transfer_files_on").is(":checked")&&!this.invited&&(t=_(".tokenized_autocompleter_container .token-display-text"),n=_(".tokenized_autocompleter_container .token-suspended"),t.length&&n.length)?(this.set_modal_class("approve_transfer_to_suspended"),this.$modal_window.find(".target_user_name").text(t.text()),this.$confirm_button=this.get_confirm_button(),this.reset_button_click(this.$confirm_button,function(e){return function(t){return e.execute_form()}}(this)),this.$cancel_button=this.get_cancel_button(),void this.$cancel_button.on("click",e)):this.execute_form()},t.prototype._isTransferSelected=function(){return _(this.transfer_choice_selector).prop("checked")},t.prototype._selectChange=function(e){return this._isTransferSelected()?this.$textinput.removeClass("unselected"):this.$textinput.addClass("unselected")},t.prototype._tokenAdd=function(e){return this.$collab_input.hide(),e.memo.valid?this._markInputValid():this._markInputInvalid()},t.prototype._tokenRemove=function(e){return this.$collab_input.show(),this._clearInput()},t.prototype._markInputValid=function(){return this._clearInput(),this.$textinput.addClass("valid")},t.prototype._markInputInvalid=function(){return this._clearInput(),this.$textinput.addClass("invalid")},t.prototype._clearInput=function(){return this.$textinput.removeClass("valid"),this.$textinput.removeClass("invalid")},t}(it),$n=Qe.TwoFactorMessageModal=function(e){function t(){t.__super__.constructor.call(this,{element_id:"team-security-message-modal",focus:"#team-security-message"})}return Lt(t,e),t.prototype.on_confirm_button_click=function(e){return In.send_team_security_message(e),this.hide()},t}(it),Sn=Qe.DfeUnsuspendUserModal=function(e){function t(e){this.on_confirm_button_click=Ot(this.on_confirm_button_click,this),this.failure_callback=Ot(this.failure_callback,this),this.success_callback=Ot(this.success_callback,this),t.__super__.constructor.call(this,e)}return Lt(t,e),t.prototype.before_show=function(){var e;return t.__super__.before_show.call(this),e=pt("Unsuspend %(user_name)s").format({user_name:this.user_name}),this.$modal_window.find(".db-modal-title-text").text(e),this.$modal_window.find("[name=user_id]").attr("value",this.user_id),this.$modal_window.find("[name=team_id]").attr("value",this.team_id),this.$modal_window.find("[name=email]").attr("value",this.email),this.$modal_window.find(".unsuspended_name").text(this.user_name),this.$modal_window.find(".unsuspended_email").text(this.email)},t.prototype.success_callback=function(e){var t;return null!=(t=__CIRCULAR_DEPENDENCY__.MembersReact)&&t.refresh_member_stats(),this.hide(),"function"==typeof this.refresh_cb?this.refresh_cb("unsuspended"):void 0},t.prototype.failure_callback=function(e){return this.$modal_window.find(".cancel-button").attr("disabled",!1)},t.prototype.on_confirm_button_click=function(e){var t,n;return e.preventDefault(),n=this.$modal_window.find(".dfe-unsuspend-modal")[0],t=$(this.$modal_window.find(".confirm-button")[0]),this.$modal_window.find(".cancel-button").attr("disabled",!0),jt.ajax_submit(n,!1,this.success_callback,this.failure_callback,t)},t}(it),Dn=Qe.DfeRemoveOrDeactivateUserModal=function(e){function t(e){this.on_confirm_button_click=Ot(this.on_confirm_button_click,this),this.handleAjaxFailure=Ot(this.handleAjaxFailure,this),this.success_callback=Ot(this.success_callback,this),this.on_show=Ot(this.on_show,this),this.handle_change_action=Ot(this.handle_change_action,this),this.switch_to_removal_mode=Ot(this.switch_to_removal_mode,this),this.switch_to_deactivation_mode=Ot(this.switch_to_deactivation_mode,this),this.show_removal_content=Ot(this.show_removal_content,this),this.show_deactivation_content=Ot(this.show_deactivation_content,this),t.__super__.constructor.call(this,e,"input[name=transfer_files]","#transfer_files_on")}return Lt(t,e),t.prototype.get_form=function(){return this.$modal_window.find(".dfe-remove-or-deactivate-user-modal")},t.prototype.set_form_action_to_deactivate=function(){return _(".dfe-remove-or-deactivate-user-modal").attr("action","/account/team/suspend_user")},t.prototype.set_form_action_to_remove=function(){return _(".dfe-remove-or-deactivate-user-modal").attr("action","/account/team/remove_user")},t.prototype.show_deactivation_content=function(){return this.set_modal_class("suspending")},t.prototype.show_removal_content=function(){return this.set_modal_class("deleting")},t.prototype.switch_to_deactivation_mode=function(){return this.show_deactivation_content(),this.set_form_action_to_deactivate()},t.prototype.switch_to_removal_mode=function(){return this.show_removal_content(),this.set_form_action_to_remove(),this.invited?this.$modal_window.find(".remote_wipe_setting").remove():void 0},t.prototype.handle_change_action=function(e){return e.preventDefault(),_("#deactivate_option").is(":checked")?this.switch_to_deactivation_mode():this.switch_to_removal_mode()},t.prototype.on_show=function(e){var n,i;return t.__super__.on_show.call(this),_("input[name=deactivate_or_remove]").on("change",this.handle_change_action),this.$modal_window.find(".deleted_user_name").text(this.user_name),this.num_api_apps?(n=mt("%(num)s API app","%(num)s API apps",this.num_api_apps).format({num:this.num_api_apps}),this.$modal_window.find(".num_api_apps").text(n)):this.$modal_window.find(".api_app_warning").hide(),i=pt("Suspend or delete %(user_name)s").format({user_name:this.user_name}),this.limited||this.invited?(_("#deactivate_option").prop("disabled",!0),_("#delete_option").attr("checked","checked"),this.switch_to_removal_mode()):(_("#deactivate_option").attr("checked","checked"),this.switch_to_deactivation_mode()),this.$modal_window.find(".db-modal-title-text").text(i),this.$modal_window.find("[name=user_id]").attr("value",this.user_id),this.$modal_window.find("[name=team_id]").attr("value",this.team_id),this.hide_transfer_wipe?(this.$modal_window.find(".transfer_data_on_remove_setting").remove(),
this.$modal_window.find(".remote_wipe_setting").remove()):void 0},t.prototype.success_callback=function(e){var t,n,i,r,o;return null!=__CIRCULAR_DEPENDENCY__.MembersReact&&__CIRCULAR_DEPENDENCY__.MembersReact.refresh_member_stats(),t="",i=null,r={user_id:this.user_id,team_id:this.team_id,user_name:this.user_name,email:this.email},o=null,_("#deactivate_option").is(":checked")?(t="suspended",n=pt("User suspended"),i=null,r=null):(t="deleted",n=pt("User deleted"),o=pt("Restore",{comment:"Undo message that enables restoring a recently deleted user"}),!this.user_recovery_enabled||_("#transfer_files_on").is(":checked")||this.invited?(i=null,r=null):i=function(e){return In.show_recover_user_modal(e.user_name,e.user_id,e.email,An.ACTIVE,function(e){return Je.success(pt("User %(msg)s".format({msg:e})))})}),this.hide(),"function"==typeof this.refresh_cb?this.refresh_cb(t,n,r,i,o):void 0},t.prototype.handleAjaxFailure=function(e){return t.__super__.handleAjaxFailure.call(this,e),this.$modal_window.find(".cancel-button").attr("disabled",!1)},t.prototype.on_confirm_button_click=function(e){return e.preventDefault(),this.$modal_window.find(".cancel-button").attr("disabled",!0),this.checkAndApproveMemberRemoval(this.switch_to_removal_mode)},t}(kn),Tn=Qe.DfeRemoveUserModal=function(e){function t(e){this.on_confirm_button_click=Ot(this.on_confirm_button_click,this),this.switch_to_removal_mode=Ot(this.switch_to_removal_mode,this),this.handleAjaxFailure=Ot(this.handleAjaxFailure,this),this.success_callback=Ot(this.success_callback,this),this.on_show=Ot(this.on_show,this),t.__super__.constructor.call(this,e,"input[name=transfer_files]","#transfer_files_on")}return Lt(t,e),t.prototype.get_form=function(){return this.$modal_window.find(".dfe-remove-user-modal")},t.prototype.on_show=function(e){var n,i;return t.__super__.on_show.call(this),this.$modal_window.find(".remove_user_name").text(this.user_name),i=this.invited?pt("Uninvite %(user_name)s").format({user_name:this.user_name}):pt("Delete %(user_name)s").format({user_name:this.user_name}),this.$modal_window.find(".db-modal-title-text").text(i),this.num_api_apps?(n=mt("%(num)s API app","%(num)s API apps",this.num_api_apps).format({num:this.num_api_apps}),this.$modal_window.find(".num_api_app").text(n)):this.$modal_window.find(".api_app_warning").hide(),this.$modal_window.find("[name=user_id]").attr("value",this.user_id),this.$modal_window.find("[name=team_id]").attr("value",this.team_id),this.user_is_managed?this.$modal_window.find(".remove-content-limited-member").remove():(this.$modal_window.find(".remove_content").remove(),this.$modal_window.find(".remote_wipe_setting").remove()),this.invited&&(this.$modal_window.find(".transfer_files_option").remove(),this.$modal_window.find(".remote_wipe_setting").remove(),this.get_form().addClass("invited")),this.hide_transfer_setting&&this.$modal_window.find(".transfer_files_option").remove(),this.hide_remote_wipe_setting?this.$modal_window.find(".remote_wipe_setting").remove():void 0},t.prototype.success_callback=function(e){var t,n,i,r,o,s,a,l;return o=JSON.parse(e.responseText),null!=__CIRCULAR_DEPENDENCY__.MembersReact?__CIRCULAR_DEPENDENCY__.MembersReact.refresh_member_stats():(null!=(i=window.active_team_member_table)&&i.remove_user(this.user_id),null!=(r=window.removed_team_member_table)&&r.add_users(o)),t="",s=null,a=null,l=null,this.invited?(t="uninvited",n=pt("User uninvited")):(t="deleted",n=pt("User deleted"),this.user_recovery_enabled&&!_("#transfer_files_on").is(":checked")&&(l=pt("Restore",{comment:"Undo message that enables restoring a recently deleted user"}),a={user_id:this.user_id,team_id:this.team_id,user_name:this.user_name,email:this.email},s=function(e){return In.show_recover_user_modal(e.user_name,e.user_id,e.email,An.SUSPENDED,function(e){return Je.success(pt("User %(msg)s".format({msg:e})))})})),In.decrement_used_licenses(),this.hide(),"function"==typeof this.refresh_cb?this.refresh_cb(t,n,a,s,l):void 0},t.prototype.handleAjaxFailure=function(e){return t.__super__.handleAjaxFailure.call(this,e),this.$modal_window.find(".cancel-button").attr("disabled",!1)},t.prototype.switch_to_removal_mode=function(){return this.set_modal_class()},t.prototype.on_confirm_button_click=function(e){return e.preventDefault(),this.$modal_window.find(".cancel-button").attr("disabled",!0),this.checkAndApproveMemberRemoval(this.switch_to_removal_mode)},t}(kn),Rn=Qe.ManageFilesModal=function(e){function t(e,n,i){this.source_user_id=e,this.source_user_name=n,this.options=i,this.on_confirm_button_click=Ot(this.on_confirm_button_click,this),this.switch_to_manage_files=Ot(this.switch_to_manage_files,this),this.success_callback=Ot(this.success_callback,this),t.__super__.constructor.call(this,this.options,"input[name=file_action]","#transfer_files_on")}return Lt(t,e),t.prototype.get_form=function(){return this.$modal_window.find(".manage-files-modal")},t.prototype.on_show=function(){var e;return t.__super__.on_show.call(this),this.$modal_window.find("[name='source_user_id']").attr("value",this.source_user_id),this.$modal_window.find(".source-user-name").text(this.source_user_name),e=pt("Manage %(team_member)s's files").format({team_member:this.source_user_name}),this.$modal_window.find(".db-modal-title-text").text(e)},t.prototype.success_callback=function(e){var t;return t=JSON.parse(e.responseText),null!=__CIRCULAR_DEPENDENCY__.MembersReact?__CIRCULAR_DEPENDENCY__.MembersReact.refresh_member_stats():window.removed_team_member_table?window.removed_team_member_table.update_user_data(t):null!=__CIRCULAR_DEPENDENCY__.MemberActionsMenu&&__CIRCULAR_DEPENDENCY__.MemberActionsMenu.update_container_users(".buttons",t),_("#transfer_files_on").prop("checked")?Je.success(pt("Transfer started",{comment:"This refers to the start of a file transfer from one Dropbox to another"})):Je.success(pt("Permanently deleted files")),this.hide()},t.prototype.switch_to_manage_files=function(){return this.set_modal_class("manage-files-modal")},t.prototype.on_confirm_button_click=function(e){return e.preventDefault(),this.checkAndApproveMemberRemoval(this.switch_to_manage_files)},t}(kn),Ln=Qe.show_manage_files_modal=function(e,t){var n;return n=new Rn(e,t,{element_id:"manage-files-modal",focus:".new-collab-input"}),n.show()},Nn=Qe.RecoverUserModal=function(e){function t(e){this.on_cancel_button_click=Ot(this.on_cancel_button_click,this),this.on_confirm_button_click=Ot(this.on_confirm_button_click,this),this.failure_callback=Ot(this.failure_callback,this),this.success_callback=Ot(this.success_callback,this),t.__super__.constructor.call(this,e)}return Lt(t,e),t.prototype.before_show=function(){var e;return t.__super__.before_show.call(this),e=pt("Restore %(user_name)s?").format({user_name:this.user_name}),this.$modal_window.find(".db-modal-title-text").text(e),this.$modal_window.find("[name=user_id]").attr("value",this.user_id),this.$modal_window.find("[name=team_id]").attr("value",this.team_id),this.$modal_window.find(".user_name").text(this.user_name),this.$modal_window.find(".user_email").text(this.email),this.pre_removal_join_state===An.SUSPENDED?(this.$modal_window.find(".recover_content_active_user").remove(),this.$modal_window.find(".recover_content_suspended_user").show()):(this.$modal_window.find(".recover_content_active_user").show(),this.$modal_window.find(".recover_content_suspended_user").remove())},t.prototype.success_callback=function(e){var t;return null!=(t=__CIRCULAR_DEPENDENCY__.MembersReact)&&t.refresh_member_stats(),this.hide(),"function"==typeof this.refresh_cb?this.refresh_cb("restored"):void 0},t.prototype.failure_callback=function(e){return this.$modal_window.find(".cancel-button").attr("disabled",!1)},t.prototype.on_confirm_button_click=function(e){var t,n;return e.preventDefault(),this.$modal_window.find(".cancel-button").attr("disabled",!0),n=this.$modal_window.find(".recover-user-modal")[0],t=$(this.$modal_window.find(".confirm-button")[0]),jt.ajax_submit(n,!1,this.success_callback,this.failure_callback,t)},t.prototype.on_cancel_button_click=function(e){return e.preventDefault(),m.TeamsWebActionsLogger.log("admin_restore_user_attempt_cancelled",{restorable_user_id:this.user_id,team_id:this.team_id}),t.__super__.on_cancel_button_click.call(this,e)},t}(it),Mn=function(){var e;return e=function(e,t){var n,i;return _(t).css("display","none"),n=_(t).closest("#user_generate_liveops_pin"),i=n.find(".user_generate_liveops_pin_value"),i.text(e.pin),_(t).addClass("liveops_pin_elem_invisible"),n.find(".user_generate_liveops_pin_text").removeClass("liveops_pin_elem_invisible")},In.get_pin_with_user_id(null,this,e),!1},_("#user_generate_liveops_pin_button").click(Mn),On=function(){return _("#help_callus_title").hide(),_("#help_callus_details").show(),!1},_("#help_callus_trigger").click(On);var Un;Un=Qe.UpdateEvents={ADD:"db:add_file_objects",REMOVE:"db:remove_file_objects",MOVE:"db:move_file_objects"};var jn;jn=Qe.BrowseURL={_DEFAULTS:{d:!1,from_scl_sync_modal:!1,select:!1,open_preview:!1},make_browse_url_from_fq_path:function(e,t,n){var i,r,o,s;null==n&&(n={}),assert("string"==typeof t,"expected explicit fq_path string"),o=Ge({path:w.get_browse_root(e)+t}),r=Y.deconstruct_url().qargs;for(i in n)s=n[i],i in this._DEFAULTS&&!!s!==this._DEFAULTS[i]&&(r[i]=s);for(i in r)i in this._DEFAULTS||delete r[i];return Y.construct_url(String(o),r)}};var Fn;Fn=Qe.BrowseFile=Class.create({initialize:function(e){}}),Fn._CATEGORIES={IMAGE:"bmp cr2 gif ico jpeg jpg nef png psd tif tiff svg svgz",VIDEO:"3gp 3gpp 3gpp2 avi dv flv m2t m4v mkv mov mp4 mpeg mpg mts ts vob wmv",AUDIO:"aif flac m4a m4p mp3 ogg wav wma",DOCUMENT:"ai cdr csv doc docx docm eps fla indd keynote numbers otf pages pdf ppt pptx pptm pps ppsx ppsm ps rtf swf txt wpd xls xlsx xlsm",COMPRESSED_FILE:"7z bz2 gz gzip rar tar zip",CODE:"as as3 asm aspx bat c cc cmake coffee cpp cs css cxx diff erb erl groovy gry h haml hh hpp hxx java js json jsx less lst m make ml mm out patch php pl plist properties py rb sass scala scm script scss sh sml sql vb vi vim xml xsd xsl yaml yml",DISK_IMAGE:"dmg iso",EXECUTABLE:"exe",SHORTCUT:"lnk",LINK:"url webloc",FONT:"ttf"},Fn.EXTENSION_TO_CATEGORY={},Fn.CATEGORY_TO_TRANSLATION={FILE:pt("file"),FOLDER:pt("folder"),SHARED_FOLDER:pt("shared folder"),TEAM_SHARED_FOLDER:pt("team folder"),PUBLIC_FOLDER:pt("folder"),IMAGE:pt("image"),VIDEO:pt("video"),AUDIO:pt("audio"),DOCUMENT:pt("document"),COMPRESSED_FILE:pt("archive"),CODE:pt("code"),DISK_IMAGE:pt("disk image"),EXECUTABLE:pt("executable"),SHORTCUT:pt("shortcut"),LINK:pt("link"),FONT:pt("font"),SANDBOX:pt("app folder")},Fn.CATEGORY_TO_DELETED_TRANSLATION={FILE:pt("deleted file"),FOLDER:pt("deleted folder"),SHARED_FOLDER:pt("deleted shared folder"),TEAM_SHARED_FOLDER:pt("deleted team folder"),PUBLIC_FOLDER:pt("deleted folder"),IMAGE:pt("deleted image"),VIDEO:pt("deleted video"),AUDIO:pt("deleted audio"),DOCUMENT:pt("deleted document"),COMPRESSED_FILE:pt("deleted archive"),CODE:pt("deleted code"),DISK_IMAGE:pt("deleted disk image"),EXECUTABLE:pt("deleted executable"),SHORTCUT:pt("deleted shortcut"),LINK:pt("deleted link"),FONT:pt("deleted font"),SANDBOX:pt("deleted app folder")},function(){var e,t,n,i,r;i=Fn._CATEGORIES,r=[];for(e in i)n=i[e],r.push(function(){var i,r,o,s;for(o=n.trim().split(" "),s=[],i=0,r=o.length;r>i;i++)t=o[i],s.push(Fn.EXTENSION_TO_CATEGORY[t]=e);return s}());return r}();var qn;qn=INLINE_JS.BrowseActions=Qe.BrowseActions=Class.create({initialize:function(e){return this._set_files(e)},firefly_logging_helper:function(e){return Pn.in_search_mode()&&e?(this._firefly_log_values.action_type=e,m.SearchClientActivityLogger.log("result_action",Pn.active_user.id,this._firefly_log_values)):void 0},unlisten:function(){},get_files:function(){return this._files},_set_files:function(e){var t;return this._files=$A(e),this._log_extras={},this.get_files().length>0?(t=e.first(),this._log_extras={path:t.fq_path,ns_id:t.ns_id},this._firefly_log_values={file_nsid:t.ns_id,file_sjid:t.sjid,firefly:!1,match_type:t.match_type,position:t.sort_rank,request_id:t.request_id,viewport:"full-view"}):void 0}});var Pn;Pn=INLINE_JS.Browse=Qe.Browse={KEY_SCOPE:"browse",SCROLL_DURATION:.5,files:[],init:function(e,t,n,i,r,o,s){return this.browse_actions_ctor=t,this.global_actions_ctor=n,this.browse_actions_context_ctor=i,this.global_actions_context_ctor=r,this.ns_id_to_mount_point=o,"number"!=typeof s?void raiseAndReport("a user_id was not passed into Browse.init"):(this.active_user=Ae.get_viewer().get_user_by_id(s),__CIRCULAR_DEPENDENCY__.active_user_loaded=!0,void(this.active_user||raiseAndReport("No active_user was found in Browse.init")))},setup:function(e,t){var n;return null==t&&(t=null),this.ns_id_to_mount_point=e.ns_id_to_mount_point,this.compiled_tmpl=We.tmpl("list_item_tmpl"),this.render_timeout=null,this.inside_root_folder=""===e.containing_fq_path,this.inside_dir=e.inside_dir,this.inside_deleted_dir=e.inside_deleted_dir,this.inside_shared_folder=e.inside_shared_folder,n="inside_deleted_dir",this.inside_deleted_dir?$("browse").addClassName(n):$("browse").removeClassName(n),this.inside_dir?(this._containing_ns_id=e.containing_ns_id,this._containing_ns_path=e.containing_ns_path,this._containing_fq_path=e.containing_fq_path,this._containing_mount_point=e.containing_mount_point,this._containing_sf_perm_role=e.containing_sf_perm_role):void 0},_get_helper:function(e){return assert(this.inside_dir,"accessed "+e+", but not inside a directory"),Pn[e]},containing_fq_path:function(){return this.inside_dir?this._get_helper("_containing_fq_path"):""},update:function(e,t){return null==t&&(t=null),$("browse-box").show(),this.clear(),"string"==typeof e&&(e=JSON.parse(e)),this.setup(e,t),document.fire(g.UPDATE),_(document).trigger(g.UPDATE,[e])},reload_fqpath:function(e,t){return this.reload(null,vt.urlquote(e),t)},force_reload:function(){return this.reload(this.containing_ns_id(),vt.urlquote(this.containing_ns_path()),!0)}};var Bn;Bn=Qe.ProgressWatcher={job_info:{},INIT_POLL_INT:1e3,FAILS_MEAN_FAIL:3,MODAL_WAIT_MS:1e3,watch:function(e,t){var n,i,r;if(e.async_task_id){if(!e.async_task_id.match(/^[A-Za-z0-9_\-=]*$/))return;i=e.async_task_id}else i=e.job_id;return Bn.job_info[i]={},n=Bn.job_info[i],n.subject_user=e.subject_user||(null!=(r=e.parameters)?r[Pe.UID_PARAM_NAME]:void 0),n.req=e,n.is_async_task=!!e.async_task_id,n.poll_int=Bn.INIT_POLL_INT,n.poll_count=0,n.int_id=setInterval(Bn.update_for(i),n.poll_int),n.failures=0,n.start_time=T.time(),n.dont_hide=t},update_for:function(e){return function(){return Bn.update(e)}},backoff:function(e){var t;return t=Bn.job_info[e],clearInterval(t.int_id),t.poll_int=Math.min(Math.floor(1.5*t.poll_int),3e4),t.int_id=setInterval(Bn.update_for(e),t.poll_int)},update:function(e){var t,n;return n=Bn.job_info[e],ot.peek(e)?Bn.done(e):(n.poll_count++,n.poll_count%10===0&&Bn.backoff(e),!n.modaled&&T.time()-n.start_time>Bn.MODAL_WAIT_MS&&(t=n.req.options,st.show(t.progress_text),t.onProgress=st.update,null!=t.on_modal_shown&&t.on_modal_shown(),n.modaled=!0),n.is_async_task?Bn.get_async_task_status(e):Bn.get_job_status(e))},get_job_status:function(e){return new Ajax.DBRequest("/job_status/"+e,{method:"post",subject_user:Bn.job_info[e].subject_user,onSuccess:function(t){var n,i;if(n=Bn.job_info[e],i=t.responseText,0===i.indexOf("err"))return Bn.done(e),void(n.req.options.onFailure&&!ot.handled(e)&&n.req.options.onFailure(t));if(0===i.indexOf("done"))return n.req.options.job=!1,ot.peek(e)||new Ajax.Request("/job_results/"+e,{method:"post",parameters:{t:ze.read(Ue.JS_CSRF_COOKIE)},onSuccess:function(t){return ot.handled(e)?void 0:(bt.clearWorkingMessage(),n.req.options.onSuccess?n.req.options.onSuccess(t):void 0)},onFailure:function(t){return ot.handled(e)?void 0:(bt.clearWorkingMessage(),n.req.options.onFailure?n.req.options.onFailure(t):void 0)}}),Bn.done(e);try{if(n.req.options.onProgress)return n.req.options.onProgress(t.responseText)}catch(e){}},onFailure:function(t){var n;return n=Bn.job_info[e],n.failures++,n.failures>=Bn.FAILS_MEAN_FAIL?(n.req.options.onFailure&&n.req.options.onFailure(t,!0),bt.remove(n.req),Bn.done(e)):void 0}})},get_async_task_status:function(e){return new Ajax.DBRequest("/async_task_status/"+e,{method:"post",subject_user:Bn.job_info[e].subject_user,onSuccess:function(t){var n,i;if(n=Bn.job_info[e],i=t.responseText,0===i.indexOf("done:")||0===i.indexOf("err:"))return ot.handled(e),bt.clearWorkingMessage(),0===i.indexOf("done:")&&(t.responseText=i.substr(5)),n.req.options.onSuccess&&n.req.options.onSuccess(t),n.req.options.onComplete&&n.req.options.onComplete(t),Bn.done(e);if(0===i.indexOf("async_task_err:"))return Je.error(new We(i.substr(15))),ot.handled(e),bt.clearWorkingMessage(),Bn.done(e),Pn.force_reload();try{if(n.req.options.onProgress)return n.req.options.onProgress(t.responseText)}catch(e){}},onFailure:function(t){var n;if(n=Bn.job_info[e],n.failures++,n.failures>=Bn.FAILS_MEAN_FAIL){try{n.req.options.onFailure&&n.req.options.onFailure(t,!0)}catch(e){}return bt.remove(n.req),Bn.done(e)}}})},done:function(e){var t;return t=Bn.job_info[e],clearInterval(t.int_id),t.dont_hide?st.update("1/1"):(delete Bn.job_info[e],t.req.async_task_id&&t.req.async_task_id!==e?void 0:st.hide(e))}};var Yn,zn,Hn,At=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};Hn=Qe.NamespaceEvents=function(){function e(e){this.ns_id=e,this.earliest=Number.MAX_VALUE,this.events=[],this.seen={},this.done=!1}return e}(),Yn=Qe.EventDatePicker=function(){function e(e){var t,n,i;this.on_change=e,_(document.body).on("click",function(e){return function(t){return e.hide_calendar(t)}}(this)),i=new Element("div",{id:"cal_container"}),_(i).bind("click",function(e){return e.preventDefault()}),_(document.body).append(i),this.calendar=new Xt("cal_container",{onDateChange:function(e){return function(t){return e.on_change(t)}}(this),disable_future:!0}),_(i).css("position","fixed"),n=_("#cal_date"),t=_("#cal_container"),He.clone_position(t,n,{setWidth:!1,setHeight:!1,offsetTop:n.height(),offsetLeft:n.width()-t.children().first()[0].offsetWidth}),this.hide_calendar()}return e.prototype.show_calendar=function(e){return this.shown?(_("#cal_container").hide(),void(this.shown=!1)):(_("#cal_container").show(),this.shown=!0)},e.prototype.hide_calendar=function(e){return e&&_(e.target).closest("#cal_date").length>0?void 0:(_("#cal_container").hide(),this.shown=!1,!0)},e}(),zn=INLINE_JS.Events=Qe.Events={ns:null,role:"all",now:Number(new Date),timestamp:vt.start_of_day(new Date(Number(new Date)+864e5)),request_in_flight:!1,one_day:864e5,user_navigated_away:!1,init:function(e,t,n,i,r){var o,s,a;return null==r&&(r=!1),this.awaitingFirstRender=!0,a=Y.deconstruct_url(),this.first_event_map=e,this.roles=t,this.rss_data=n,this.role_has_events=i,this.deletions_only=r,this.role_picker=Ye.get_controller(_("#role-selector")),1===this.roles.length?this.role=this.roles[0].role:a.qargs.role?(this.role=a.qargs.role,this.role_picker.set_state(this.role)):this.deletions_only&&(this.role=this.roles[this.roles.length-1].role),this.date_picker=new Yn(function(e){return function(t){return e.change_date(t),e.set_url(),m.WebMiscActivityLogger.log("filter_events_date")}}(this)),this._init_state(),this.role_picker.on_state_change=function(e){return function(){return e.role=e.role_picker.get_state(),e.ns&&!e.valid_roles().some(function(t){return t.ns_ids.contains(e.ns.ns_id)})&&(e.ns=null,Gt.set_selected_by_value(_("#namespace-list")[0],"false")),e.set_url(),e.get_more(!0)}}(this),J.set_during_login_callback(function(e){return function(e,t){return window.location.reload()}}(this)),_(window).bind("beforeunload",function(e){return function(){e.user_navigated_away=!0}}(this)),_("#namespace-list-container")[0]&&_("#namespace-list-container")[0].observe("db:change",function(e){return function(t){return e.ns=e.namespaces[JSON.parse(t.memo)],e.set_url(),e.get_more(!0),m.WebMiscActivityLogger.log("filter_events_shared_folder")}}(this)),_(window).on("scroll",function(e){return function(){return document.body.scrollTop=Math.min(document.body.scrollTop,document.body.scrollHeight-He.viewport_dimensions().height-10),e.get_more()}}(this)),a.qargs.ns&&(Gt.set_selected_by_value(_("#namespace-list")[0],a.qargs.ns),this.ns=this.namespaces[a.qargs.ns]),a.qargs.date&&(s=a.qargs.date.split("-").map(Number),o=new Date(s[2],s[1]-1,s[0]),this.date_picker.calendar.selected_date=o,this.change_date(o)),this.update_calendar_first_day(),_("#reset-rss-link").on("click",function(e){return function(t){var i;return n=e.rss_data[null!=(i=e.ns)?i.ns_id:void 0]||e.rss_data[e.role],new Ajax.DBRequest("/reset_rss",{parameters:{ns_id:n.ns_id},onSuccess:function(){return Je.success(pt("RSS feed url successfully reset.")),Be.redirect("/events")}}),!1}}(this)),this.get_more()},_init_state:function(){var e,t,n,i,r,o,s,a;for(this.namespaces={},o=l(this.roles).values(),e=0,n=o.length;n>e;e++)for(a=o[e],s=a.ns_ids,t=0,i=s.length;i>t;t++)r=s[t],this.namespaces[r]=new Hn(r);return this.ns?this.ns=this.namespaces[this.ns.ns_id]:void 0},change_date:function(e){return this.timestamp=Number(e)+this.one_day,(this.timestamp<this.earliest()||this.timestamp>this.latest)&&(this.latest=this.timestamp,this._init_state()),_("#cur_date_text").text(Kn.localize(e)),this.get_more(!0)},is_scrolled_down:function(){var e,t,n;return n=He.scroll_offsets().top,t=He.viewport_dimensions().height,e=_("#events").height(),n+t+50>=e},get_more:function(e){var t,n,i;if(!this.request_in_flight)return l(this.valid_nss()).all(function(e){return e.done})?void this.render():e||this.is_scrolled_down()?(this.request_in_flight=!0,this.render(),n=function(e){return function(){return l(e.valid_nss()).map(function(e){return e.ns_id}).join(",")}}(this),t=Math.min(this.earliest(),this.timestamp/1e3,Math.floor(this.now/1e3)),i={page_size:25,ns_ids:n(),timestamp:t},this.deletions_only&&(i.deletions_only=!0),new Ajax.DBRequest("/events/ajax",{method:"POST",parameters:i,onSuccess:function(e){return function(t){var i,r,o,s,a,u,c,d,h,m,p,f,v,g;for(i=JSON.parse(t.responseText),e.request_in_flight=!1,f=i.events,o=0,u=f.length;u>o;o++)r=f[o],r.html=_(r.html)[0],p=r.pkey+" "+(r.html.textContent||r.html.innerText),h=e.namespaces[r.ns_id],h.seen[p]||(h.events.push(r),h.seen[p]=!0,h.earliest=r.timestamp);if(i.events.length>0)for(v=i.ns_ids,s=0,c=v.length;c>s;s++)m=v[s],e.namespaces[m].earliest=l(i.events).map(function(e){return e.timestamp}).min();if(e.render(),i.events.last())e.get_more();else if(l(i.ns_ids).join(",")!==n())e.get_more();else for(g=i.ns_ids,a=0,d=g.length;d>a;a++)m=g[a],e.namespaces[m].done=!0;return L.configureAllLinks("#event-table",".inline-restore","events")}}(this),onError:function(e){return function(){return e.request_in_flight=!1,e.user_navigated_away?void 0:Je.error(pt("We had problems loading your events feed; please try again later."))}}(this)})):void this.render()},valid_roles:function(){return"all"!==this.role?l(this.roles).filter(function(e){return function(t){return t.role===e.role}}(this)):this.roles},valid_nss:function(){return this.ns?[this.ns]:l(this.valid_roles()).map(function(e){return function(e){return e.ns_ids}}(this)).flatten().map(function(e){return function(t){return e.namespaces[t]}}(this)).uniq()},earliest:function(){return l(this.valid_nss()).map(function(e){return function(e){return e.earliest}}(this)).max()},latest:Number.MAX_VALUE,update_calendar_first_day:function(){return this.date_picker.calendar.options.first_day=vt.start_of_day(new Date(l(this.valid_nss()).map(function(e){return function(t){return e.first_event_map[t.ns_id]}}(this)).min())),this.date_picker.calendar.selected_date<this.date_picker.calendar.options.first_day&&(this.date_picker.calendar.selected_date=vt.start_of_day(new Date(Number(this.date_picker.calendar.options.first_day)+this.one_day)),this.change_date(this.date_picker.calendar.selected_date)),this.date_picker.calendar.render()},set_url:function(){var e,t,n,i;return n=new Date(this.timestamp-this.one_day),t=this.now-this.timestamp>0,e={},this.ns&&(e.ns=this.ns.ns_id),"all"!==this.role&&(e.role=this.role),t&&(e.date=n.getDate()+"-"+(n.getMonth()+1)+"-"+n.getFullYear()),i=this.deletions_only?"/deleted_files":"/events",Y.push_state(i,e)},render:function(){var e,t,n,i,r,o,s,a,u,c,d,h,p,f,v,g,w,b,y,k,x,E,C;if(this.role_has_events[this.role]&&this.update_calendar_first_day(),e=l(this.valid_nss()).map(function(e){return function(e){return e.events}}(this)).flatten(),t=this.earliest(),x=l(e).sortBy(function(e){return-e.timestamp}),r=l(x).filter(function(e){return function(n){return n.timestamp>=t&&n.timestamp<e.timestamp/1e3&&(null!==e.ns||!n.is_dup)}}(this)),this.role_has_events[this.role]){for(_("#event-table").empty(),o=0,u=r.length;u>o;o++)g=r[o],n=_(g.html),w=l(this.valid_roles()).filter(function(e){return function(e){return e.ns_ids.contains(g.ns_id)}}(this)).map(function(e){return function(e){return e.name}}(this)).join(" & "),this.deletions_only?n.find("span.role-path").text(w):n.find("span.role-label > span").text(w),_("#event-table").append(n),null!=g.preview_jsinfo&&(i=g.preview_jsinfo,k=n.find(".inline-button"),k.on("click",this._inline_share_button.bind(this,i)));_("#events-container").show(),_("#events-sub-header").show(),_("#events-sub-header").css("visibility","visible"),_("#events-empty-state").hide(),_(".empty-explanation").hide()}else this.request_in_flight||(_("#events-container").hide(),_("#events-sub-header").hide(),_("#events-empty-state").show(),_(".empty-explanation").show());for(this.request_in_flight?_("#more-loading").show():(this.awaitingFirstRender&&(this.awaitingFirstRender=!1,m.WebMiscActivityLogger.log("events-first-load",{time:Number(new Date)-this.now})),_("#more-loading").hide()),_("#more-loading").css("marginTop",this.earliest()===Number.MAX_VALUE?"140px":"20px"),d=_("#namespace-list > li"),a=0,c=d.length;c>a;a++)s=d[a],E=_(s).data("value"),v=At.call(l(this.valid_roles()).map(function(e){return e.ns_ids}).flatten(),E)>=0,f=E===!1,C=f||v,_(s).css("display",C?"":"none");return y=At.call(function(){var e,t,n,i;for(n=this.valid_roles(),i=[],e=0,t=n.length;t>e;e++)p=n[e],i.push(p.ns_ids.length>1);return i}.call(this),!0)>=0,this.request_in_flight||(y?(_("#namespace-list-container").css("visibility","visible"),_("#namespace-list-container").show()):_("#namespace-list-container").hide(),b=this.rss_data[null!=(h=this.ns)?h.ns_id:void 0]||this.rss_data[this.role],b&&this.role_has_events[this.role]?(_("#rss-feed a").attr("data-title",b.title),_("#rss_url").val(b.url),_("#rss_url").focus(),_("#rss-feed").show(),_("#rss-feed").css("visibility","visible")):_("#rss-feed").hide()),r.length||!this.request_in_flight?Re.mark_time_to_interactive(!0):void 0},show_rss_modal:function(){var e,t;return zt.show(pt("Subscribe to this RSS feed"),_("#rss-modal")[0]),t=_("#rss_url").val(),e=b.clipboard_overlay(t,_("#real_copy"),function(){return Je.success(pt("Link copied to clipboard!")),zt.hide()},_(".modal-buttons")),e.css({zIndex:1001})},_inline_share_button:function(e,t){return t.preventDefault(),dt(e.user_id,{fqPath:e.fq_path,isFolder:e.is_dir,nsId:e.ns_id,targetNsId:e.target_ns})}};var Kn;Kn=Qe.DateUtil={fromSecondsSinceEpochUTC:function(e){var t;return t=new Date(1970,0,1),t.setSeconds(e),t},applyTimezoneOffset:function(e,t){var n,i;return n=parseInt(t,10),i=60*(t-n),e.setHours(e.getHours()+n),e.setMinutes(e.getMinutes()+i)},contextualFormat:function(e){var t,n,i,r,o;return i=new Date(Date.now()),r=(i.getTime()-e.getTime())/1e3,t=0,28800>r?T.ago(e):(this.applyTimezoneOffset(i,Pe.TIMEZONE_OFFSET),this.applyTimezoneOffset(e,Pe.TIMEZONE_OFFSET),o=new Date(Date.now()),this.applyTimezoneOffset(o,Pe.TIMEZONE_OFFSET),o.setDate(o.getDate()-1),e.getYear()===i.getYear()&&e.getMonth()===i.getMonth()&&e.getDate()===i.getDate()?(n=pt("Today %(time)s"),n.format({time:Kn.format(e,Pe.time_format)})):e.getYear()===o.getYear()&&e.getMonth()===o.getMonth()&&e.getDate()===o.getDate()?(n=pt("Yesterday %(time)s"),n.format({time:Kn.format(e,Pe.time_format)})):Kn.format(e,Pe.datetime_format))},toUTCDate:function(e){return new Date(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.getUTCMilliseconds())},differenceStr:function(e,t){var n,i,r,o,s,a,l;return s=(e.getTime()-t.getTime())/1e3,60>s?mt("%d sec","%d secs",s).format(s):3600>s?(r=parseInt(s/60,10),mt("%d min","%d mins",r).format(r)):86400>s?(i=parseInt(s/3600,10),mt("%d hour","%d hours",i).format(i)):2592e3>s?(n=parseInt(s/86400,10),mt("%d day","%d days",n).format(n)):4838400>s?(a=parseInt(s/604800,10),mt("%d week","%d weeks",a).format(a)):31536e3>s?(o=parseInt(s/2592e3,10),mt("%d month","%d months",o).format(o)):(l=parseInt(s/31536e3,10),mt("%d year","%d years",l).format(l))},localize:function(e){return assert(null!=Pe.date_format,"Date format missing."),Kn.format(e,Pe.date_format)},format:function(e,t){var n;return assert("string"==typeof t,"Date format requires a format string"),n={yy:function(t){return function(){return e.getFullYear().toString().substring(2)}}(this),yyyy:function(t){return function(){return e.getFullYear().toString()}}(this),M:function(t){return function(){return(e.getMonth()+1).toString()}}(this),MM:function(t){return function(){return(e.getMonth()+1).toString().lpad(2)}}(this),d:function(t){return function(){return e.getDate().toString()}}(this),dd:function(t){return function(){return e.getDate().toString().lpad(2)}}(this),h:function(t){return function(){return(e.getHours()%12||12).toString()}}(this),H:function(t){return function(){return e.getHours().toString()}}(this),HH:function(t){return function(){return e.getHours().toString().lpad(2)}}(this),m:function(t){return function(){return e.getMinutes().toString()}}(this),mm:function(t){return function(){return e.getMinutes().toString().lpad(2)}}(this),a:function(t){return function(){return e.getHours()>11?pt("PM",{comment:"PM as in evening"}):pt("AM",{comment:"AM as in morning"})}}(this)},t.replace(/([a-zA-Z]+)/g,function(e){return null!=n[e]?n[e]():e})}};var Wn;Wn=INLINE_JS.Timezone=Qe.Timezone={check_timezone:function(){var e;if(Ae.get_viewer().is_signed_in)return e=Wn.get_current_timezone(),null==Pe.auto_timezone_offset||Pe.auto_timezone_offset!==e?Wn.update(e):void 0},get_current_timezone:function(){var e,t,n,i;return t=new Date,t.setSeconds(0),t.setMilliseconds(0),i=t.toGMTString(),e=new Date(i.substring(0,i.lastIndexOf(" "))),n=(t-e)/36e5},update:function(e){return assert("number"==typeof e,"Timezone offset was not a number: "+e),new Ajax.DBRequest("/set_timezone",{parameters:{offset:e},noAutonotify:!0})},update_timezones_dropdown:function(e,t){var n,i;return null==t&&(t=null),i=Wn.timezones_by_country[e],_("#timezone_id").empty(),_("#timezone_id").append(function(){var e,r,o;for(o=[],e=0,r=i.length;r>e;e++)n=i[e],o.push(_('<option value="'+n.id+'">'+n.name+"</option>").prop("selected",n.id===t));return o}())},auto:function(){var e;return e=$F("timezone_auto"),e?_("#tz").hide():(Wn.default_country&&(_("#timezone_country").val(Wn.default_country),Wn.update_timezones_dropdown(Wn.default_country)),_("#tz").show())},load_data:function(e,t){return Wn.timezones_by_country=e,Wn.default_country=t}};var Vn,Jn;Jn=Qe.CreateApp={init:function(e,t){var n,i,r;return this.accepted_tos_by_uid=e,this.form=n=_("#create-app-form"),this.email_verification=null,Ae.get_viewer().is_paired||(r=Ae.get_viewer().get_users()[0],this.select_user(r.id)),i=function(e){return function(e){var t;return t=e.target.name,n.find("input[name="+t+"]").each(function(){return _(this).parents("label").removeClass("active"),n.removeClass(_(this).data("next"))})}}(this),n.find("input[type=radio]").change(function(e){return i(e),_(e.target).parents("label").addClass("active"),n.addClass(_(this).data("next"))}),n.find("input[type=checkbox]").change(function(e){var t;_(this).filter("#accept-tos").length||(_(e.target).parents("label").toggleClass("active"),t=n.find("input[name="+_(this).attr("name")+"]:checked"),
n.toggleClass(_(this).data("next"),0!==t.length))}),n.find(".role-choice input").change(function(e){return function(t){var r,o;return r=n.find(".role-choice input:checked"),o=r.val(),Ae.get_viewer().is_uid_signed_in(o)?e.select_user(o):(r.prop("checked",!1),i(t),J.show_modal({user_id:o,on_success:function(){return r.prop("checked",!0).trigger("change")}}),!1)}}(this)),n.find("input:checked").trigger("change"),n.find("input[name=tos_accept]").change(function(e){return function(t){return e.update_submit_enabled()}}(this)),n.find("#send-verify-email, #resend-verify-email").click(function(e){return function(i){return e.email_verification.send_email(t,function(){return n.addClass("verify-email-sent"),e.email_verification.flash_email_sent_notification(),e.email_verification.ensure_polling(function(){return e.email_verification.user.is_email_verified?(n.addClass("email-verified"),n.removeClass("verifiy-email-sent"),n.removeClass("email-unverified"),e.update_submit_enabled()):void 0})}),!1}}(this)),n.submit(function(e){return n=_(e.target),jt.ajax_submit(n[0],!1,function(e){return window.location.href=e.responseText}),!1})},select_user:function(e){return this.email_verification=et.get_for_user(Ae.get_viewer().get_user_by_id(e)),this.form.find("#accept-tos-wrapper").toggle(!this.accepted_tos_by_uid[e]),this.form.find("input[name=tos_accept]").prop("checked",!1),this.form.removeClass("verify-email-sent"),this.form.find("#verify-email-wrapper").toggle(!this.email_verification.user.is_email_verified),this.form.toggleClass("email-verified",this.email_verification.user.is_email_verified),this.update_submit_enabled()},update_submit_enabled:function(){var e,t;return t=this.email_verification.user,e=this.accepted_tos_by_uid[t.id]||this.form.find("input[name=tos_accept]").prop("checked"),this.form.find("#create-button").prop("disabled",!e)}},Vn=INLINE_JS.Apps=Qe.Apps={init_apps:function(){return _("#show-disabled-apps").click(function(){return _(this).parent().hide(),_("#disabled-apps").show(),!1})},init_app_info:function(e,t,n){return this.user_email=n,_("#app-info .icon-container").each(function(e,t){var n;return n=_(t),n.append(Dropbox.createChooseButton({success:function(e){return n.find(".icon").attr("src",e[0].thumbnailLink),n.find("input[type=hidden]").val(e[0].link)},linkType:"direct",extensions:["images"]}))}),this._hoverable_tmpl=We.tmpl("hoverable_tmpl"),_(".modal-okay-triggers-refresh").on("click",function(e){location.reload()}),_("#unlink-users-button").on("click",function(t){Vn.unlink_all_users_in_dev(e)}),_("#enable-additional-users-button").on("click",function(t){Vn.enable_users_in_dev(e)}),_("#increase-max-users-button").on("click",function(t){Vn.enable_users_in_dev(e)}),_("#unlink-teams-button").on("click",function(t){Vn.unlink_all_teams_in_dev(e)}),_("#enable-additional-teams-button").on("click",function(t){Vn.enable_teams_in_dev(e)}),this._webhook_info_row_tmpl=We.tmpl("webhook_info_row_tmpl"),_("#domain-list").on("click",".img-container",function(t){Vn.remove_domain(t.currentTarget.parentNode,e)}),_("#oauth-uri-list").on("click",".img-container",function(t){Vn.remove_oauth_uri(t.currentTarget.parentNode,e)}),_("#webhook-list").on("click",".img-container",function(t){Vn.remove_webhook(t.currentTarget.parentNode,e)}),_("#webhook-list").on("click",".webhook-actions.enabled .webhook_disable",function(t){Vn.update_webhook_url(t.currentTarget,e,!1)}),_("#webhook-list").on("click",".webhook-actions.disabled .webhook_enable",function(t){Vn.update_webhook_url(t.currentTarget,e,!0)}),_("#delete-app-button").on("click",function(n){Vn.confirm_disable(t,e,0)}),_("#webhook_url").on("click change paste focus",function(e){_("#webhook-form").removeClass("error")}),this.init_app_info_add_redirect_uri(),_("#oauth2-allow-implicit-grant").on("change",function(t){return Vn.set_oauth2_allow_implicit_grant(t.currentTarget,e)})},init_app_info_add_redirect_uri:function(){var e,t,n,i;t=/^\#?add_redirect_uri=(.*)$/.exec(window.location.hash||""),t&&(i=window.decodeURIComponent(t[1]),e=_("#oauth-add-uri-form"),_("input[name=oauth_uri]",e).val(i),n=_("#add-redirect-uri-modal")[0],_("#add-redirect-uri-modal-uri").text(i),zt.show(pt("Add OAuth redirect URI"),n,{doit:function(){var e;return window.history&&window.history.replaceState?(e=window.location.href,e=e.substring(0,e.indexOf("#")),window.history.replaceState({},document.title,e)):window.location.hash="",zt.hide(),Vn.submit_new_oauth_uri(_("#oauth-add-uri-form")[0])}}))},init_app_datastores_browse:function(e){return this.ds_info=e,Ae.get_viewer().is_paired?(this.role_picker=Ye.get_controller(_("#role-selector")),this.role_picker.on_state_change=this.app_datastores_browse_render.bind(this),J.set_during_login_callback(function(e){return function(t,n){return e.app_datastores_browse_reload_info(function(){return n()},function(){return n("Error displaying datastores"),window.location.reload()})}}(this))):void 0},app_datastores_browse_reload_info:function(e,t){return _.ajax({url:"/developers/apps/datastores/info",success:function(t){return function(n){return t.ds_info=n,t.app_datastores_browse_render(),"function"==typeof e?e():void 0}}(this),error:function(e){return function(e){return"function"==typeof t?t(e):void 0}}(this)}),!1},app_datastores_browse_render:function(){return this.app_datastores_browse_render_id("#apps_developed_container"),this.app_datastores_browse_render_id("#apps_used_container"),this.app_datastores_browse_render_empty()},app_datastores_browse_render_empty:function(){var e,t,n,i;if(t=_("#no_apps_container").empty(),0===_("#apps_developed_container").children().length&&0===_("#apps_used_container").children().length)switch(e=_("<div class='empty-state'></div>").appendTo(t),null!=(n=this.role_picker)?n.get_state():void 0){case at.PERSONAL:case at.WORK:return i=Ae.get_viewer().get_user_by_role(this.role_picker.get_state()),e.append("You don't have any datastores in your "+Ae.get_role_title(i)+" Dropbox.");default:return e.append("You don't have any datastores in your Dropbox.")}},app_datastores_browse_render_id:function(e){var t,n,i,r,o,s,a;for(r=this.app_datastores_browse_get_id_info(e),n=_(e),n.empty(),t="",o=0,s=r.length;s>o;o++)i=r[o],this.app_datastores_should_render(i.uid)&&(t+=i.html);return t?(n.append(this.app_datastores_browse_get_id_header(e)),a=_("<div class='app-list clearfix'/>").appendTo(n),a.html(t)):void 0},app_datastores_should_render:function(e){var t;return null!=this.role_picker?(t=Ae.get_viewer().get_user_by_id(e),this.role_picker.is_role_visible(t.role)):!0},app_datastores_browse_get_id_info:function(e){switch(e){case"#apps_developed_container":return this.ds_info.apps_developed;case"#apps_used_container":return this.ds_info.apps_used;default:return assert(!1,"invalid ds group id")}},app_datastores_browse_get_id_header:function(e){switch(e){case"#apps_developed_container":return _("<h2>Apps you develop</h2>");case"#apps_used_container":return _("<h2>Apps you use</h2>");default:return assert(!1,"invalid ds group id")}},confirm_disable:function(e,t,n){var i,r;return i=pt(n?"Are you sure you want to disable '%(app_name)s'?":"Are you sure you want to delete '%(app_name)s'?"),wt.fillVal(i.format({app_name:e.escapeHTML()}),"app-disable-text"),zt.show(pt(n?"Confirm disable":"Confirm delete"),$("app-disable-modal")),r="/developers/disable_app/"+t,$("app-disable-modal").down("form").action=r,$("disable-app-button").setValue(pt(n?"Disable":"Delete"))},enable_app:function(e){var t;return t="/developers/enable_app/"+e,_("#status-button-form").attr("action",t).submit()},show_uninstall:function(e,t,n,i,r,o){var s;if(e&&Event.stop(e),zt.vars={app_id:n,user_id:o},s=_("#delete-"+i+"-app-confirm"),"sandbox"===i){if(!r)return void Vn.do_uninstall();_(".app_folder",s).text(r)}return _(".app_name",s).text(t),zt.show(pt("Remove %(app_name)s?").format({app_name:I.em_snippet(t,22)}),s[0],zt.vars),null},do_uninstall:function(){var e;return e=zt.vars.user_id,new Ajax.DBRequest("/api/uninstall_app",{parameters:{app_id:zt.vars.app_id,keep_sandbox_files:$F("keep_sandbox_files")},onSuccess:function(t){var n;return Je.success(t.responseText),n=_(".apps-"+e),_("#inst-app-"+zt.vars.app_id+"-row",n).hide().removeClass("active_app"),0===_(".active_app",n).length&&n.hide(),0===_(".active_app").length?(_("#empty-explanation").text(pt("You have no apps linked to your Dropbox.")),_("#applications-explanation",n).remove()):void 0},subject_user:e}),zt.hide()},enable_users_in_dev:function(e,t){return new Ajax.DBRequest("/developers/enable_users_in_dev/"+e,{onSuccess:function(e){var t;return"ok"===e.responseText?zt.show(pt("User limit increased"),$("increased-dev-user-limit-modal")):(t=JSON.parse(e.responseText),zt.show(pt("Limit raised to %(user_limit)s users").format({user_limit:t.new_limit}),$("increased-dev-user-limit-modal")))}}),!1},unlink_all_users_in_dev:function(e){return zt.show(pt("Unlink all users"),$("confirm-unlink-all-users"),{doit:function(){return new Ajax.DBRequest("/developers/unlink_all_users/"+e,{onSuccess:function(e){return zt.hide(),location.reload()}})}}),!1},enable_teams_in_dev:function(e){return h.WebRequest({url:"/developers/enable_teams_in_dev/"+e,success:function(e){var t;return t=JSON.parse(e),zt.show(pt("Limit raised to %(team_limit)s teams").format({team_limit:t.new_limit}),$("increased-dev-team-limit-modal"))}}),!1},unlink_all_teams_in_dev:function(e){return zt.show(pt("Unlink all teams"),$("confirm-unlink-all-teams"),{doit:function(){return h.WebRequest({url:"/developers/unlink_all_teams/"+e,success:function(e){return zt.hide(),location.reload()}})}}),!1},submit_app_info:function(e){var t;return t=_(e).find("input[name=name]").val(),jt.clear_errors(e),jt.ajax_submit(e,!1,function(){return Je.success("App info updated."),t&&_("#app-info h1").text(t),location.reload()})},submit_folder_name:function(e){var t;return t=_(e).find("input[name=folder]").val(),jt.clear_errors(e),jt.ajax_submit(e,!1,function(){return Je.success("App folder name updated."),_("#folder-name .text").text(t),Vn.hide_folder_input()})},submit_new_webhook:function(e){var t,n,i,r,o,s,a,l,u,c,d,m;return n=_(e),o=_("#webhook-list"),r=_("<img>").attr({src:"/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif",alt:pt("Loading")}).css("vertical-align","middle"),i=n.find("input[name=webhook_url]"),d=function(e,t){return t&&t.remove(),0===o.find(".hoverable-url").length&&o.addClass("hide-status"),_("#webhook-form-error").text(e),_("#webhook-form").addClass("error")},a=i.val(),""===a?void d("Empty URI"):(l=Ge.parse(a),"http"!==(u=l.scheme)&&"https"!==u?void d("URI scheme must be http or https"):l.authority?"localhost"===(c=l.authority)||"127.0.0.1"===c||0===l.authority.indexOf("[::1]")?void d("Webhooks doesn't support localhost as Dropbox can't contact your local server. Please use an internet accessible URI."):o.find("tbody").length>=Oe.MAX_WEBHOOKS_PER_APP?void d("You can register a maximum of %d webhook URIs per app.".format(Oe.MAX_WEBHOOKS_PER_APP)):(t=_(this._webhook_info_row_tmpl({url:a,status:"Verifying"}).toHTML()),t.find(".status").append(r),t.find(".webhook-actions").removeClass("disabled").addClass("enabled"),o.append(t),o.removeClass("hide-status"),_("#webhook-form").removeClass("error"),s=jt.collect_form_vars(e),i.val(""),m=(new Date).getTime(),h.WebRequest({url:"/developers/apps/update/add_webhook",dataType:"json",data:s,success:function(e){var n,r;return"invalid"===e.status?(d(e.failure_text,t),i.val(a)):(r=(new Date).getTime()-m,n=Math.max(0,1e3-r),setTimeout(function(){return"ok"===e.status?t.find(".status").text("Enabled"):"error"===e.status?(t.find("textarea").text(e.failure_text),t.find(".status").text(e.status_text).addClass("error"),t.find(".timestamp").text("Just now"),t.find(".webhook-failure-info").css("display","")):void 0},n))},error:function(){return t.remove(),i.val(a)}})):void d("Improperly formatted URI (typo maybe?)"))},remove_webhook:function(e,t){var n,i;return _("#webhook-form").removeClass("error"),i=_(e).find(".value").text(),n=_("<img>").attr({src:"/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif",alt:pt("Loading")}).css("vertical-align","middle"),_(e).find(".status").text("Removing").removeClass("error").append(n),h.WebRequest({url:"/developers/apps/update/remove_webhook",data:{app_id:t,webhook_url:i},dataType:"json",success:function(t){var n,r;return n=e.parentNode,r=n.parentNode,r.removeChild(n),0===r.getElementsByClassName("hoverable-url").length&&_(r).addClass("hide-status"),_("#webhook_url").val()?void 0:_("#webhook_url").val(i)},error:function(){return Je.error("Unable to complete your request.")}})},update_webhook_url:function(e,t,n){var i,r,o,s,a;return a=_(e.parentNode.parentNode).find(".value").text(),_("#webhook-form").removeClass("error"),o=e.parentNode.parentNode.parentNode,i=_("<img>").attr({src:"/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif",alt:pt("Loading")}).css("vertical-align","middle"),r=_(o).find(".status").text(),n="Disabled"===r,s=n?"Enabling":"Disabling",_(o).find(".status").text(s).removeClass("error").append(i),h.WebRequest({url:"/developers/apps/update/update_webhook_url",data:{app_id:t,webhook_url:a,enable:n},dataType:"json",success:function(e){var t;return r=_(o).find(".status").text(),t="Disabling"===r?"Disabled":"Enabled",_(o).find(".status").text(t).removeClass("error").removeClass("img"),"Disabling"===r?_(o).find(".webhook-actions").removeClass("enabled").addClass("disabled"):_(o).find(".webhook-actions").removeClass("disabled").addClass("enabled")},error:function(e){return Je.error("Unable to complete your request.")}})},set_oauth2_allow_implicit_grant:function(e,t){return h.WebRequest({url:"/developers/apps/update/oauth2_allow_implicit_grant",data:{app_id:t,allow:_(e).val()},dataType:"json",success:function(e){return Je.success("OAuth 2 allow implicit grant updated.")},error:function(){return Je.error("Error updating OAuth 2 allow implicit grant.")}})},submit_new_oauth_uri:function(e){var t;return t=_(e).find("input[name=oauth_uri]").val(),jt.clear_errors(e),jt.ajax_submit(e,!1,function(){return Je.success("OAuth URI added."),Vn.add_oauth_uri(t),_(e).find("input[name=oauth_uri]").val("")})},add_oauth_uri:function(e){var t;return t=_("#oauth-uri-list"),t.append(this._hoverable_tmpl({value:e}).toHTML()),t.show()},remove_oauth_uri:function(e,t){var n,i;return i=_(e).find(".value").text(),n=function(t){var n;return Je.success("OAuth URI removed."),n=e.parentNode,n.removeChild(e),0===n.getElementsByTagName("div").length?n.hide():void 0},h.WebRequest({url:"/developers/apps/update/remove_oauth_uri",data:{app_id:t,oauth_uri:i},dataType:"json",success:n,error:function(){return Je.error("Unable to complete your request.")}})},submit_new_domain:function(e){var t;return t=_(e).find("input[name=domain_name]").val(),jt.clear_errors(e),jt.ajax_submit(e,!1,function(){return Je.success("Domain added."),Vn.add_domain(t),_(e).find("input[name=domain_name]").val("")})},add_domain:function(e){var t;return t=_("#domain-list"),t.append(this._hoverable_tmpl({value:e}).toHTML()),t.show()},remove_domain:function(e,t){var n,i;return i=_(e).find(".value").text(),n=function(t){var n;return Je.success("Domain removed."),n=e.parentNode,n.removeChild(e),0===n.getElementsByTagName("div").length?n.hide():void 0},h.WebRequest({url:"/developers/apps/update/remove_domain",data:{app_id:t,domain_name:i},dataType:"json",success:n,error:function(){return Je.error("Unable to complete your request.")}})},show_need_users_modal:function(e){return zt.show(pt("Please test this app",{comment:"Error message"}),$("app-need-users-modal")),!1},show_need_teams_modal:function(e){return zt.show(pt("Please test this app",{comment:"Error message"}),$("app-need-teams-modal"))},show_name_branding_modal:function(e){return zt.show(pt("Please rename this app",{comment:"Error message"}),$("app-name-branding-modal")),!1},show_need_icon_modal:function(e){return zt.show(pt("Please add an icon for this app",{comment:"Error message"}),$("app-need-icon-modal")),!1},show_need_enable_users_modal:function(e){return zt.show(pt("Please enable more users for this app",{comment:"Error message"}),$("app-need-enable-users-modal")),!1},show_submit_prod_status_modal:function(e){return zt.show(pt("Confirm your application submission",{comment:"Error message"}),$("submit-prod-status-modal")),!1},check_for_nongenerated_oauth_tokens:function(e){var t;return t="/developers/prod_request/"+e,new Ajax.DBRequest("/developers/has_nongenerated_oauth_tokens/"+e,{onSuccess:function(e){return"true"===e.responseText?Be.redirect(t):zt.show(pt("Please auth at least one user with the OAuth flow",{comment:"Error message"}),$("app-need-nongenerated-token"))},onFailure:function(e){return Be.redirect(t)}}),!1},hide_folder_input:function(){return _("#folder-name").show(),_("#folder-input").hide()},show_folder_input:function(){return _("#folder-name").hide(),_("#folder-input").show(),_("#folder-input input[name=folder]").focus()}};var Gn,Xn;Xn=INLINE_JS.twitter_auth_complete=function(e){return assert(null!=e,"user_id must be provided"),Gn.onLoginSuccessCallback?Gn.onLoginSuccessCallback(e):window.location.reload(),!1},Gn=Qe.Twitter={is_authed:function(e){return e=parseInt(e),null==Gn._authed_users&&(Gn._authed_users={}),Gn._authed_users[e]},set_is_authed:function(e,t){return e=parseInt(e),null==Gn._authed_users&&(Gn._authed_users={}),Gn._authed_users[e]=t},get_progress_container:function(){var e;return assert(Gn.progress_container,"Twitter is missing progress_container"),e=$(Gn.progress_container),assert(e,"Missing progress_container elm"),e},follow_dropbox:function(e,t){var n;return assert(null!=t,"user_id must be provided"),e.showWorking&&e.showWorking(),n=function(){return e.onFailure?e.onFailure():window.location.reload()},new Ajax.DBRequest("/twitter/follow_us",{onSuccess:function(t){return t.responseText.startsWith("ok")?e.onSuccess?e.onSuccess():void 0:n()},onFailure:function(){return n()},subject_user:t})},do_auth:function(e,t){var n,i;return assert(null!=t,"user_id must be provided"),i=Ge({path:"/twitter/request_token"}).updateQuery(Pe.UID_PARAM_NAME,t).toString(),window.open(i,"twitter_auth","width=800,height=400"),n=function(t){return Gn.set_is_authed(t,!0),"function"==typeof e?e(t):void 0},Gn.onLoginSuccessCallback=n},show_auth:function(e){return e&&(Gn.onLoginSuccessCallback=e),wt.updateFromElm(Gn.get_progress_container(),"inline-twitter-auth")},show_posting:function(){return Gn.should_hide_modal()&&zt.hide(),Gn.get_progress_container().update(wt.fromElm("sharing-progress"))},show_complete:function(e){var t;return t=Gn.get_progress_container(),t.update(wt.fromElm("sharing-posted")),Gn.show_complete_into(e,t)},show_complete_into:function(e,t){var n,i,r,o,s;return n="twitter",o=pt("View tweet"),s=void 0,s=e.startsWith("ok")?"http://www.twitter.com/":e,i=t.down("#view-post"),i.href=s,i.update(o),r=ye.make("web",n),i.__sert({top:r})},post:function(e,t,n,i){var r,o;return assert(null!=i,"user_id must be provided"),assert(e,"Twitter message is empty"),r={message:e,from_referrals:Gn.from_referrals,from_getspace:Gn.from_getspace},new Ajax.DBRequest("/twitter_post",{parameters:r,onSuccess:function(t){var n,r;return"login"===t.responseText?(Gn.onLoginSuccessCallback=function(){return Gn.post(e,null,null,i)},(n=Gn.custom_show_auth||Gn.show_auth)()):(Gn.should_hide_modal()&&zt.hide(),(r=Gn.onPostSuccessCallback||Gn.show_complete)(t.responseText))},subject_user:i}),(o=Gn.custom_show_posting||Gn.show_posting)()},custom_post:function(e,t,n){return assert(null!=n,"user_id must be provided"),t&&(Gn.onPostSuccessCallback=t),e?(assert(e,"Twitter message doesn't exist"),Ae.get_viewer().is_signed_in?Gn.post(e,null,null,n):window.open("http://www.twitter.com/home?status="+encodeURI(e))):void 0},get_user_info:function(e,t){return assert(null!=t,"user_id must be provided"),new Ajax.DBRequest("/twitter/user_info",{noAutonotify:1,parameters:{},onSuccess:function(t){return e(JSON.parse(t.responseText))},subject_user:t})},should_hide_modal:function(){return"undefined"==typeof Gn.hide_modal?!0:Gn.hide_modal}};var Zn;Zn=Qe.ShmodelLogger={CLICK_SIGN_IN:"click_sign_in",CLICK_ADD_TO_MY_DROPBOX:"click_add_to_my_dropbox",REMOVE_LINK:"remove_link",CLICK_FILENAME:"click_filename",CLICK_DOWNLOAD:"click_download",LOGIN_THRU_DEFAULT_DROPDOWN:"login_thru_default_dropdown",CLICK_SIGNUP_THRU_DEFAULT_DROPDOWN:"click_signup_thru_default_dropdown",CLICK_SHARE:"click_share",log:function(e){return new Ajax.DBRequest("/shmlog",{method:"post",noAutonotify:!0,parameters:{evt:e,url:window.location.href}})},attachLogListener:function(e,t){return null!=t?t.observe("click",function(n){return Zn.log(e),t.href&&"#"!==t.href&&"_blank"!==t.target?(Event.stop(n),function(){return window.location.href=t.href}.defer()):void 0}):void 0}};var Qn;Qn=Qe.ModalFlow=function(){function e(e,t,n,i,r,o,s){var a,l,_,u;for(this.title=e,this.icon=t,this.states=n,this.next_state_table=i,this.previous_state_table=r,this.initial=o,this.onStart=s,this._state_map={},_=this.states,a=0,l=_.length;l>a;a++)u=_[a],this._state_map[u.name]=u;this.state=null,this._exit_listeners=[],this._cleanup_queue=[]}return e.prototype.start=function(){var e,t,n,i;for(this.vars={},n=this.states,e=0,t=n.length;t>e;e++)i=n[e],i.next=this._next.bind(this,i),i.back=this._back.bind(this,i),i.onSubmit?i.onSubmitFn=function(e,t){return e.onSubmit(this,e,t),!1}.bind(this,i):i.onSubmitFn=function(e){return function(e,t){return e.next(),!1}}(this).bind(this,i),i.contents.on("submit",i.onSubmitFn),i.contents.find(".backbutton").on("click",i.back);return zt.onHide=this._onExit.bind(this),this.onStart&&this.onStart(),this.to_state(this.initial),!1},e.prototype.to_state=function(e){var t;return this.state=this._state_map[e],t=this.title,null!=this.state.title&&(t=this.state.title),zt.show(t,this.state.contents[0]),this.state.enter(this)},e.prototype._next=function(e){var t;return e===this.state?(t=this.next_state_table[this.state.name](this),"__exit__"===t?this.exit():this.to_state(t)):void 0},e.prototype._back=function(e){var t;if(e===this.state){if(t=this.previous_state_table[this.state.name](this),"__cancel__"===t)return this.exit();if(t)return this.to_state(t)}},e.prototype.exit=function(){return this._onExit()},e.prototype._onExit=function(e){var t,n,i,r,o,s,a,l;for(s=this.states,t=0,i=s.length;i>t;t++)l=s[t],l.contents.off("submit",l.onSubmitFn);for(this._cleanUpExitListeners(),a=this._exit_listeners,n=0,r=a.length;r>n;n++)(o=a[n])(e);return zt.onHide=null,zt.hide()},e.prototype.addExitListener=function(e){return this._exit_listeners.push(e)},e.prototype.removeExitListener=function(e){return this._cleanup_queue.push(e)},e.prototype._cleanUpExitListeners=function(){var e,t,n,i,r,o;for(r=this._cleanup_queue,o=[],t=0,i=r.length;i>t;t++)e=r[t],n=this._exit_listeners.indexOf(e),o.push(this._exit_listeners.splice(n,1));return o},e}();var ei;ei=Qe.TwoFactorAuth={_checkpoint_token:null,_email:null,_container_selector:null,_error_selector:null,_is_offline_setup:null,_invalid_code_count:null,_current_flow:null,set_user:function(e){return this._user=Ae.get_viewer().get_user_by_id(e),assert(this._user,e+" is invalid"),_("#twofactor-enter-password .email-placeholder").text(this._user.email),_("#twofactor-enter-password .password-link").attr("href","/forgot?email="+encodeURIComponent(this._user.email))},login_init:function(){return this._container_selector="#twofactor-confirm",this._error_selector="#twofactor-confirm .error-message",this.login_listen()},login_listen:function(){return _("#resend-link").on("click",this.resend_phone_code.bind(this)),_("#code").focus()},init:function(){return this._container_selector=".twofactor-account-form",this._error_selector=".twofactor-account-form .error-message",this.account_listen(),Xe(["external/phone_helpers","external/u2f-api"])},account_listen:function(){var e,t,n,i,r,o,s,a,l,u,c,d,h,m,p,f;return n={name:"delivery_choice",enter:function(e){return function(t){var n;return e.hide_error(),n=0,_(".delivery-choice").each(function(){var e;return e=_(this).height(),n=Math.max(e,n)}),_(".delivery-choice").height(n),_(".delivery-choice.selected > input").prop("checked",!0)}}(this),contents:_("#twofactor-delivery-choice"),onSubmit:function(e){return function(t,n,i){return t.vars.sms=_("#sms-choice").hasClass("selected"),t.vars.sms?n.next():e.fetch_offline_key(t,n)}}(this)},i={name:"enter_phone_number",enter:function(e){return function(t){var n,i;return e.hide_error(),e._is_offline_setup=!1,e._phone_number=null,n=$("twofactor-enter-phone"),i=e.fill_phone_number_for_edit(n,_("#twofactor-row-"+e._user.role+" #twofactor-sms-number").text()),i.focus()}}(this),contents:_("#twofactor-enter-phone"),onSubmit:this.submit_phone_number.bind(this)},r={name:"offline_setup",enter:function(e){return function(t){return e.hide_error(),e._is_offline_setup=!0,e._phone_number=null}}(this),contents:_("#twofactor-offline-setup")},t={name:"confirm_phone",enter:function(e){return function(t){var n;return e._invalid_code_count=0,e._is_offline_setup?$("twofactor-enable-confirm").addClassName("offline"):(n=t.vars.phone_number,assert(n,"expected a display_phone argument"),$("phone-number-placeholder").__date(n),$("twofactor-enable-confirm").removeClassName("offline")),e.hide_error(),$("phone-code").clear().focus(),e.fill_delivery_choice(n)}}(this),onSubmit:this.submit_phone_code.bind(this),contents:_("#twofactor-enable-confirm")},e={name:"backup_phone",enter:this.enter_backup_phone_number_shown.bind(this,"back_next"),onSubmit:this.submit_backup_phone_number.bind(this,!1,"save_none"),contents:_("#twofactor-enter-backup-phone")},d=new Qn(this.DEFAULT_ENABLE_TITLE,this.LOCK_ICON,[{name:"enable_start",enter:this.hide_error.bind(this),contents:_("#twofactor-start")},{name:"password",enter:this.enter_password_shown.bind(this),onSubmit:this.submit_password.bind(this,this.ENABLE_CONFIRM_HREF,function(e){return function(t,n){return e.successfully_enabled=!1,t.vars.mode="ENABLE",t.vars.passed_password=!0,n.next()}}(this)),contents:_("#twofactor-enter-password")},n,i,r,t,e,{name:"recovery_code",enter:function(e){return function(){return e.fill_backup_phone(e._backup_phone),e.hide_error.bind(e)}}(this),onSubmit:this.submit_finish.bind(this,!1),contents:_("#twofactor-recovery")},{name:"congrats_done",enter:this.after_enabled.bind(this),title:pt("Congrats! You've enabled two-step verification!"),contents:_("#twofactor-done")}],{enable_start:function(){return"password"},password:function(){return"delivery_choice"},delivery_choice:function(e){return e.vars.sms?"enter_phone_number":"offline_setup"},enter_phone_number:function(){return"confirm_phone"},confirm_phone:function(){return"backup_phone"},backup_phone:function(){return"recovery_code"},recovery_code:function(){return"congrats_done"},congrats_done:function(){return"__exit__"},offline_setup:function(){return"confirm_phone"}},{enable_start:function(){return null},password:function(){return null},delivery_choice:function(){return null},enter_phone_number:function(){return"delivery_choice"},offline_setup:function(){return"delivery_choice"},confirm_phone:function(e){return e.vars.sms?"enter_phone_number":"offline_setup"},backup_phone:function(){return"delivery_choice"},recovery_code:function(){return"backup_phone"},congrats_done:function(){return null}},"enable_start",function(){return this.vars.passed_password=!1}),d.addExitListener(function(e){return function(t){return d.vars.passed_password&&t&&!e.successfully_enabled?Je.error(pt("Two-step verification isn’t enabled")):void 0}}(this)),c=new Qn(this.DEFAULT_EDIT_TITLE,this.LOCK_ICON,[{name:"password",enter:this.enter_password_shown.bind(this),onSubmit:this.submit_password.bind(this,this.EDIT_CONFIRM_HREF,function(e){return function(t,n){var i;return e.successfully_enabled=!1,_(".delivery-choice").removeClass("selected"),i=!_("#twofactor-row").hasClass("with-sms"),_(i?"#app-choice":"#sms-choice").addClass("selected"),_("#twofactor-recovery").addClass("edit-mode"),t.vars.passed_password=!0,n.next()}}(this)),contents:_("#twofactor-enter-password")},n,i,r,t,{name:"backup_phone",enter:this.enter_backup_phone_number_shown.bind(this,"back_next"),onSubmit:this.submit_backup_phone_number.bind(this,!1,"save_everything"),contents:_("#twofactor-enter-backup-phone")}],{password:function(){return"delivery_choice"},delivery_choice:function(e){return e.vars.sms?"enter_phone_number":"offline_setup"},enter_phone_number:function(){return"confirm_phone"},confirm_phone:function(){return"backup_phone"},backup_phone:function(){return"__exit__"},offline_setup:function(){return"confirm_phone"}},{password:function(){return null},delivery_choice:function(){return null},enter_phone_number:function(){return"delivery_choice"},offline_setup:function(){return"delivery_choice"},confirm_phone:function(e){return e.vars.sms?"enter_phone_number":"offline_setup"},backup_phone:function(){return"delivery_choice"}},"password",function(){return this.vars.passed_password=!1}),c.addExitListener(function(e){return function(t){return c.vars.passed_password&&t&&!e.successfully_enabled?Je.error(pt("Two-step verification has not been changed")):void 0}}(this)),l=new Qn(this.DEFAULT_DISABLE_TITLE,this.LOCK_ICON,[{name:"password",enter:this.enter_password_shown.bind(this),onSubmit:this.submit_password.bind(this,this.DISABLE_CONFIRM_HREF,function(e){return function(t,n){return e.successfully_disabled=!1,t.vars.passed_password=!0,n.next()}}(this)),contents:_("#twofactor-enter-password")},{name:"disable",enter:this.hide_error.bind(this),contents:_("#twofactor-disable"),onSubmit:this.disable_submit.bind(this)}],{password:function(){return"disable"},disable:function(){return"__exit__"}},{password:function(){return null},disable:function(){return"__cancel__"}},"password",function(){return this.vars.passed_password=!1}),l.addExitListener(function(e){return function(t){return l.vars.passed_password&&t&&!e.successfully_disabled?Je.error(pt("Two-step verification is still enabled")):void 0}}(this)),o=new Qn(this.ADD_BACKUP_TITLE,this.LOCK_ICON,[{name:"password",enter:this.enter_password_shown.bind(this),onSubmit:this.submit_password.bind(this,this.EDIT_CONFIRM_HREF,function(e,t){return t.next()}),contents:_("#twofactor-enter-password")},{name:"backup_phone",enter:this.enter_backup_phone_number_shown.bind(this,"cancel_save"),onSubmit:this.submit_backup_phone_number.bind(this,!0,"save_backup_phone"),contents:_("#twofactor-enter-backup-phone")}],{password:function(){return"backup_phone"},backup_phone:function(){return"__exit__"}},{password:function(){return null},backup_phone:function(){return"__cancel__"}},"password"),u=new Qn(this.EDIT_BACKUP_TITLE,this.LOCK_ICON,[{name:"password",enter:this.enter_password_shown.bind(this),onSubmit:this.submit_password.bind(this,this.EDIT_CONFIRM_HREF,function(e,t){return t.next()}),contents:_("#twofactor-enter-password")},{name:"backup_phone",enter:this.enter_backup_phone_number_shown.bind(this,"cancel_save"),onSubmit:this.submit_backup_phone_number.bind(this,!1,"save_backup_phone"),contents:_("#twofactor-enter-backup-phone")}],{password:function(){return"backup_phone"},backup_phone:function(){return"__exit__"}},{password:function(){return null},backup_phone:function(){return"__cancel__"}},"password"),m=new Qn(this.EDIT_RECOVERY_TITLE,this.LOCK_ICON,[{name:"password",enter:this.enter_password_shown.bind(this),onSubmit:this.submit_password.bind(this,this.EDIT_CONFIRM_HREF,function(e){return function(t,n){return new Ajax.DBRequest(e.RECOVERY_CODE_HREF,{parameters:{checkpoint_token:e._checkpoint_token,use_json:!0},onSuccess:function(t){var i,r;if(r=JSON.parse(t.responseText.trim()),"OK"===r.result)return i=r.codes,e.fill_backup_codes(i,"backup-code-list-edit-container"),n.next();switch(r.result){case"EXPIRED":return e.show_error_expired();case"ALREADY_DISABLED":return _("#twofactor-row").removeClass("twofactor-enabled"),Je.success(pt("Two-step verification is already disabled. Did you maybe disable it in another window?")),zt.hide()}},onFailure:e.show_error500.bind(e),
cleanUp:e.hide_loading.bind(e),subject_user:e._user})}}(this)),contents:_("#twofactor-enter-password")},{name:"recovery_code",enter:this.hide_error.bind(this),contents:_("#twofactor-recovery-edit"),onSubmit:function(e){return function(t,n){return e._checkpoint_token=null,n.next()}}(this)}],{password:function(){return"recovery_code"},recovery_code:function(){return"__exit__"}},{password:function(){return null},recovery_code:function(){return null}},"password"),f=function(e){return function(t){return new Ajax.DBRequest(e.ADD_SECURITY_KEY_FINISH_HREF,{parameters:{checkpoint_token:e._checkpoint_token,device_response:JSON.stringify(t)},noAutonotify:!0,onSuccess:function(t){var n;return n=t.responseText.trim(),s.to_state("register_success"),_(document).trigger("security-key-manager:UPDATE_KEYS",e._user.id)},onFailure:function(e){var t,n;return t=JSON.parse(e.responseText.substr(4)),n=null!=t.security_key_register?t.security_key_register.message_text:Je.DEFAULT_ERROR,_("#twofactor-security-key-register-error #error-msg").text(n),s.to_state("register_error")},cleanUp:e.hide_loading.bind(e),subject_user:e._user})}}(this),h=function(e){return function(t,n){return new Ajax.DBRequest(e.ADD_SECURITY_KEY_START_HREF,{parameters:{checkpoint_token:e._checkpoint_token},onSuccess:function(e){var t;return t=JSON.parse(e.responseText),u2f.register(t.registerRequests,t.authenticateRequests,f),n.next()},onFailure:e.show_error500.bind(e),cleanUp:e.hide_loading.bind(e),subject_user:e._user})}}(this),p=new Qn(this.ADD_SECURITY_KEY_TITLE,this.LOCK_ICON,[{name:"unsupported_browser",enter:this.hide_error.bind(this),contents:_("#twofactor-security-key-unsupported-browser")}],{unsupported_browser:function(){return"__exit__"}},{},"unsupported_browser"),a=new Qn("Confirm password",this.LOCK_ICON,[{name:"password",enter:this.enter_password_shown.bind(this),onSubmit:this.submit_password.bind(this,this.EDIT_CONFIRM_HREF,function(e){return function(t,n){return _(document).trigger("security-key-modal:PASSWORD_CONFIRMED",[e._user.id,e._checkpoint_token]),zt.hide()}}(this)),contents:_("#twofactor-enter-password")}],{password:function(){return"__exit__"}},{},"password"),s=new Qn(this.ADD_SECURITY_KEY_TITLE,this.LOCK_ICON,[{name:"password",enter:this.enter_password_shown.bind(this),onSubmit:this.submit_password.bind(this,this.EDIT_CONFIRM_HREF,function(e,t){return t.next()}),contents:_("#twofactor-enter-password")},{name:"intro",enter:this.hide_error.bind(this),contents:_("#twofactor-security-key-intro")},{name:"prepare_register",enter:this.hide_error.bind(this),contents:_("#twofactor-security-key-prepare-register"),onSubmit:h},{name:"register",enter:this.hide_error.bind(this),contents:_("#twofactor-security-key-register")},{name:"register_error",enter:this.hide_error.bind(this),contents:_("#twofactor-security-key-register-error"),onSubmit:h},{name:"register_success",enter:function(e){return function(){return e.hide_error.bind(e),e._checkpoint_token=null}}(this),onSubmit:function(e,t){return Je.success(pt("Successfully added security key.")),t.next()},contents:_("#twofactor-security-key-register-success")}],{password:function(){return"intro"},intro:function(){return"prepare_register"},prepare_register:function(){return"register"},register:function(){return"register_success"},register_error:function(){return"register"},register_success:function(){return"__exit__"}},{},"password"),this._bind_phone_input_to_save_button(),this._register_skip_link_click_to_submit_finish(),_(".enable-twofactor").on("click",function(e){return function(t){return e.start_flow(t,d)}}(this)),_(".disable-twofactor").on("click",function(e){return function(t){return e.start_flow(t,l)}}(this)),_(".add-twofactor-backup-link").on("click",function(e){return function(t){return e.start_flow(t,o)}}(this)),_(".edit-twofactor-backup").on("click",function(e){return function(t){return e.start_flow(t,u)}}(this)),_(".edit-twofactor-recovery").on("click",function(e){return function(t){return e.start_flow(t,m)}}(this)),_(".edit-twofactor-sms, .edit-twofactor-offline").on("click",function(e){return function(t){return e.start_flow(t,c)}}(this)),_(document).on("twofactor:ADD_SECURITY_KEY",function(e){return function(t,n){return _("#twofactor-security-key-unsupported-browser").length?e.start_flow(t,p,n):e.start_flow(t,s,n)}}(this)),_(document).on("twofactor:ASK_PASSWORD_CONFIRM",function(e){return function(t,n){return e.start_flow(t,a,n)}}(this)),_("#generate-new-recovery-code").on("click",function(e){return function(t){return e.show_loading(),new Ajax.DBRequest(e.NEW_RECOVERY_CODE_HREF,{parameters:{checkpoint_token:e._checkpoint_token,use_json:!0},onSuccess:function(t){var n,i;if(n=t.responseText.trim(),i=JSON.parse(n),"OK"===i.result)return e.fill_backup_codes(i.codes,"backup-code-list-edit-container");switch(n){case"EXPIRED":return m.to_state("password"),e.show_error_expired();case"ALREADY_DISABLED":return $("twofactor-row").removeClassName("twofactor-enabled"),Je.success(pt("Two-step verification is disabled. Did you maybe disable it in another window?")),zt.hide()}},onFailure:e.show_error500.bind(e),cleanUp:e.hide_loading.bind(e),subject_user:e._user})}}(this)),_("#twofactor-enter-backup-phone #country-code").on("change",this.reset_phone_field.bind(this)),_("#resend-link").on("click",this.enable_resend_phone_code.bind(this)),_("#twofactor-delivery-choice input").change(function(){return _(".delivery-choice").removeClass("selected"),_(this).parents(".delivery-choice").addClass("selected")}),_("#show-qr").on("click",function(e){return _("#twofactor-offline-setup").addClass("showing-qr"),!1}),_("#hide-qr").on("click",function(e){return _("#twofactor-offline-setup").removeClass("showing-qr"),!1}),"#backup2fa"===window.location.hash&&_("#twofactor-row").hasClass("allow-autopop")?this.start_flow(o):void 0},_bind_phone_input_to_save_button:function(){return this.$save_button=_("#twofactor-enter-backup-phone").find(".back-next").find(".savebutton"),this.$phone_input=_("#twofactor-enter-backup-phone").find(".twofactor-backup-phone-number").find(".phone-text"),this.$phone_input.on("keyup",function(e){return function(t){return e._toggle_save_phone_button(e.$phone_input,e.$save_button)}}(this)),this.$phone_input.on("input",function(e){return function(t){return e._toggle_save_phone_button(e.$phone_input,e.$save_button)}}(this)),this._toggle_save_phone_button(this.$phone_input,this.$save_button)},_register_skip_link_click_to_submit_finish:function(){return _("#twofactor-enter-backup-phone").find(".back-next").find("#skipstep").on("click",function(e){return function(){return e.submit_finish(!0,e._current_flow,e._current_flow.state,null)}}(this))},_toggle_save_phone_button:function(e,t){var n;return n=""===_.trim(e.val()),t.prop("disabled",n)},start_flow:function(e,t,n){return null==n&&(n=null),e.preventDefault(),delete this._phone_number,null==n&&(n=_(e.target).data("uid")),ei.set_user(Ae.get_viewer().get_user_by_id(n)),this._current_flow=t,t.start(),!1},connect_login_init:function(){return this._container_selector="#twofactor-form",this._error_selector="#twofactor-form .error",_("#resend-link").on("click",this.connect_resend_phone_code.bind(this))},resend_phone_code:function(e){var t;if(!this.is_resending())return this.show_resending(),t="/twofactor_resend",_("#twofactor-confirm").hasClass("backup")&&(t=Ge.parse(t).updateQuery({backup:!0}).toString()),new Ajax.DBRequest(t,{onSuccess:function(e){return function(t){switch(t.responseText.trim()){case"OK":return e.hide_error(),e.notify_resent();case"UNREACHABLE":return e.show_error_unreachable(!0);case"BADCARRIER":return e.show_error_bad_carrier();case"INVALIDNUMBER":return e.show_error_invalid_number();case"NOTAMOBILE":return e.show_error_not_a_mobile();case"RATELIMIT":return Je.error(pt("You've asked for too many SMS messages. Please try again in a few minutes."));case"EXPIRED":return $("twofactor-confirm").submit();case"BLOCKED":return Je.error(pt("We are having trouble sending your message. Please try again later or contact support."))}}}(this),onFailure:this.show_error500.bind(this),cleanUp:this.hide_resending_with_delay.bind(this)}),!1},connect_resend_phone_code:function(e){return this.is_resending()?void 0:(this.show_resending(),new Ajax.DBRequest("/twofactor_resend",{onSuccess:function(e){return function(t){switch(t.responseText.trim()){case"OK":return e.hide_error(),e.notify_resent();case"UNREACHABLE":return Je.error(e.error_unreachable(!0));case"BADCARRIER":return Je.error(e.error_bad_carrier());case"INVALIDNUMBER":return e.show_error_invalid_number();case"NOTAMOBILE":return Je.error(e.error_not_a_mobile());case"RATELIMIT":return Je.error(pt("You've asked for too many SMS messages. Please try again in a few minutes."));case"EXPIRED":return $("twofactor-form").submit()}}}(this),onFailure:function(e){return function(t){return Je.error(e.error500())}}(this),cleanUp:this.hide_resending_with_delay.bind(this)}),!1)},enable_resend_phone_code:function(e){return this.is_resending()?void 0:(this.show_resending(),new Ajax.DBRequest("/twofactor_resend",{onSuccess:function(e){return function(t){switch(t.responseText.trim()){case"OK":return e.hide_error(),e.notify_resent();case"UNREACHABLE":return e.show_error_unreachable();case"BADCARRIER":return e.show_error_bad_carrier();case"INVALIDNUMBER":return e.show_error_invalid_number();case"NOTAMOBILE":return e.show_error_not_a_mobile();case"RATELIMIT":return Je.error("You've asked for too many SMS messages. Please try again in a few minutes.");case"EXPIRED":return e._current_flow.to_state("password"),e.show_error_expired()}}}(this),onFailure:this.show_error500.bind(this),cleanUp:this.hide_resending_with_delay.bind(this)}),!1)},DEFAULT_ENABLE_TITLE:pt("Enable two-step verification"),DEFAULT_EDIT_TITLE:pt("Edit two-step verification"),DEFAULT_DISABLE_TITLE:pt("Disable two-step verification"),ADD_BACKUP_TITLE:pt("Add a backup phone number"),EDIT_BACKUP_TITLE:pt("Edit backup phone number"),EDIT_RECOVERY_TITLE:pt("View backup codes"),ADD_SECURITY_KEY_TITLE:pt("Add security key"),LOCK_ICON:"lock32",ENABLE_CONFIRM_HREF:"/account/twofactor/confirm_password",DISABLE_CONFIRM_HREF:"/account/twofactor/disable_confirm_password",EDIT_CONFIRM_HREF:"/account/twofactor/edit_confirm_password",ADD_SECURITY_KEY_START_HREF:"/account/twofactor/u2f_start_registration",ADD_SECURITY_KEY_FINISH_HREF:"/account/twofactor/u2f_finish_registration",RECOVERY_CODE_HREF:"/account/twofactor/get_rescue_code",NEW_RECOVERY_CODE_HREF:"/account/twofactor/new_rescue_code",enter_password_shown:function(){var e;return this.hide_error(),_("#twofactor-recovery").removeClass("edit-mode"),e=$("twofactor-enter-password"),_("#password",e).val("").focus(),!1},submit_password:function(e,t,n,i,r){var o;return(o=$("password").getValue())?(this.show_loading(),new Ajax.DBRequest(e,{parameters:{password:o},onSuccess:function(e){return function(r){var o;if(o=r.responseText.trim(),o.startsWith("OK:"))return e._checkpoint_token=o.substr(3),t(n,i);switch(o){case"EXPIRED_PASSWORD":return e.show_error_expired_password();case"INVALID":return e.show_error(pt("Invalid password"));case"RATELIMIT":return e.show_error(pt("Too many incorrect passwords. Please try again in a few minutes."));case"ALREADY_ENABLED":return $("twofactor-row").addClassName("twofactor-enabled"),Je.success(pt("Two-step verification is already enabled. Did you maybe enable it in another window?")),zt.hide();case"ALREADY_DISABLED":return $("twofactor-row").removeClassName("twofactor-enabled"),Je.success(pt("Two-step verification is already disabled. Did you maybe disable it in another window?")),zt.hide()}}}(this),onFailure:this.show_error500.bind(this),cleanUp:this.hide_loading.bind(this),subject_user:this._user})):void this.show_error(pt("Please enter your password"))},fetch_offline_key:function(e,t){return this.show_loading(),new Ajax.DBRequest("/account/twofactor/add_phone",{parameters:{checkpoint_token:this._checkpoint_token,offline:!0},onSuccess:function(n){return function(i){var r;if(r=i.responseText.trim(),r.startsWith("OK:"))return n.fill_key(r.substr(3)),t.next();switch(r){case"EXPIRED":return e.to_state("password"),n.show_error_expired()}}}(this),onFailure:this.show_error500.bind(this),cleanUp:this.hide_loading.bind(this),subject_user:this._user})},fill_key:function(e){var t,n,r;return e=e.replace(new RegExp("=+$"),""),t=e.toLowerCase().replace(/(.{4})/g,"$1 "),$("secret-div").__date(t),$("qr-div").__date(),r=Le.IS_PROD?"Dropbox":"DropboxDev",n={text:"otpauth://totp/"+r+":"+this._user.email+"?secret="+e+"&issuer="+r,width:200,height:200},i.canvas||(n.render="table"),_("#qr-div").qrcode(n),i.canvas?void 0:_("#qr-div > table").css("margin","0 auto")},submit_phone_number:function(e,t,n){var i,r;return i=_("#twofactor-enter-phone .twofactor-phone-number"),Ye.get_controller(i).validate_on_submit()?(r=i.val(),this.show_loading(),new Ajax.DBRequest("/account/twofactor/add_phone",{parameters:{checkpoint_token:this._checkpoint_token,phone_number:r},onSuccess:function(n){return function(o){var s;if(s=o.responseText.trim(),s.startsWith("OK:"))return n._phone_number=r,n._phone_sig=s.substr(3),e.vars.phone_number=r,e.vars.phone_sig=n._phone_sig,t.next();switch(s){case"EXPIRED":return e.to_state("password"),n.show_error_expired();case"UNREACHABLE":return n.show_error_unreachable(i);case"BADCARRIER":return n.show_error_bad_carrier(i);case"INVALIDNUMBER":return n.show_error_invalid_number(i);case"NOTAMOBILE":return n.show_error_not_a_mobile(i);case"RATELIMIT":return n.show_error(pt("You've added too many phone numbers. Please try again in a few minutes."))}}}(this),onFailure:this.show_error500.bind(this),cleanUp:this.hide_loading.bind(this),subject_user:this._user})):void 0},submit_phone_code:function(e,t,n){var i;return(i=$("phone-code").getValue().trim())?-1===i.search(/^\d{6}$/)?void this.show_error(pt("Invalid security code")):(this.show_loading(),new Ajax.DBRequest("/account/twofactor/confirm_phone",{parameters:{checkpoint_token:this._checkpoint_token,twofactor_code:i,phone_sig:this._phone_sig},onSuccess:function(n){return function(i){var r,o;if(o=JSON.parse(i.responseText.trim()),"OK"===o.result)return n.fill_backup_codes(o.codes,"backup-code-list-container"),t.next();switch(o.result){case"INVALID":return n._invalid_code_count+=1,r=pt(n._invalid_code_count<=2?"Invalid code":n._is_offline_setup?"Invalid code. Check the clock on your phone: it must be accurate to the minute.":"Invalid code"),n.show_error(r);case"EXPIRED":return e.to_state("password"),n.show_error_expired();case"RATELIMIT":return n.show_error(pt("Too many invalid codes. Try again in a few minutes."))}}}(this),onFailure:this.show_error500.bind(this),cleanUp:this.hide_loading.bind(this),subject_user:this._user})):void this.show_error(pt("Please enter the security code"))},enter_backup_phone_number_shown:function(e,t){var n,i;return this.hide_error(),n=$("twofactor-enter-backup-phone"),i=this.fill_phone_number_for_edit(n,_("#twofactor-row-"+this._user.role+" #twofactor-backup-number").text()),i.focus(),"back_next"===e?(_("#twofactor-backup-back-next").show(),_("#twofactor-backup-cancel-save").hide(),_("#twofactor-backup-back-save").hide()):"cancel_save"===e?(_("#twofactor-backup-back-next").hide(),_("#twofactor-backup-cancel-save").show(),_("#twofactor-backup-back-save").hide()):"back_save"===e?(_("#twofactor-backup-back-next").hide(),_("#twofactor-backup-cancel-save").hide(),_("#twofactor-backup-back-save").show()):void 0},submit_backup_phone_number:function(e,t,n,i,r){var o,s;if(o=_("#twofactor-enter-backup-phone .twofactor-backup-phone-number"),Ye.get_controller(o).validate_on_blur()){if(s=o.val()){if(this.is_primary_number(s))return void Ye.get_controller(o).show_error(pt("You can’t use your primary phone as your backup"),o)}else if(e)return void Ye.get_controller(o).show_error(pt("Please enter phone number"),o);if(this._backup_phone=s,"save_backup_phone"===t)this.save_added_backup_phone(n,e,s);else if("save_everything"===t)this.submit_finish(!1,n,i,r);else if("save_none"===t)return i.next()}},is_same_phone_number:function(e,t){return e&&t?e.replace(/\D+/g,"")===t.replace(/\D+/g,""):!1},is_primary_number:function(e){var t;return t=_("#twofactor-row-"+this._user.role),this._is_offline_setup?!1:this._phone_number?this.is_same_phone_number(e,this._phone_number):this.is_same_phone_number(e,t.data("primary_phone"))?!0:!!this.is_same_phone_number(e,_("#twofactor-sms-number",t).text())},save_added_backup_phone:function(e,t,n){return this.show_loading(),new Ajax.DBRequest("/account/twofactor/set_backup_phone",{parameters:{checkpoint_token:this._checkpoint_token,backup_phone_number:n},onSuccess:function(i){return function(r){var o;switch(r.responseText.trim()){case"OK":return i.hide_error(),o="#twofactor-row-"+i._user.role,_(o+" #twofactor-backup-number").text(n),_(o).toggleClass("with-backup",!!n),n?t?Je.success(pt("Backup phone number added")):Je.success(pt("Backup phone number updated")):Je.success(pt("Backup phone number removed")),zt.hide();case"EXPIRED":return e.to_state("password"),i.show_error_expired()}}}(this),onFailure:this.show_error500.bind(this),cleanUp:this.hide_loading.bind(this),subject_user:this._user})},fill_phone_number_for_edit:function(e,t){var n,i;return i=_("input.text-input-input",e),t?(n=Ye.get_controller(_(".phone-number-input",e)),n.set(t),i.val(n.get_local_number()),i.length&&i[0].select(),_("#twofactor-backup-back-save").find("#skipstep").hide(),_(".text-input-wrapper").find("label").hide(),i):i.val("")},fill_delivery_choice:function(e){return _("#twofactor-delivery-phone-label,#confirm-phone-primary").toggle(!!e),_("#twofactor-delivery-offline-label").toggle(!e),_("#confirm-phone-primary-number").text(e),_("#twofactor-row-"+this._user.role).data("primary_phone",e)},fill_backup_phone:function(e){return _("#confirm-phone-backup").toggle(!!e),_("#confirm-phone-backup-number").text(e)},insert_spaces_into_code:function(e){return e.toLowerCase().replace(/(.{4})/g,"$1 ")},fill_backup_codes:function(e,t){var n,i,r,o,s,a,l;if(i=_("#"+t),i.empty(),n=_("<ol/>",{class:"twofactor-backup-list"}),0===e.length)return i.siblings().css("display","none"),_(".codesbox__error").css("display","block");for(o=e[0].length,16===o&&n.css("column-count","1"),s=0,a=e.length;a>s;s++)r=e[s],l=_("<li/>",{class:"twofactor-backup-list__item"}),n.append(l.append(_("<span/>",{class:"twofactor-backup-list__code",text:this.insert_spaces_into_code(r)})));return i.append(n),i.siblings().css("display","block"),_(".codesbox__error").css("display","none")},submit_finish:function(e,t,n,i){var r;return this.show_loading(),r={checkpoint_token:this._checkpoint_token},this._backup_phone&&!e&&(r.backup_phone_number=this._backup_phone),new Ajax.DBRequest("/account/twofactor/enable_finish",{parameters:r,onSuccess:function(e){return function(i){switch(i.responseText.trim()){case"OK":return e.successfully_enabled=!0,"ENABLE"!==t.vars.mode?e.after_enabled(t,n):n.next();case"EXPIRED":return t.to_state("password"),e.show_error_expired()}}}(this),onFailure:this.show_error500.bind(this),cleanUp:this.hide_loading.bind(this),subject_user:this._user})},after_enabled:function(e,t){var n,i;return this._checkpoint_token=null,this.hide_error(),n=_("#twofactor-row-"+this._user.role),n.toggleClass("with-sms",!!this._phone_number),_("#twofactor-sms-number",n).text(this._phone_number||""),n.toggleClass("with-backup",!!this._backup_phone),_("#twofactor-backup-number",n).text(this._backup_phone||""),n.addClass("twofactor-enabled"),_("tr[id^='session_row_']").slice(1).hide(),"ENABLE"!==e.vars.mode?(i="/account/#security",Je.success(new We(pt('Two-step verification updated. Any <a href="%(path)s">existing sessions, devices and apps</a> can still access your Dropbox.').format({path:i}))),null!=t?t.next():void 0):void 0},disable_submit:function(e,t){return this.show_loading(),new Ajax.DBRequest("/account/twofactor/disable",{parameters:{checkpoint_token:this._checkpoint_token},onSuccess:function(n){return function(i){var r;switch(i.responseText.trim()){case"OK":return n.successfully_disabled=!0,n._checkpoint_token=null,r=_("#twofactor-row-"+n._user.role),r.removeClass("twofactor-enabled with-sms with-backup"),_(document).trigger("security-key-manager:UPDATE_KEYS",n._user.id),_("#twofactor-sms-number, #twofactor-backup-number",r).text(""),_("tr[id^='session_row_']").slice(1).hide(),Je.success(pt("Two-step verification is now disabled.")),t.next();case"EXPIRED":return e.to_state("password"),n.show_error_expired()}}}(this),onFailure:this.show_error500.bind(this),cleanUp:this.hide_loading.bind(this),subject_user:this._user})},show_error:function(e,t){var n;return t?void Ye.get_controller(t).show_error(e):(n=$$(this._error_selector),e===this.error_expired_password()||e===this.error_unreachable(!0)?n.invoke("update",e):n.invoke("__date",e),n.invoke("show"))},show_error500:function(){return this.show_error(this.error_500())},show_error_bad_carrier:function(e){return this.show_error(this.error_bad_carrier(),e)},show_error_invalid_number:function(e){return this.show_error(this.error_invalid_number(),e)},show_error_not_a_mobile:function(e){return this.show_error(this.error_not_a_mobile(),e)},show_error_unreachable:function(e,t){return null==t&&(t=!1),this.show_error(this.error_unreachable(t),e)},show_error_expired:function(e){return this.show_error(this.error_expired(),e)},show_error_expired_password:function(e){return this.show_error(this.error_expired_password(),e)},error_500:function(){return pt("Sorry, an error occurred. Please try again later.")},error_bad_carrier:function(){return pt("Unfortunately, your carrier isn’t supported at this time.")},error_invalid_number:function(){return pt("That isn’t a valid phone number.")},error_not_a_mobile:function(){return pt("That phone number doesn’t appear to be a valid mobile number.")},error_unreachable:function(e){return null==e&&(e=!1),pt(e?'We couldn\'t reach your phone number. If this has happened before <a href="https://www.dropbox.com/help/364/">click here</a>.':"We couldn't reach your phone number. Are you sure it's correct?")},error_expired:function(){return pt("Since it's been a while, please enter your password again.")},error_expired_password:function(){return pt('Your password has expired. Please create a new password <a target="_blank" href="/password_expired">here</a>.')},hide_error:function(){return $$(this._error_selector).invoke("__date")},show_loading:function(){return this.hide_error(),$$(this._container_selector).invoke("addClassName","loading")},hide_loading:function(){return $$(this._container_selector).invoke("removeClassName","loading")},is_resending:function(){return $$(this._container_selector)[0].hasClassName("resending")},show_resending:function(){return $$(this._container_selector).invoke("addClassName","resending")},hide_resending:function(){return $$(this._container_selector).invoke("removeClassName","resending")},hide_resending_with_delay:function(){return setTimeout(this.hide_resending.bind(this),3e3)},notify_resent:function(){return Je.success(pt("We sent you another code. It may take a few minutes to arrive."))},reset_phone_field:function(e){var t,n;return t=e.element(),n=_(".sick-input",t.form),_("input",n).val("").focus(),this.fill_example_phone_number(t,n)},fill_example_phone_number:function(e,t){var n,i;return"undefined"!=typeof phone_helpers&&null!==phone_helpers?(n=_(e).val().substr(1),i=phone_helpers.get_example_mobile_number(n),_("label",t).text(pt("Example: ")+i)):void 0},reset_phone_field_and_backup_country:function(e){var t;return this.reset_phone_field(e),""===_("#backup-phone-number").val()?(t=_("#twofactor-enter-backup-phone #country-code"),t.val(e.element().getValue()),this.fill_example_phone_number(t,_(".sick-input",t[0].form))):void 0}};var ti,ni,ii;ii=Qe.UnsupportedBrowser={init:function(){return _("#unsupported-browser-dismiss").on("click",function(e){return e.preventDefault(),ht.hide(),h.SilentBackgroundRequest({url:"/dismiss_browser_msg"})})}},ni=Qe.ExpiredCCNotificationBar={init:function(e){return _(".expired-dismiss").on("click",function(t){return t.preventDefault(),ht.hide(),h.SilentBackgroundRequest({url:"/dismiss_expired_cc_notification",data:{source:e}})})}},ti=Qe.BetaLocaleNotificationBar={init:function(e){return _(".beta-locale-dismiss").on("click",function(t){return t.preventDefault(),ht.hide(),h.SilentBackgroundRequest({url:"/dismiss_beta_locale_notification",data:{source:e}})})}};var ri;return ri=INLINE_JS.viewer=Ae.get_viewer(),_(Wn.check_timezone),_(function(){return Event.fire(document,"script:loaded")}),Qe});
//# sourceMappingURL=dropbox.min.js-vflpqdW3F.map