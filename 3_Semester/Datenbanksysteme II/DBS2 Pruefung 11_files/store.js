define(["require","exports","tslib","external/underscore","modules/clean/flux/dispatcher","modules/clean/flux/flux_store","modules/clean/react/starred/constants","modules/clean/react/starred/id_type_pair","modules/clean/react/browse/store","modules/clean/react/browse/constants","modules/clean/react/starred/actions","modules/clean/react/home/home_access/home_access_util","modules/constants/starred"],function(t,e,r,o,a,i,s,n,d,c,S,u,T){"use strict";var p=d.BrowseStore,h=function(t){function e(){var e=t.call(this,a)||this;return e.idsToLoadingState={},e.idsToStarred={},e}return r.__extends(e,t),e.prototype.getLoadingState=function(t){return this.idsToLoadingState[n.idTypePairToString(t)]},e.prototype.getIsStarred=function(t){return this.idsToStarred[n.idTypePairToString(t)]},e.prototype.onLoading=function(t){var e={};t.forEach(function(t){return e[n.idTypePairToString(t)]=s.StarredLoadingState.LOADING}),this.idsToLoadingState=o.extend(this.idsToLoadingState,e)},e.prototype.onSetStatus=function(t){var e={},r={};t.forEach(function(t){var o=n.idTypePairToString(t.idTypePair);e[o]=s.StarredLoadingState.LOAD_SUCCESS,r[o]=t.starred}),this.idsToLoadingState=o.extend(this.idsToLoadingState,e),this.idsToStarred=o.extend(this.idsToStarred,r)},e.prototype.onLoadFailure=function(t){var e=this,r={};t.forEach(function(t){var o=n.idTypePairToString(t),a=e.idsToLoadingState[o];void 0!==a&&a!==s.StarredLoadingState.LOADING||(r[o]=s.StarredLoadingState.LOAD_FAILED)}),this.idsToLoadingState=o.extend(this.idsToLoadingState,r)},e.prototype.onBrowseChange=function(){var t=this;a.waitFor([p.dispatchToken]);var e=p.files().toArray(),r=e.map(function(t){return{type:T.STARRED_RESOURCE_ID_TYPE.ENCODED_FILE_OBJ_ID,id:t.file_id}}).filter(function(e){return e.id&&!t.idsToLoadingState.hasOwnProperty(n.idTypePairToString(e))});r.length&&(S.StarredActions.fetchStatuses(p.user().role,r,!1),this.onLoading(r))},e.prototype.__onDispatch=function(t){var e=t.action,r=p.context();switch(e.type){case c.BrowseActionTypes.LOAD_PATH:case c.BrowseActionTypes.ADD_FILES:case c.BrowseActionTypes.CHANGE_FILES:case c.BrowseActionTypes.INITIALIZE_EVERYTHING:u.isHomeAccessStarsEnabled()&&!r.isNonUserRelativeContext&&this.onBrowseChange();break;case s.StarredActionTypes.LOADING:this.onLoading(e.idTypePairs);break;case s.StarredActionTypes.SET_STATUS:this.onSetStatus(e.starredStatuses);break;case s.StarredActionTypes.LOAD_FAILURE:this.onLoadFailure(e.idTypePairs)}this.__emitChange()},e}(i);e._StarredStoreClass=h,e.StarredStore=new h});
//# sourceMappingURL=store.min.js-vflxFJLVL.map